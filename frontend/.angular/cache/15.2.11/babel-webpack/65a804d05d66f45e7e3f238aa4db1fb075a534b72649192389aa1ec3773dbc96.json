{"ast":null,"code":"import _asyncToGenerator from \"/Users/marieklinaeva/github/ck-board/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __asyncValues } from \"tslib\";\nimport { fabric } from 'fabric';\nimport { FabricPostComponent } from '../components/fabric-post/fabric-post.component';\nimport { PostType } from '../models/post';\nimport { SocketEvent } from '../utils/constants';\nimport { generateUniqueID } from '../utils/Utils';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./socket.service\";\nimport * as i2 from \"./fileUpload.service\";\nimport * as i3 from \"./user.service\";\nimport * as i4 from \"./post.service\";\nimport * as i5 from \"./upvotes.service\";\nimport * as i6 from \"./comment.service\";\nimport * as i7 from \"./board.service\";\nimport * as i8 from \"./bucket.service\";\nimport * as i9 from \"./workflow.service\";\nimport * as i10 from \"./notification.service\";\nimport * as i11 from \"../utils/FabricUtils\";\nexport class CanvasService {\n  constructor(socketService, fileUploadService, userService, postService, upvotesService, commentService, boardService, bucketService, workflowService, notificationService, fabricUtils) {\n    this.socketService = socketService;\n    this.fileUploadService = fileUploadService;\n    this.userService = userService;\n    this.postService = postService;\n    this.upvotesService = upvotesService;\n    this.commentService = commentService;\n    this.boardService = boardService;\n    this.bucketService = bucketService;\n    this.workflowService = workflowService;\n    this.notificationService = notificationService;\n    this.fabricUtils = fabricUtils;\n  }\n  createPost(post) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const savedPost = yield _this.postService.create(post);\n      const fabricPost = new FabricPostComponent(post);\n      _this.fabricUtils._canvas.add(fabricPost);\n      _this.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n    })();\n  }\n  removePost(post) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.postService.remove(post.postID);\n      _this2.socketService.emit(SocketEvent.POST_DELETE, post);\n    })();\n  }\n  createBucketPost(bucketID, post) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const savedPost = yield _this3.postService.create(post);\n      yield _this3.bucketService.add(bucketID, post.postID);\n      _this3.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n      return savedPost;\n    })();\n  }\n  createListPost(post) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const savedPost = yield _this4.postService.create(post);\n      _this4.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n      for (const tag of post.tags) {\n        _this4.socketService.emit(SocketEvent.POST_TAG_ADD, {\n          tag,\n          post: savedPost\n        });\n      }\n      return savedPost;\n    })();\n  }\n  createBoardPostFromBucket(post) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const upvotes = yield _this5.upvotesService.getUpvotesByPost(post.postID);\n      const comments = yield _this5.commentService.getCommentsByPost(post.postID);\n      post.type = PostType.BOARD;\n      const fabricPost = new FabricPostComponent(post, {\n        upvotes: upvotes.length,\n        comments: comments.length\n      });\n      post = yield _this5.postService.update(post.postID, post);\n      _this5.fabricUtils._canvas.add(fabricPost);\n      _this5.socketService.emit(SocketEvent.POST_CREATE, post);\n      return post;\n    })();\n  }\n  clearPostsFromBoard(posts) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      var _a, e_1, _b, _c;\n      const updatedPosts = [];\n      try {\n        for (var _d = true, posts_1 = __asyncValues(posts), posts_1_1; posts_1_1 = yield posts_1.next(), _a = posts_1_1.done, !_a;) {\n          _c = posts_1_1.value;\n          _d = false;\n          try {\n            const post = _c;\n            if (post.type == PostType.BOARD) {\n              const updatedPost = yield _this6.postService.update(post.postID, {\n                type: PostType.BUCKET\n              });\n              updatedPosts.push(updatedPost);\n            }\n          } finally {\n            _d = true;\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (!_d && !_a && (_b = posts_1.return)) yield _b.call(posts_1);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      _this6.socketService.emit(SocketEvent.BOARD_CLEAR, updatedPosts);\n      return updatedPosts;\n    })();\n  }\n  upvote(userID, post) {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      if (typeof post === 'string') {\n        post = yield _this7.postService.get(post);\n      }\n      const upvote = {\n        upvoteID: generateUniqueID(),\n        voterID: userID,\n        postID: post.postID,\n        boardID: post.boardID\n      };\n      const result = yield _this7.upvotesService.add(upvote);\n      _this7.socketService.emit(SocketEvent.POST_UPVOTE_ADD, upvote);\n      if (post.userID !== userID) {\n        _this7.socketService.emit(SocketEvent.NOTIFICATION_CREATE, _this7.notificationService.buildUpvoteNotification(post));\n      }\n      return result.upvote;\n    })();\n  }\n  unupvote(userID, post) {\n    var _this8 = this;\n    return _asyncToGenerator(function* () {\n      if (typeof post === 'string') {\n        post = yield _this8.postService.get(post);\n      }\n      const result = yield _this8.upvotesService.remove(userID, post.postID);\n      _this8.socketService.emit(SocketEvent.POST_UPVOTE_REMOVE, result.upvote);\n      return result.upvote;\n    })();\n  }\n  comment(comment) {\n    var _this9 = this;\n    return _asyncToGenerator(function* () {\n      const result = yield _this9.commentService.add(comment);\n      const post = yield _this9.postService.get(result.comment.postID);\n      _this9.socketService.emit(SocketEvent.POST_COMMENT_ADD, comment);\n      if (post.userID !== comment.userID) {\n        _this9.socketService.emit(SocketEvent.NOTIFICATION_CREATE, _this9.notificationService.buildCommentNotification(post));\n      }\n    })();\n  }\n  deleteComment(commentID, postID) {\n    var _this10 = this;\n    return _asyncToGenerator(function* () {\n      const result = yield _this10.commentService.remove(commentID);\n      _this10.socketService.emit(SocketEvent.POST_COMMENT_REMOVE, result.comment);\n    })();\n  }\n  tag(post, tag) {\n    var _this11 = this;\n    return _asyncToGenerator(function* () {\n      var _a;\n      const tags = [...post.tags, tag];\n      const update = {\n        tags\n      };\n      if (tag.specialAttributes) {\n        const updatedAttr = _this11.fabricUtils.applyTagFeatures(post.postID, tag);\n        if (updatedAttr) update.displayAttributes = updatedAttr;\n      }\n      const savedPost = yield _this11.postService.update(post.postID, update);\n      _this11.socketService.emit(SocketEvent.POST_TAG_ADD, {\n        tag,\n        post: savedPost,\n        userId: (_a = _this11.userService.user) === null || _a === void 0 ? void 0 : _a.userID\n      });\n      if (savedPost.userID !== post.userID) {\n        _this11.socketService.emit(SocketEvent.NOTIFICATION_CREATE, _this11.notificationService.buildTagNotification(post));\n      }\n      return savedPost;\n    })();\n  }\n  untag(post, tag) {\n    var _this12 = this;\n    return _asyncToGenerator(function* () {\n      var _a;\n      post.tags = post.tags.filter(t => t.name != tag.name);\n      const update = {\n        tags: post.tags\n      };\n      if (!post.displayAttributes) {\n        return yield _this12.postService.update(post.postID, update);\n      }\n      if (tag.specialAttributes) {\n        update.displayAttributes = yield _this12.fabricUtils.resetTagFeatures(post.postID);\n      }\n      const savedPost = yield _this12.postService.update(post.postID, update);\n      _this12.socketService.emit(SocketEvent.POST_TAG_REMOVE, {\n        tag,\n        post: savedPost,\n        userId: (_a = _this12.userService.user) === null || _a === void 0 ? void 0 : _a.userID\n      });\n      return savedPost;\n    })();\n  }\n  updateBoardTask(boardID, title, message) {\n    var _this13 = this;\n    return _asyncToGenerator(function* () {\n      const task = Object.assign({}, title === null ? null : {\n        title\n      }, message === null ? null : {\n        message\n      });\n      const board = yield _this13.boardService.update(boardID, {\n        task\n      });\n      _this13.socketService.emit(SocketEvent.BOARD_TASK_UPDATE, board);\n      return board;\n    })();\n  }\n  updateBoardName(boardID, name) {\n    var _this14 = this;\n    return _asyncToGenerator(function* () {\n      const board = yield _this14.boardService.update(boardID, {\n        name\n      });\n      _this14.socketService.emit(SocketEvent.BOARD_NAME_UPDATE, board);\n      return board;\n    })();\n  }\n  updateBoardImage(boardID, file, settings) {\n    var _this15 = this;\n    return _asyncToGenerator(function* () {\n      if (file === null) {\n        const board = yield _this15.boardService.update(boardID, {\n          bgImage: null\n        });\n        _this15.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n        return board;\n      } else {\n        return new Promise(resolve => {\n          fabric.Image.fromURL(file, /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (image) {\n              const url = yield _this15.fileUploadService.upload(file);\n              const imgSettings = settings !== null && settings !== void 0 ? settings : _this15.fabricUtils.createImageSettings(image);\n              const board = yield _this15.boardService.update(boardID, {\n                bgImage: {\n                  url,\n                  imgSettings\n                }\n              });\n              _this15.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n              resolve(board);\n            });\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        });\n      }\n    })();\n  }\n  updateBoardImageSettings(boardID, imgSettings) {\n    var _this16 = this;\n    return _asyncToGenerator(function* () {\n      var _a;\n      const oldBoard = yield _this16.boardService.get(boardID);\n      const url = (_a = oldBoard.bgImage) === null || _a === void 0 ? void 0 : _a.url;\n      if (url) {\n        const board = yield _this16.boardService.update(boardID, {\n          bgImage: {\n            url,\n            imgSettings\n          }\n        });\n        _this16.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n        return board;\n      }\n      return oldBoard;\n    })();\n  }\n  updateBoardPermissions(boardID, permissions) {\n    var _this17 = this;\n    return _asyncToGenerator(function* () {\n      const oldBoard = yield _this17.boardService.get(boardID);\n      if (oldBoard.permissions.allowTracing !== permissions.allowTracing) {\n        if (permissions.allowTracing) {\n          _this17.socketService.emit(SocketEvent.TRACING_ENABLED, permissions.allowTracing);\n        } else {\n          _this17.socketService.emit(SocketEvent.TRACING_DISABLED, permissions.allowTracing);\n        }\n      }\n      const board = yield _this17.boardService.update(boardID, {\n        permissions\n      });\n      _this17.socketService.emit(SocketEvent.BOARD_PERMISSIONS_UPDATE, board);\n      return board;\n    })();\n  }\n  updateBoardTags(boardID, tags) {\n    var _this18 = this;\n    return _asyncToGenerator(function* () {\n      const board = yield _this18.boardService.update(boardID, {\n        tags\n      });\n      _this18.socketService.emit(SocketEvent.BOARD_TAGS_UPDATE, board);\n      return board;\n    })();\n  }\n  updateBoardUpvotes(boardID, upvoteLimit) {\n    var _this19 = this;\n    return _asyncToGenerator(function* () {\n      const board = yield _this19.boardService.update(boardID, {\n        upvoteLimit\n      });\n      _this19.socketService.emit(SocketEvent.BOARD_UPVOTE_UPDATE, board);\n      return board;\n    })();\n  }\n  runDistributionWorkflow(workflow) {\n    var _this20 = this;\n    return _asyncToGenerator(function* () {\n      yield _this20.workflowService.runDistribution(workflow.workflowID);\n      _this20.socketService.emit(SocketEvent.WORKFLOW_RUN_DISTRIBUTION, workflow);\n    })();\n  }\n  runTaskWorkflow(workflow) {\n    var _this21 = this;\n    return _asyncToGenerator(function* () {\n      yield _this21.workflowService.runTask(workflow.workflowID);\n      _this21.socketService.emit(SocketEvent.WORKFLOW_RUN_TASK, workflow);\n    })();\n  }\n  runAIClassificationWorkflow(workflow) {\n    var _this22 = this;\n    return _asyncToGenerator(function* () {\n      yield _this22.workflowService.runAIClassification(workflow.workflowID);\n      _this22.socketService.emit(SocketEvent.WORKFLOW_RUN_AI_CLASSIFICATION, workflow);\n    })();\n  }\n  readPost(postID) {\n    var _this23 = this;\n    return _asyncToGenerator(function* () {\n      _this23.socketService.emit(SocketEvent.POST_READ, postID);\n    })();\n  }\n  get centerPos() {\n    return this.fabricUtils._canvas.getCenter();\n  }\n}\nCanvasService.ɵfac = function CanvasService_Factory(t) {\n  return new (t || CanvasService)(i0.ɵɵinject(i1.SocketService), i0.ɵɵinject(i2.FileUploadService), i0.ɵɵinject(i3.UserService), i0.ɵɵinject(i4.PostService), i0.ɵɵinject(i5.UpvotesService), i0.ɵɵinject(i6.CommentService), i0.ɵɵinject(i7.BoardService), i0.ɵɵinject(i8.BucketService), i0.ɵɵinject(i9.WorkflowService), i0.ɵɵinject(i10.NotificationService), i0.ɵɵinject(i11.FabricUtils));\n};\nCanvasService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CanvasService,\n  factory: CanvasService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["fabric","FabricPostComponent","PostType","SocketEvent","generateUniqueID","CanvasService","constructor","socketService","fileUploadService","userService","postService","upvotesService","commentService","boardService","bucketService","workflowService","notificationService","fabricUtils","createPost","post","savedPost","create","fabricPost","_canvas","add","emit","POST_CREATE","removePost","remove","postID","POST_DELETE","createBucketPost","bucketID","createListPost","tag","tags","POST_TAG_ADD","createBoardPostFromBucket","upvotes","getUpvotesByPost","comments","getCommentsByPost","type","BOARD","length","update","clearPostsFromBoard","posts","updatedPosts","_c","_d","updatedPost","BUCKET","push","BOARD_CLEAR","upvote","userID","get","upvoteID","voterID","boardID","result","POST_UPVOTE_ADD","NOTIFICATION_CREATE","buildUpvoteNotification","unupvote","POST_UPVOTE_REMOVE","comment","POST_COMMENT_ADD","buildCommentNotification","deleteComment","commentID","POST_COMMENT_REMOVE","specialAttributes","updatedAttr","applyTagFeatures","displayAttributes","userId","user","buildTagNotification","untag","filter","t","name","resetTagFeatures","POST_TAG_REMOVE","updateBoardTask","title","message","task","Object","assign","board","BOARD_TASK_UPDATE","updateBoardName","BOARD_NAME_UPDATE","updateBoardImage","file","settings","bgImage","BOARD_IMAGE_UPDATE","Promise","resolve","Image","fromURL","image","url","upload","imgSettings","createImageSettings","updateBoardImageSettings","oldBoard","updateBoardPermissions","permissions","allowTracing","TRACING_ENABLED","TRACING_DISABLED","BOARD_PERMISSIONS_UPDATE","updateBoardTags","BOARD_TAGS_UPDATE","updateBoardUpvotes","upvoteLimit","BOARD_UPVOTE_UPDATE","runDistributionWorkflow","workflow","runDistribution","workflowID","WORKFLOW_RUN_DISTRIBUTION","runTaskWorkflow","runTask","WORKFLOW_RUN_TASK","runAIClassificationWorkflow","runAIClassification","WORKFLOW_RUN_AI_CLASSIFICATION","readPost","POST_READ","centerPos","getCenter","factory","providedIn"],"sourceRoot":"","sources":["/Users/marieklinaeva/github/ck-board/frontend/src/app/services/canvas.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { fabric } from 'fabric';\nimport { FabricPostComponent } from '../components/fabric-post/fabric-post.component';\nimport { Board, BoardPermissions } from '../models/board';\nimport Comment from '../models/comment';\nimport Post, { PostType } from '../models/post';\nimport { Tag } from '../models/tag';\nimport { DistributionWorkflow, TaskWorkflow, AIClassificationWorkflow } from '../models/workflow';\nimport { SocketEvent } from '../utils/constants';\nimport { FabricUtils, ImageSettings } from '../utils/FabricUtils';\nimport { generateUniqueID } from '../utils/Utils';\nimport { BoardService } from './board.service';\nimport { BucketService } from './bucket.service';\nimport { CommentService } from './comment.service';\nimport { FileUploadService } from './fileUpload.service';\nimport { UpvotesService } from './upvotes.service';\nimport { NotificationService } from './notification.service';\nimport { PostService } from './post.service';\nimport { SocketService } from './socket.service';\nimport Upvote from '../models/upvote';\nimport { WorkflowService } from './workflow.service';\nimport { UserService } from './user.service';\n\ninterface Position {\n  top: number;\n  left: number;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CanvasService {\n  constructor(\n    private socketService: SocketService,\n    private fileUploadService: FileUploadService,\n    private userService: UserService,\n    private postService: PostService,\n    private upvotesService: UpvotesService,\n    private commentService: CommentService,\n    private boardService: BoardService,\n    private bucketService: BucketService,\n    private workflowService: WorkflowService,\n    private notificationService: NotificationService,\n    private fabricUtils: FabricUtils\n  ) {}\n\n  async createPost(post: Post) {\n    const savedPost = await this.postService.create(post);\n    const fabricPost = new FabricPostComponent(post);\n\n    this.fabricUtils._canvas.add(fabricPost);\n    this.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n  }\n\n  async removePost(post: Post) {\n    await this.postService.remove(post.postID);\n\n    this.socketService.emit(SocketEvent.POST_DELETE, post);\n  }\n\n  async createBucketPost(bucketID: string, post: Post): Promise<Post> {\n    const savedPost = await this.postService.create(post);\n    await this.bucketService.add(bucketID, post.postID);\n\n    this.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n    return savedPost;\n  }\n\n  async createListPost(post: Post) {\n    const savedPost = await this.postService.create(post);\n    this.socketService.emit(SocketEvent.POST_CREATE, savedPost);\n    for (const tag of post.tags) {\n      this.socketService.emit(SocketEvent.POST_TAG_ADD, {\n        tag,\n        post: savedPost,\n      });\n    }\n\n    return savedPost;\n  }\n\n  async createBoardPostFromBucket(post: Post): Promise<Post> {\n    const upvotes = await this.upvotesService.getUpvotesByPost(post.postID);\n    const comments = await this.commentService.getCommentsByPost(post.postID);\n    post.type = PostType.BOARD;\n\n    const fabricPost = new FabricPostComponent(post, {\n      upvotes: upvotes.length,\n      comments: comments.length,\n    });\n    post = await this.postService.update(post.postID, post);\n\n    this.fabricUtils._canvas.add(fabricPost);\n    this.socketService.emit(SocketEvent.POST_CREATE, post);\n\n    return post;\n  }\n\n  async clearPostsFromBoard(posts: Post[]): Promise<Post[]> {\n    const updatedPosts: Post[] = [];\n    for await (const post of posts) {\n      if (post.type == PostType.BOARD) {\n        const updatedPost = await this.postService.update(post.postID, {\n          type: PostType.BUCKET,\n        });\n        updatedPosts.push(updatedPost);\n      }\n    }\n\n    this.socketService.emit(SocketEvent.BOARD_CLEAR, updatedPosts);\n\n    return updatedPosts;\n  }\n\n  async upvote(userID: string, post: string | Post) {\n    if (typeof post === 'string') {\n      post = await this.postService.get(post);\n    }\n\n    const upvote: Upvote = {\n      upvoteID: generateUniqueID(),\n      voterID: userID,\n      postID: post.postID,\n      boardID: post.boardID,\n    };\n\n    const result = await this.upvotesService.add(upvote);\n\n    this.socketService.emit(SocketEvent.POST_UPVOTE_ADD, upvote);\n\n    if (post.userID !== userID) {\n      this.socketService.emit(\n        SocketEvent.NOTIFICATION_CREATE,\n        this.notificationService.buildUpvoteNotification(post)\n      );\n    }\n\n    return result.upvote;\n  }\n\n  async unupvote(userID: string, post: string | Post): Promise<Upvote> {\n    if (typeof post === 'string') {\n      post = await this.postService.get(post);\n    }\n\n    const result = await this.upvotesService.remove(userID, post.postID);\n\n    this.socketService.emit(SocketEvent.POST_UPVOTE_REMOVE, result.upvote);\n\n    return result.upvote;\n  }\n\n  async comment(comment: Comment) {\n    const result = await this.commentService.add(comment);\n\n    const post = await this.postService.get(result.comment.postID);\n\n    this.socketService.emit(SocketEvent.POST_COMMENT_ADD, comment);\n\n    if (post.userID !== comment.userID) {\n      this.socketService.emit(\n        SocketEvent.NOTIFICATION_CREATE,\n        this.notificationService.buildCommentNotification(post)\n      );\n    }\n  }\n\n  async deleteComment(commentID: string, postID: string) {\n    const result = await this.commentService.remove(commentID);\n\n    this.socketService.emit(SocketEvent.POST_COMMENT_REMOVE, result.comment);\n  }\n\n  async tag(post: Post, tag: Tag): Promise<Post> {\n    const tags = [...post.tags, tag];\n    const update: Partial<Post> = { tags };\n\n    if (tag.specialAttributes) {\n      const updatedAttr = this.fabricUtils.applyTagFeatures(post.postID, tag);\n      if (updatedAttr) update.displayAttributes = updatedAttr;\n    }\n    const savedPost = await this.postService.update(post.postID, update);\n    this.socketService.emit(SocketEvent.POST_TAG_ADD, {\n      tag,\n      post: savedPost,\n      userId: this.userService.user?.userID,\n    });\n\n    if (savedPost.userID !== post.userID) {\n      this.socketService.emit(\n        SocketEvent.NOTIFICATION_CREATE,\n        this.notificationService.buildTagNotification(post)\n      );\n    }\n\n    return savedPost;\n  }\n\n  async untag(post: Post, tag: Tag): Promise<Post> {\n    post.tags = post.tags.filter((t) => t.name != tag.name);\n    const update: Partial<Post> = { tags: post.tags };\n\n    if (!post.displayAttributes) {\n      return await this.postService.update(post.postID, update);\n    }\n\n    if (tag.specialAttributes) {\n      update.displayAttributes = await this.fabricUtils.resetTagFeatures(\n        post.postID\n      );\n    }\n\n    const savedPost = await this.postService.update(post.postID, update);\n\n    this.socketService.emit(SocketEvent.POST_TAG_REMOVE, {\n      tag,\n      post: savedPost,\n      userId: this.userService.user?.userID,\n    });\n\n    return savedPost;\n  }\n\n  async updateBoardTask(\n    boardID: string,\n    title: string,\n    message?: string\n  ): Promise<Board> {\n    const task = Object.assign(\n      {},\n      title === null ? null : { title },\n      message === null ? null : { message }\n    );\n\n    const board: Board = await this.boardService.update(boardID, { task });\n    this.socketService.emit(SocketEvent.BOARD_TASK_UPDATE, board);\n\n    return board;\n  }\n\n  async updateBoardName(boardID: string, name: string): Promise<Board> {\n    const board: Board = await this.boardService.update(boardID, { name });\n    this.socketService.emit(SocketEvent.BOARD_NAME_UPDATE, board);\n\n    return board;\n  }\n\n  async updateBoardImage(\n    boardID: string,\n    file: string | null,\n    settings?: any\n  ): Promise<Board> {\n    if (file === null) {\n      const board: Board = await this.boardService.update(boardID, {\n        bgImage: null,\n      });\n      this.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n      return board;\n    } else {\n      return new Promise<Board>((resolve) => {\n        fabric.Image.fromURL(file, async (image) => {\n          const url = await this.fileUploadService.upload(file);\n          const imgSettings =\n            settings ?? this.fabricUtils.createImageSettings(image);\n\n          const board: Board = await this.boardService.update(boardID, {\n            bgImage: { url, imgSettings },\n          });\n          this.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n\n          resolve(board);\n        });\n      });\n    }\n  }\n\n  async updateBoardImageSettings(\n    boardID: string,\n    imgSettings: ImageSettings\n  ): Promise<Board> {\n    const oldBoard = await this.boardService.get(boardID);\n    const url = oldBoard.bgImage?.url;\n\n    if (url) {\n      const board: Board = await this.boardService.update(boardID, {\n        bgImage: { url, imgSettings },\n      });\n      this.socketService.emit(SocketEvent.BOARD_IMAGE_UPDATE, board);\n      return board;\n    }\n    return oldBoard;\n  }\n\n  async updateBoardPermissions(\n    boardID: string,\n    permissions: BoardPermissions\n  ): Promise<Board> {\n    const oldBoard = await this.boardService.get(boardID);\n    if (oldBoard.permissions.allowTracing !== permissions.allowTracing) {\n      if (permissions.allowTracing) {\n        this.socketService.emit(\n          SocketEvent.TRACING_ENABLED,\n          permissions.allowTracing\n        );\n      } else {\n        this.socketService.emit(\n          SocketEvent.TRACING_DISABLED,\n          permissions.allowTracing\n        );\n      }\n    }\n    const board: Board = await this.boardService.update(boardID, {\n      permissions,\n    });\n    this.socketService.emit(SocketEvent.BOARD_PERMISSIONS_UPDATE, board);\n\n    return board;\n  }\n\n  async updateBoardTags(boardID: string, tags: Tag[]): Promise<Board> {\n    const board: Board = await this.boardService.update(boardID, { tags });\n    this.socketService.emit(SocketEvent.BOARD_TAGS_UPDATE, board);\n\n    return board;\n  }\n\n  async updateBoardUpvotes(\n    boardID: string,\n    upvoteLimit: number\n  ): Promise<Board> {\n    const board: Board = await this.boardService.update(boardID, {\n      upvoteLimit,\n    });\n    this.socketService.emit(SocketEvent.BOARD_UPVOTE_UPDATE, board);\n\n    return board;\n  }\n\n  async runDistributionWorkflow(workflow: DistributionWorkflow): Promise<void> {\n    await this.workflowService.runDistribution(workflow.workflowID);\n\n    this.socketService.emit(SocketEvent.WORKFLOW_RUN_DISTRIBUTION, workflow);\n  }\n\n  async runTaskWorkflow(workflow: TaskWorkflow): Promise<void> {\n    await this.workflowService.runTask(workflow.workflowID);\n\n    this.socketService.emit(SocketEvent.WORKFLOW_RUN_TASK, workflow);\n  }\n\n  async runAIClassificationWorkflow(workflow: AIClassificationWorkflow): Promise<void> {\n    await this.workflowService.runAIClassification(workflow.workflowID);\n\n    this.socketService.emit(SocketEvent.WORKFLOW_RUN_AI_CLASSIFICATION, workflow);\n  }\n\n  async readPost(postID: string) {\n    this.socketService.emit(SocketEvent.POST_READ, postID);\n  }\n\n  get centerPos(): Position {\n    return this.fabricUtils._canvas.getCenter();\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}