{"ast":null,"code":"import _asyncToGenerator from \"/Users/marieklinaeva/github/ck-board/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ViewType } from 'src/app/models/board';\nimport { Role } from 'src/app/models/user';\nimport { GroupTaskStatus, TaskActionType, TaskWorkflowType } from 'src/app/models/workflow';\nimport { BucketsModalComponent } from '../buckets-modal/buckets-modal.component';\nimport { ListModalComponent } from '../list-modal/list-modal.component';\nimport { SwiperComponent } from 'swiper/angular';\nimport SwiperCore, { EffectCards } from 'swiper';\nimport Converters from 'src/app/utils/converters';\nimport { STUDENT_POST_COLOR, TEACHER_POST_COLOR, SocketEvent } from 'src/app/utils/constants';\nimport { interval } from 'rxjs';\nimport { ManageGroupModalComponent } from '../groups/manage-group-modal/manage-group-modal.component';\nimport { AddPostComponent } from '../add-post-modal/add-post.component';\nimport { PostType } from 'src/app/models/post';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/user.service\";\nimport * as i2 from \"src/app/services/project.service\";\nimport * as i3 from \"src/app/services/board.service\";\nimport * as i4 from \"src/app/services/post.service\";\nimport * as i5 from \"src/app/services/workflow.service\";\nimport * as i6 from \"src/app/services/group.service\";\nimport * as i7 from \"src/app/services/socket.service\";\nimport * as i8 from \"src/app/services/snackbar.service\";\nimport * as i9 from \"src/app/services/canvas.service\";\nimport * as i10 from \"src/app/services/groupTask.service\";\nimport * as i11 from \"@angular/router\";\nimport * as i12 from \"@angular/material/dialog\";\nfunction CkWorkspaceComponent_app_toolbar_1_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"CK Workspace - \", ctx_r9.board.name, \"\");\n  }\n}\nfunction CkWorkspaceComponent_app_toolbar_1_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_app_toolbar_1_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.copyEmbedCode());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"file_copy\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CkWorkspaceComponent_app_toolbar_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"app-toolbar\", 9);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_app_toolbar_1_span_1_Template, 2, 1, \"span\", 4);\n    i0.ɵɵtemplate(2, CkWorkspaceComponent_app_toolbar_1_button_2_Template, 3, 0, \"button\", 10);\n    i0.ɵɵelement(3, \"span\", 11);\n    i0.ɵɵelementStart(4, \"button\", 12)(5, \"mat-icon\");\n    i0.ɵɵtext(6, \"keyboard_return\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(7, \"app-view-navigation\", 13)(8, \"app-toolbar-menu\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"user\", ctx_r0.user);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.board);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user.role === ctx_r0.Role.TEACHER);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"routerLink\", \"/project/\" + ctx_r0.project.projectID + \"/board/\" + ctx_r0.board.boardID);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"boardID\", ctx_r0.board.boardID)(\"currentView\", ctx_r0.viewType);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"board\", ctx_r0.board)(\"project\", ctx_r0.project);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_5_mat_list_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-list-item\")(1, \"mat-icon\", 18);\n    i0.ɵɵtext(2, \"timeline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h3\", 19);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 20);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"span\", 11);\n    i0.ɵɵelementStart(8, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_ng_container_5_mat_list_item_1_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r19);\n      const task_r17 = restoredCtx.$implicit;\n      const ctx_r18 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r18.begin(task_r17));\n    });\n    i0.ɵɵtext(9, \"Begin Task\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const task_r17 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", task_r17.workflow.name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", task_r17.group.name, \": \", task_r17.workflow.prompt, \" \");\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_mat_list_5_ng_container_5_mat_list_item_1_Template, 10, 3, \"mat-list-item\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r13 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r13.inactiveGroupTasks);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r26);\n      const task_r21 = i0.ɵɵnextContext().$implicit;\n      const ctx_r24 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r24.view(task_r21));\n    });\n    i0.ɵɵtext(1, \"Resume Task\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r28);\n      const ctx_r27 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r27.close());\n    });\n    i0.ɵɵtext(1, \"Hide Task\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-list-item\")(1, \"mat-icon\", 18);\n    i0.ɵɵtext(2, \"timeline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h3\", 19);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 20);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"span\", 11);\n    i0.ɵɵtemplate(8, CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_8_Template, 2, 0, \"button\", 22);\n    i0.ɵɵtemplate(9, CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_button_9_Template, 2, 0, \"button\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const task_r21 = ctx.$implicit;\n    const ctx_r20 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", task_r21.workflow.name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", task_r21.group.name, \": \", task_r21.workflow.prompt, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r20.runningGroupTask && ctx_r20.runningGroupTask.groupTask.groupTaskID !== task_r21.groupTask.groupTaskID || !ctx_r20.runningGroupTask);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r20.runningGroupTask && ctx_r20.runningGroupTask.groupTask.groupTaskID === task_r21.groupTask.groupTaskID);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_mat_list_5_ng_container_11_mat_list_item_1_Template, 10, 5, \"mat-list-item\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r14.activeGroupTasks);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r35 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r35);\n      const task_r30 = i0.ɵɵnextContext().$implicit;\n      const ctx_r33 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r33.view(task_r30));\n    });\n    i0.ɵɵtext(1, \"View Task\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r37 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r37);\n      const ctx_r36 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r36.close());\n    });\n    i0.ɵɵtext(1, \"Hide Task\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-list-item\")(1, \"mat-icon\", 18);\n    i0.ɵɵtext(2, \"timeline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h3\", 19);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 20);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"span\", 11);\n    i0.ɵɵtemplate(8, CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_8_Template, 2, 0, \"button\", 22);\n    i0.ɵɵtemplate(9, CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_button_9_Template, 2, 0, \"button\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const task_r30 = ctx.$implicit;\n    const ctx_r29 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", task_r30.workflow.name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", task_r30.group.name, \": \", task_r30.workflow.prompt, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r29.runningGroupTask && ctx_r29.runningGroupTask.groupTask.groupTaskID !== task_r30.groupTask.groupTaskID || !ctx_r29.runningGroupTask);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r29.runningGroupTask && ctx_r29.runningGroupTask.groupTask.groupTaskID === task_r30.groupTask.groupTaskID);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_ng_container_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_mat_list_5_ng_container_17_mat_list_item_1_Template, 10, 5, \"mat-list-item\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r15.completeGroupTasks);\n  }\n}\nfunction CkWorkspaceComponent_mat_list_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r39 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-list\")(1, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r39);\n      const ctx_r38 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r38.showInactive = !ctx_r38.showInactive);\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementStart(3, \"mat-icon\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(5, CkWorkspaceComponent_mat_list_5_ng_container_5_Template, 2, 1, \"ng-container\", 4);\n    i0.ɵɵelement(6, \"mat-divider\");\n    i0.ɵɵelementStart(7, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r39);\n      const ctx_r40 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r40.showActive = !ctx_r40.showActive);\n    });\n    i0.ɵɵtext(8);\n    i0.ɵɵelementStart(9, \"mat-icon\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(11, CkWorkspaceComponent_mat_list_5_ng_container_11_Template, 2, 1, \"ng-container\", 4);\n    i0.ɵɵelement(12, \"mat-divider\");\n    i0.ɵɵelementStart(13, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_mat_list_5_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r39);\n      const ctx_r41 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r41.showCompleted = !ctx_r41.showCompleted);\n    });\n    i0.ɵɵtext(14);\n    i0.ɵɵelementStart(15, \"mat-icon\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(17, CkWorkspaceComponent_mat_list_5_ng_container_17_Template, 2, 1, \"ng-container\", 4);\n    i0.ɵɵelement(18, \"mat-divider\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Pending Tasks (\", ctx_r2.inactiveGroupTasks.length, \") \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.showInactive ? \"expand_less\" : \"expand_more\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showInactive);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Active Tasks (\", ctx_r2.activeGroupTasks.length, \") \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.showActive ? \"expand_less\" : \"expand_more\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showActive);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Completed Tasks (\", ctx_r2.completeGroupTasks.length, \") \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.showCompleted ? \"expand_less\" : \"expand_more\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showCompleted);\n  }\n}\nfunction CkWorkspaceComponent_div_7_li_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1, \"Comment on each post at least once!\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_7_li_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1, \"Tag each post at least once!\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_7_li_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r44 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Create \", ctx_r44.numberOfPosts(ctx_r44.runningGroupTask), \" posts\");\n  }\n}\nfunction CkWorkspaceComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h1\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h2\", 23);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"section\")(6, \"ul\", 24);\n    i0.ɵɵtemplate(7, CkWorkspaceComponent_div_7_li_7_Template, 2, 0, \"li\", 4);\n    i0.ɵɵtemplate(8, CkWorkspaceComponent_div_7_li_8_Template, 2, 0, \"li\", 4);\n    i0.ɵɵtemplate(9, CkWorkspaceComponent_div_7_li_9_Template, 2, 1, \"li\", 4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r3.runningGroupTask.group.name, \": \", ctx_r3.runningGroupTask.workflow.name, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r3.runningGroupTask.workflow.prompt, \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasCommentRequirement(ctx_r3.runningGroupTask));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasTagRequirement(ctx_r3.runningGroupTask));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasCreatePostRequirement(ctx_r3.runningGroupTask));\n  }\n}\nfunction CkWorkspaceComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \" No task selected! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_mat_spinner_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\", 26);\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" No posts to review! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" Create a Post! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" No submitted posts! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" No reviewed posts! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r59 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 35);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template_div_click_0_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementStart(1, \"app-html-post\", 36);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template_app_html_post_click_1_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"div\", 37)(3, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r59);\n      const ctx_r58 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r58.swiper.swiperRef.slidePrev());\n    });\n    i0.ɵɵtext(4, \"Previous\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r59);\n      const ctx_r60 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r60.swiper.swiperRef.slideNext());\n    });\n    i0.ɵɵtext(6, \"Next\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const htmlPost_r54 = i0.ɵɵnextContext().$implicit;\n    const ctx_r55 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"post\", htmlPost_r54)(\"disableDownload\", true)(\"onCommentEvent\", ctx_r55.onCommentEvent)(\"onTagEvent\", ctx_r55.onTagEvent);\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_5_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, CkWorkspaceComponent_div_10_swiper_5_1_ng_template_0_Template, 7, 4, \"ng-template\", 34);\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"swiper\", 33);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_div_10_swiper_5_1_Template, 1, 0, null, 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r49 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"effect\", \"cards\")(\"grabCursor\", true);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r49.posts);\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r68 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 35);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template_div_click_0_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementStart(1, \"app-html-post\", 39);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template_app_html_post_click_1_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"div\", 37)(3, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r68);\n      const ctx_r67 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r67.swiper.swiperRef.slidePrev());\n    });\n    i0.ɵɵtext(4, \"Previous\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r68);\n      const ctx_r69 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r69.swiper.swiperRef.slideNext());\n    });\n    i0.ɵɵtext(6, \"Next\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const htmlPost_r63 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"post\", htmlPost_r63)(\"disableDownload\", true);\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_6_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, CkWorkspaceComponent_div_10_swiper_6_1_ng_template_0_Template, 7, 2, \"ng-template\", 34);\n  }\n}\nfunction CkWorkspaceComponent_div_10_swiper_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"swiper\", 33);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_div_10_swiper_6_1_Template, 1, 0, null, 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r50 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"effect\", \"cards\")(\"grabCursor\", true);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r50.submittedPosts);\n  }\n}\nfunction CkWorkspaceComponent_div_10_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r72 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 40);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_div_10_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r72);\n      const ctx_r71 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r71.addPost());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"add\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_9_li_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const member_r74 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(member_r74.username);\n  }\n}\nfunction CkWorkspaceComponent_div_10_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-card\", 41)(2, \"div\", 42)(3, \"label\", 43);\n    i0.ɵɵtext(4, \"Your Group's Progress\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"mat-progress-bar\", 44);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\")(7, \"label\", 43);\n    i0.ɵɵtext(8, \"Avg. Group's Progress\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"mat-progress-bar\", 45);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"section\")(11, \"h4\", 46);\n    i0.ɵɵtext(12, \"Group Members:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"ul\", 47);\n    i0.ɵɵtemplate(14, CkWorkspaceComponent_div_10_div_9_li_14_Template, 2, 1, \"li\", 17);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r52 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"value\", ctx_r52.currentGroupProgress);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r52.averageGroupProgress);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r52.members);\n  }\n}\nfunction CkWorkspaceComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtemplate(1, CkWorkspaceComponent_div_10_div_1_Template, 2, 0, \"div\", 28);\n    i0.ɵɵtemplate(2, CkWorkspaceComponent_div_10_div_2_Template, 2, 0, \"div\", 28);\n    i0.ɵɵtemplate(3, CkWorkspaceComponent_div_10_div_3_Template, 2, 0, \"div\", 28);\n    i0.ɵɵtemplate(4, CkWorkspaceComponent_div_10_div_4_Template, 2, 0, \"div\", 28);\n    i0.ɵɵtemplate(5, CkWorkspaceComponent_div_10_swiper_5_Template, 2, 3, \"swiper\", 29);\n    i0.ɵɵtemplate(6, CkWorkspaceComponent_div_10_swiper_6_Template, 2, 3, \"swiper\", 29);\n    i0.ɵɵelementStart(7, \"div\", 30);\n    i0.ɵɵtemplate(8, CkWorkspaceComponent_div_10_button_8_Template, 3, 0, \"button\", 31);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, CkWorkspaceComponent_div_10_div_9_Template, 15, 3, \"div\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && ctx_r6.runningGroupTask.workflow.type !== ctx_r6.TaskWorkflowType.GENERATION && (!ctx_r6.posts || ctx_r6.posts.length === 0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && ctx_r6.runningGroupTask.workflow.type === ctx_r6.TaskWorkflowType.GENERATION && !ctx_r6.showSubmittedPosts && (!ctx_r6.posts || ctx_r6.posts.length === 0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && ctx_r6.runningGroupTask.workflow.type === ctx_r6.TaskWorkflowType.GENERATION && ctx_r6.showSubmittedPosts && (!ctx_r6.submittedPosts || ctx_r6.submittedPosts.length === 0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && ctx_r6.runningGroupTask.workflow.type !== ctx_r6.TaskWorkflowType.GENERATION && ctx_r6.showSubmittedPosts && (!ctx_r6.submittedPosts || ctx_r6.submittedPosts.length === 0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && !ctx_r6.showSubmittedPosts && ctx_r6.posts && ctx_r6.posts.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask && ctx_r6.showSubmittedPosts && ctx_r6.submittedPosts && ctx_r6.submittedPosts.length > 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r6.loading && ctx_r6.runningGroupTask && ctx_r6.runningGroupTask.workflow.type === ctx_r6.TaskWorkflowType.GENERATION && !ctx_r6.createMorePosts(ctx_r6.runningGroupTask) && ctx_r6.runningGroupTask.groupTask.status !== ctx_r6.GroupTaskStatus.COMPLETE);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.runningGroupTask);\n  }\n}\nfunction CkWorkspaceComponent_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r76 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 48);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_button_11_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r76);\n      const ctx_r75 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r75.toggleSubmittedPosts());\n    });\n    i0.ɵɵtext(1, \" View Completed \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CkWorkspaceComponent_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r78 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 48);\n    i0.ɵɵlistener(\"click\", function CkWorkspaceComponent_button_12_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r78);\n      const ctx_r77 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r77.toggleSubmittedPosts());\n    });\n    i0.ɵɵtext(1, \" View Drafts \");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function () {\n  return {\n    \"padding-bottom\": \"64px\"\n  };\n};\n// install Swiper modules\nSwiperCore.use([EffectCards]);\nexport class CkWorkspaceComponent {\n  constructor(userService, projectService, boardService, postService, workflowService, groupService, socketService, snackbarService, canvasService, groupTaskService, converters, router, activatedRoute, dialog) {\n    var _this = this;\n    this.userService = userService;\n    this.projectService = projectService;\n    this.boardService = boardService;\n    this.postService = postService;\n    this.workflowService = workflowService;\n    this.groupService = groupService;\n    this.socketService = socketService;\n    this.snackbarService = snackbarService;\n    this.canvasService = canvasService;\n    this.groupTaskService = groupTaskService;\n    this.converters = converters;\n    this.router = router;\n    this.activatedRoute = activatedRoute;\n    this.dialog = dialog;\n    this.loading = false;\n    this.showInactive = true;\n    this.showActive = true;\n    this.showCompleted = false;\n    this.inactiveGroupTasks = [];\n    this.activeGroupTasks = [];\n    this.completeGroupTasks = [];\n    this.listeners = [];\n    this.posts = [];\n    this.submittedPosts = [];\n    this.members = [];\n    this.showSubmittedPosts = false;\n    this.Role = Role;\n    this.TaskActionType = TaskActionType;\n    this.TaskWorkflowType = TaskWorkflowType;\n    this.GroupTaskStatus = GroupTaskStatus;\n    this.embedded = false; // If standalone board embed\n    this.viewType = ViewType.WORKSPACE;\n    this.onCommentEvent = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (postID, type) {\n        if (!_this.runningGroupTask) return;\n        const workflowID = _this.runningGroupTask.workflow.workflowID;\n        const groupTaskID = _this.runningGroupTask.groupTask.groupTaskID;\n        if (type == 'add') {\n          yield _this.workflowService.updateTaskProgress(workflowID, groupTaskID, postID, -1, 'COMMENT');\n        } else {\n          yield _this.workflowService.updateTaskProgress(workflowID, groupTaskID, postID, 1, 'COMMENT');\n        }\n        const post = _this.posts.find(post => post.post.postID === postID);\n        if (post && _this.postSubmittable(post)) {\n          yield _this.submitPost(post);\n        }\n      });\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    this.onTagEvent = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(function* (postID, type) {\n        if (!_this.runningGroupTask) return;\n        const workflowID = _this.runningGroupTask.workflow.workflowID;\n        const groupTaskID = _this.runningGroupTask.groupTask.groupTaskID;\n        if (type == 'add') {\n          yield _this.workflowService.updateTaskProgress(workflowID, groupTaskID, postID, -1, 'TAG');\n        } else {\n          yield _this.workflowService.updateTaskProgress(workflowID, groupTaskID, postID, 1, 'TAG');\n        }\n        const post = _this.posts.find(post => post.post.postID === postID);\n        if (post && _this.postSubmittable(post)) {\n          yield _this.submitPost(post);\n        }\n      });\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    this.activatedRoute.queryParams.subscribe(params => {\n      if (params.embedded === 'true') {\n        this.embedded = true;\n      }\n    });\n  }\n  ngOnInit() {\n    this.user = this.userService.user;\n    this.loadWorkspaceData();\n  }\n  loadWorkspaceData() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d;\n      const map = _this2.activatedRoute.snapshot.paramMap;\n      let boardID, projectID;\n      if (map.has('boardID') && map.has('projectID')) {\n        boardID = (_a = _this2.activatedRoute.snapshot.paramMap.get('boardID')) !== null && _a !== void 0 ? _a : '';\n        projectID = (_b = _this2.activatedRoute.snapshot.paramMap.get('projectID')) !== null && _b !== void 0 ? _b : '';\n      } else {\n        return _this2.router.navigate(['error']);\n      }\n      _this2.board = yield _this2.boardService.get(boardID);\n      _this2.project = yield _this2.projectService.get(projectID);\n      _this2.group = yield _this2.groupService.getByProjectUser(projectID, _this2.user.userID);\n      if (!((_c = _this2.board.viewSettings) === null || _c === void 0 ? void 0 : _c.allowWorkspace)) {\n        _this2.router.navigateByUrl(`project/${projectID}/board/${boardID}/${(_d = _this2.board.defaultView) === null || _d === void 0 ? void 0 : _d.toLowerCase()}`);\n      }\n      const tasks = yield _this2.workflowService.getGroupTasks(boardID, 'expanded');\n      tasks.forEach(t => {\n        if (t.groupTask.status == GroupTaskStatus.INACTIVE) {\n          _this2.inactiveGroupTasks.push(t);\n        } else if (t.groupTask.status == GroupTaskStatus.ACTIVE) {\n          _this2.activeGroupTasks.push(t);\n        } else if (t.groupTask.status == GroupTaskStatus.COMPLETE) {\n          _this2.completeGroupTasks.push(t);\n        }\n      });\n      _this2.socketService.connect(_this2.user.userID, _this2.board.boardID);\n      return true;\n    })();\n  }\n  begin(expandedGroupTask) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const groupTask = expandedGroupTask.groupTask;\n      groupTask.status = GroupTaskStatus.ACTIVE;\n      yield _this3.workflowService.updateGroupTask(groupTask.groupTaskID, {\n        status: GroupTaskStatus.ACTIVE\n      });\n      _this3.inactiveGroupTasks = _this3.inactiveGroupTasks.filter(g => g.groupTask.groupTaskID !== groupTask.groupTaskID);\n      _this3.activeGroupTasks.push(expandedGroupTask);\n      _this3.view(expandedGroupTask);\n    })();\n  }\n  view(groupTask) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      _this4.loading = true;\n      _this4.runningGroupTask = groupTask;\n      _this4.runningGroupTask.groupTask = yield _this4.groupTaskService.getGroupTask(_this4.runningGroupTask.group.groupID, _this4.runningGroupTask.workflow.workflowID);\n      _this4.currentGroupProgress = _this4._calcGroupProgress(_this4.runningGroupTask);\n      _this4.averageGroupProgress = yield _this4._calcAverageProgress(_this4.runningGroupTask);\n      let postIDs = [];\n      if (groupTask.groupTask.status == GroupTaskStatus.COMPLETE) {\n        postIDs = postIDs.concat(Object.keys(groupTask.groupTask.progress));\n      } else {\n        postIDs = postIDs.concat(groupTask.groupTask.posts);\n      }\n      const submittedPostIDs = [...Object.keys(groupTask.groupTask.progress)].filter(postID => groupTask.groupTask.progress[postID].reduce((partialSum, a) => partialSum + a.amountRequired, 0) == 0);\n      const posts = yield _this4.postService.getAll(postIDs);\n      const submittedPosts = yield _this4.postService.getAll(submittedPostIDs);\n      _this4.posts = yield _this4.converters.toHTMLPosts(posts);\n      _this4.submittedPosts = yield _this4.converters.toHTMLPosts(submittedPosts);\n      _this4.members = yield _this4.userService.getMultipleByIds(groupTask.group.members);\n      _this4.loading = false;\n      // Show submitted posts by default in generative task workflow\n      if (_this4.runningGroupTask.workflow.type === TaskWorkflowType.GENERATION) {\n        _this4.showSubmittedPosts = true;\n      } else {\n        _this4.showSubmittedPosts = false;\n      }\n      _this4._startListening();\n    })();\n  }\n  close() {\n    this.runningGroupTask = null;\n    this.currentGroupProgress = 0;\n    this.averageGroupProgress = 0;\n    this.posts = [];\n    this.members = [];\n    this.listeners.map(l => l.unsubscribe());\n  }\n  submitPost(post) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this5.runningGroupTask) return;\n      const task = _this5.runningGroupTask.groupTask;\n      _this5.runningGroupTask.groupTask = yield _this5.workflowService.submitPost(task.groupTaskID, post.post.postID);\n      _this5.posts = _this5.posts.filter(p => p.post.postID !== post.post.postID);\n      // this.submittedPosts.push(post);\n      _this5.currentGroupProgress = _this5._calcGroupProgress(_this5.runningGroupTask);\n      if (_this5.currentGroupProgress >= 100) {\n        yield _this5.markComplete();\n      }\n    })();\n  }\n  markComplete() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this6.runningGroupTask) return;\n      const task = _this6.runningGroupTask.groupTask;\n      _this6.runningGroupTask.groupTask = yield _this6.workflowService.updateGroupTask(task.groupTaskID, {\n        status: GroupTaskStatus.COMPLETE\n      });\n      _this6.activeGroupTasks = _this6.activeGroupTasks.filter(g => g.groupTask.groupTaskID !== task.groupTaskID);\n      _this6.completeGroupTasks.push(_this6.runningGroupTask);\n      _this6.close();\n    })();\n  }\n  showBucketsModal() {\n    this._openDialog(BucketsModalComponent, {\n      board: this.board,\n      user: this.user,\n      allowMovePostToBoard: false\n    });\n  }\n  showListModal() {\n    this._openDialog(ListModalComponent, {\n      board: this.board\n    });\n  }\n  openGroupDialog() {\n    this.dialog.open(ManageGroupModalComponent, {\n      data: {\n        project: this.project\n      }\n    });\n  }\n  postSubmittable(post) {\n    if (!this.runningGroupTask) return false;\n    const progress = this.runningGroupTask.groupTask.progress;\n    const postProgress = progress[post.post.postID];\n    if (!postProgress) return false;\n    const amountRequired = postProgress.reduce((sum, a) => sum + a.amountRequired, 0);\n    return amountRequired == 0;\n  }\n  createMorePosts(groupTask) {\n    return groupTask.workflow.requiredActions.filter(a => a.type === TaskActionType.CREATE_POST)[0].amountRequired === Object.keys(groupTask.groupTask.progress).length;\n  }\n  taskSubmittable(groupTask) {\n    var _a;\n    return ((_a = this.runningGroupTask) === null || _a === void 0 ? void 0 : _a.workflow.type) === TaskWorkflowType.GENERATION ? this.currentGroupProgress >= 100 && groupTask.groupTask.status == GroupTaskStatus.ACTIVE : this.currentGroupProgress == 100 && groupTask.groupTask.posts.length == 0 && groupTask.groupTask.status == GroupTaskStatus.ACTIVE;\n  }\n  hasCommentRequirement(runningGroupTask) {\n    return runningGroupTask.workflow.requiredActions.find(a => a.type == TaskActionType.COMMENT) != undefined;\n  }\n  hasTagRequirement(runningGroupTask) {\n    return runningGroupTask.workflow.requiredActions.find(a => a.type == TaskActionType.TAG) != undefined;\n  }\n  hasCreatePostRequirement(runningGroupTask) {\n    return runningGroupTask.workflow.requiredActions.find(a => a.type == TaskActionType.CREATE_POST) != undefined;\n  }\n  numberOfPosts(runningGroupTask) {\n    var _a;\n    return (_a = runningGroupTask.workflow.requiredActions.find(a => a.type == TaskActionType.CREATE_POST)) === null || _a === void 0 ? void 0 : _a.amountRequired;\n  }\n  togglePostsSlider() {\n    this.showSubmittedPosts = !this.showSubmittedPosts;\n  }\n  addPost() {\n    var _this7 = this;\n    const dialogData = {\n      disableCreation: true,\n      board: this.board,\n      user: this.user,\n      tagRequired: this.hasTagRequirement(this.runningGroupTask),\n      onComplete: function () {\n        var _ref3 = _asyncToGenerator(function* (post) {\n          var _a, _b;\n          if (_this7.runningGroupTask) {\n            post.type = PostType.WORKFLOW;\n            const destinationType = PostType[(_a = _this7.runningGroupTask) === null || _a === void 0 ? void 0 : _a.workflow.destinations[0].type];\n            if (destinationType === PostType.BUCKET) {\n              post.boardID = _this7.board.boardID;\n            } else {\n              const displayAttributes = {\n                position: {\n                  left: 150,\n                  top: 150\n                },\n                lock: !_this7.board.permissions.allowStudentMoveAny,\n                fillColor: _this7.defaultPostFill()\n              };\n              post.boardID = (_b = _this7.runningGroupTask) === null || _b === void 0 ? void 0 : _b.workflow.destinations[0].id;\n              post.displayAttributes = displayAttributes;\n            }\n            const htmlPost = yield _this7.converters.toHTMLPost(post);\n            _this7.posts.push(htmlPost);\n            _this7.postService.create(post);\n            _this7.runningGroupTask.groupTask.progress[post.postID] = _this7.runningGroupTask.workflow.requiredActions.filter(action => action.type !== TaskActionType.CREATE_POST);\n            _this7.runningGroupTask.groupTask.posts.push(post.postID);\n            const t = yield _this7.workflowService.updateGroupTask(_this7.runningGroupTask.groupTask.groupTaskID, {\n              posts: _this7.posts.map(p => p.post.postID),\n              progress: _this7.runningGroupTask.groupTask.progress\n            });\n            _this7.currentGroupProgress = _this7._calcGroupProgress(_this7.runningGroupTask);\n            _this7.averageGroupProgress = yield _this7._calcAverageProgress(_this7.runningGroupTask);\n            _this7.socketService.emit(SocketEvent.WORKFLOW_PROGRESS_UPDATE, [_this7.runningGroupTask.groupTask]);\n            for (const _ of post.tags) {\n              yield _this7.onTagEvent(post.postID, 'add');\n            }\n            yield _this7.submitPost(htmlPost);\n          }\n          return;\n        });\n        return function onComplete(_x5) {\n          return _ref3.apply(this, arguments);\n        };\n      }()\n    };\n    this.dialog.open(AddPostComponent, {\n      width: '500px',\n      data: dialogData\n    });\n  }\n  toggleSubmittedPosts() {\n    this.showSubmittedPosts = !this.showSubmittedPosts;\n  }\n  _startListening() {\n    var _this8 = this;\n    this.listeners.push(this.socketService.listen(SocketEvent.WORKFLOW_PROGRESS_UPDATE, /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(function* (updates) {\n        var _a;\n        if (!_this8.runningGroupTask) return;\n        const found = updates.find(u => {\n          var _a;\n          return u.groupTaskID == ((_a = _this8.runningGroupTask) === null || _a === void 0 ? void 0 : _a.groupTask.groupTaskID);\n        });\n        if (found) {\n          _this8.runningGroupTask.groupTask = found;\n          if (((_a = _this8.runningGroupTask) === null || _a === void 0 ? void 0 : _a.workflow.type) === TaskWorkflowType.GENERATION) {\n            const _newPosts = found.posts.filter(p => !_this8.posts.map(post => post.post.postID).includes(p));\n            const newPosts = yield _this8.postService.getAll(_newPosts);\n            const htmlPosts = yield _this8.converters.toHTMLPosts(newPosts);\n            _this8.posts = _this8.posts.concat(htmlPosts);\n          }\n          _this8.currentGroupProgress = _this8._calcGroupProgress(_this8.runningGroupTask);\n        }\n      });\n      return function (_x6) {\n        return _ref4.apply(this, arguments);\n      };\n    }()));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_UPVOTE_ADD, result => {\n      const found = this.posts.find(p => p.post.postID == result.upvote.postID);\n      if (found) {\n        found.upvotes.push(result.upvote);\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_UPVOTE_REMOVE, result => {\n      const found = this.posts.find(p => p.post.postID == result.upvote.postID);\n      if (found) {\n        found.upvotes = found.upvotes.filter(upvote => upvote.upvoteID != result.upvote.upvoteID);\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_COMMENT_ADD, result => {\n      const found = this.posts.find(p => p.post.postID == result.comment.postID);\n      if (found) {\n        found.comments += 1;\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_COMMENT_REMOVE, result => {\n      const found = this.posts.find(p => p.post.postID == result.comment.postID);\n      if (found) {\n        found.comments -= 1;\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_TAG_ADD, ({\n      post\n    }) => {\n      const found = this.posts.find(p => p.post.postID == post.postID);\n      if (found) {\n        found.post = post;\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.POST_TAG_REMOVE, ({\n      post\n    }) => {\n      const found = this.posts.find(p => p.post.postID == post.postID);\n      if (found) {\n        found.post = post;\n      }\n    }));\n    this.listeners.push(this.socketService.listen(SocketEvent.WORKFLOW_POST_SUBMIT, postID => {\n      const submittedPost = this.posts.find(p => p.post.postID == postID);\n      this.posts = this.posts.filter(p => p.post.postID != postID);\n      if (submittedPost) this.submittedPosts.push(submittedPost);\n    }));\n    this.listeners.push(interval(30 * 1000).subscribe( /*#__PURE__*/_asyncToGenerator(function* () {\n      _this8.averageGroupProgress = yield _this8._calcAverageProgress(_this8.runningGroupTask);\n    })));\n  }\n  copyEmbedCode() {\n    const url = window.location.href + '?embedded=true';\n    navigator.clipboard.writeText(url);\n  }\n  signOut() {\n    this.userService.logout();\n    this.router.navigate(['login']);\n  }\n  ngOnDestroy() {\n    this.listeners.map(l => l.unsubscribe());\n    this.socketService.disconnect(this.user.userID, this.board.boardID);\n  }\n  _calcGroupProgress(task) {\n    if (!task) return 0;\n    // get all posts' progress\n    const values = Object.keys(task.groupTask.progress).map(function (key) {\n      return task.groupTask.progress[key];\n    });\n    // sum all amountRequired for each action per post\n    // i.e. Post A (1 tag req, 1 comment req) + Post B (1 tag req, 0 comments required)\n    let remaining = values.reduce((partialSum, a) => partialSum + a.reduce((partial, b) => partial + b.amountRequired, 0), 0);\n    // nothing left to do\n    if (remaining == 0 && task.workflow.type !== TaskWorkflowType.GENERATION) return 100;\n    // sum both required tags (1) and required comments (1) = 2\n    // multiple by number of posts since those requirements are per-post\n    let total = task.workflow.requiredActions.filter(a => a.type !== TaskActionType.CREATE_POST).reduce((partialSum, a) => partialSum + a.amountRequired, 0);\n    if (task.workflow.type === TaskWorkflowType.GENERATION) {\n      const createPosts = task.workflow.requiredActions.filter(a => a.type === TaskActionType.CREATE_POST)[0].amountRequired;\n      const postsCreated = Object.keys(task.groupTask.progress).length;\n      const actionPerPost = total;\n      if (total) total = total * createPosts + createPosts;else total = createPosts;\n      remaining += createPosts - postsCreated;\n      remaining += (createPosts - postsCreated) * actionPerPost;\n    } else {\n      total *= values.length;\n    }\n    return (total - remaining) / total * 100;\n  }\n  _calcAverageProgress(task) {\n    var _this9 = this;\n    return _asyncToGenerator(function* () {\n      if (!task) return 0;\n      const tasks = yield _this9.workflowService.getGroupTasksByWorkflow(task.workflow.workflowID, 'expanded');\n      const totalProgress = tasks.reduce(partialSum => partialSum + _this9._calcGroupProgress(task), 0);\n      return totalProgress / tasks.length;\n    })();\n  }\n  _openDialog(component, data) {\n    this.dialog.open(component, {\n      maxWidth: 1280,\n      width: '95vw',\n      autoFocus: false,\n      data: data\n    });\n  }\n  defaultPostFill() {\n    var _a;\n    return ((_a = this.userService.user) === null || _a === void 0 ? void 0 : _a.role) === Role.TEACHER ? TEACHER_POST_COLOR : STUDENT_POST_COLOR;\n  }\n}\nCkWorkspaceComponent.ɵfac = function CkWorkspaceComponent_Factory(t) {\n  return new (t || CkWorkspaceComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.ProjectService), i0.ɵɵdirectiveInject(i3.BoardService), i0.ɵɵdirectiveInject(i4.PostService), i0.ɵɵdirectiveInject(i5.WorkflowService), i0.ɵɵdirectiveInject(i6.GroupService), i0.ɵɵdirectiveInject(i7.SocketService), i0.ɵɵdirectiveInject(i8.SnackbarService), i0.ɵɵdirectiveInject(i9.CanvasService), i0.ɵɵdirectiveInject(i10.GroupTaskService), i0.ɵɵdirectiveInject(Converters), i0.ɵɵdirectiveInject(i11.Router), i0.ɵɵdirectiveInject(i11.ActivatedRoute), i0.ɵɵdirectiveInject(i12.MatDialog));\n};\nCkWorkspaceComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CkWorkspaceComponent,\n  selectors: [[\"app-ck-workspace\"]],\n  viewQuery: function CkWorkspaceComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(SwiperComponent, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.swiper = _t.first);\n    }\n  },\n  decls: 13,\n  vars: 12,\n  consts: [[\"class\", \"toolbar\", \"style\", \"width: 100%;\", 3, \"user\", 4, \"ngIf\"], [1, \"drawer-container\"], [\"mode\", \"side\", \"opened\", \"\", 2, \"position\", \"fixed\", 3, \"fixedInViewport\", \"fixedTopGap\", \"ngStyle\"], [\"drawer\", \"\"], [4, \"ngIf\"], [\"class\", \"heading no-workflow-select\", 4, \"ngIf\"], [\"class\", \"spinner\", 4, \"ngIf\"], [\"style\", \"display: flex; flex-direction: row;position: relative;\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"style\", \"margin: 16px 10px; min-width: unset\", 3, \"click\", 4, \"ngIf\"], [1, \"toolbar\", 2, \"width\", \"100%\", 3, \"user\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Copy embeddable URL\", 3, \"click\", 4, \"ngIf\"], [2, \"flex\", \"1 1 auto\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Back to Board\", 3, \"routerLink\"], [3, \"boardID\", \"currentView\"], [\"navbarMenu\", \"\", 3, \"board\", \"project\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Copy embeddable URL\", 3, \"click\"], [\"mat-button\", \"\", 1, \"subheader-button\", 3, \"click\"], [4, \"ngFor\", \"ngForOf\"], [\"matListIcon\", \"\"], [\"matLine\", \"\"], [\"matLine\", \"\", 1, \"list-task-prompt\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 2, \"margin-left\", \"10px\", \"min-width\", \"unset\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"style\", \"margin-left: 10px; min-width: unset\", 3, \"click\", 4, \"ngIf\"], [2, \"font-weight\", \"bold\"], [2, \"list-style-position\", \"inside\", \"padding-left\", \"30px\", \"font-weight\", \"bold\"], [1, \"heading\", \"no-workflow-select\"], [1, \"spinner\"], [2, \"display\", \"flex\", \"flex-direction\", \"row\", \"position\", \"relative\"], [\"class\", \"heading no-posts\", 4, \"ngIf\"], [\"class\", \"mySwiper\", 3, \"effect\", \"grabCursor\", 4, \"ngIf\"], [1, \"create-post-button-container\"], [\"class\", \"workflow-create-post\", \"mat-fab\", \"\", \"style\", \"position: absolute; bottom:0;\", \"color\", \"accent\", \"matTooltip\", \"Create Post\", 3, \"click\", 4, \"ngIf\"], [1, \"heading\", \"no-posts\"], [1, \"mySwiper\", 3, \"effect\", \"grabCursor\"], [\"swiperSlide\", \"\"], [2, \"display\", \"flex\", \"flex-direction\", \"column\", \"gap\", \"10px\", 3, \"click\"], [2, \"width\", \"360px\", \"height\", \"100%\", 3, \"post\", \"disableDownload\", \"onCommentEvent\", \"onTagEvent\", \"click\"], [2, \"display\", \"flex\", \"flex-direction\", \"row\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 2, \"width\", \"45%\", \"margin\", \"0px 5px\", 3, \"click\"], [2, \"width\", \"360px\", \"height\", \"100%\", 3, \"post\", \"disableDownload\", \"click\"], [\"mat-fab\", \"\", \"color\", \"accent\", \"matTooltip\", \"Create Post\", 1, \"workflow-create-post\", 2, \"position\", \"absolute\", \"bottom\", \"0\", 3, \"click\"], [1, \"example-card\", 2, \"width\", \"350px\", \"margin\", \"10px auto\"], [2, \"margin-bottom\", \"10px\"], [1, \"example-margin\"], [\"mode\", \"determinate\", 3, \"value\"], [\"mode\", \"determinate\", \"color\", \"accent\", 3, \"value\"], [2, \"font-weight\", \"bold\", \"margin-top\", \"16px\"], [2, \"list-style-position\", \"inside\", \"padding-left\", \"0\", \"font-weight\", \"bold\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 2, \"margin\", \"16px 10px\", \"min-width\", \"unset\", 3, \"click\"]],\n  template: function CkWorkspaceComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\");\n      i0.ɵɵtemplate(1, CkWorkspaceComponent_app_toolbar_1_Template, 9, 8, \"app-toolbar\", 0);\n      i0.ɵɵelementStart(2, \"mat-sidenav-container\", 1)(3, \"mat-sidenav\", 2, 3);\n      i0.ɵɵtemplate(5, CkWorkspaceComponent_mat_list_5_Template, 19, 9, \"mat-list\", 4);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"mat-sidenav-content\");\n      i0.ɵɵtemplate(7, CkWorkspaceComponent_div_7_Template, 10, 6, \"div\", 4);\n      i0.ɵɵtemplate(8, CkWorkspaceComponent_div_8_Template, 2, 0, \"div\", 5);\n      i0.ɵɵtemplate(9, CkWorkspaceComponent_mat_spinner_9_Template, 1, 0, \"mat-spinner\", 6);\n      i0.ɵɵtemplate(10, CkWorkspaceComponent_div_10_Template, 10, 8, \"div\", 7);\n      i0.ɵɵtemplate(11, CkWorkspaceComponent_button_11_Template, 2, 0, \"button\", 8);\n      i0.ɵɵtemplate(12, CkWorkspaceComponent_button_12_Template, 2, 0, \"button\", 8);\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.user && ctx.project && ctx.board && !ctx.embedded);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"fixedInViewport\", !ctx.embedded ? true : false)(\"fixedTopGap\", 64)(\"ngStyle\", !ctx.embedded && i0.ɵɵpureFunction0(11, _c0) || null);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.activeGroupTasks);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.runningGroupTask);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.runningGroupTask);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.loading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.runningGroupTask && ctx.runningGroupTask.groupTask.status !== ctx.GroupTaskStatus.COMPLETE && ctx.runningGroupTask.workflow.type !== ctx.TaskWorkflowType.GENERATION && !ctx.showSubmittedPosts);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.runningGroupTask && ctx.runningGroupTask.groupTask.status !== ctx.GroupTaskStatus.COMPLETE && ctx.runningGroupTask.workflow.type !== ctx.TaskWorkflowType.GENERATION && ctx.showSubmittedPosts);\n    }\n  },\n  styles: [\"var resource;\\n/******/ (() => { // webpackBootstrap\\n/******/ \\tvar __webpack_modules__ = ({\\n\\n/***/ 243:\\n/*!********************************************************************************!*\\\\\\n  !*** ./src/app/components/ck-workspace/ck-workspace.component.scss?ngResource ***!\\n  \\\\********************************************************************************/\\n/***/ (() => {\\n\\nthrow new Error(\\\"Module build failed (from ./node_modules/sass-loader/dist/cjs.js):\\\\nSassError: Can't find stylesheet to import.\\\\n  \\u2577\\\\n1 \\u2502 @import \\\\\\\"~swiper/css\\\\\\\";\\\\n  \\u2502         ^^^^^^^^^^^^^\\\\n  \\u2575\\\\n  src/app/components/ck-workspace/ck-workspace.component.scss 1:9  root stylesheet\\\");\\n\\n/***/ })\\n\\n/******/ \\t});\\n/************************************************************************/\\n/******/ \\t\\n/******/ \\t// startup\\n/******/ \\t// Load entry module and return exports\\n/******/ \\t// This entry module doesn't tell about it's top-level declarations so it can't be inlined\\n/******/ \\tvar __webpack_exports__ = {};\\n/******/ \\t__webpack_modules__[243]();\\n/******/ \\tresource = __webpack_exports__;\\n/******/ \\t\\n/******/ })()\\n;\"],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["ViewType","Role","GroupTaskStatus","TaskActionType","TaskWorkflowType","BucketsModalComponent","ListModalComponent","SwiperComponent","SwiperCore","EffectCards","Converters","STUDENT_POST_COLOR","TEACHER_POST_COLOR","SocketEvent","interval","ManageGroupModalComponent","AddPostComponent","PostType","i0","$event","use","CkWorkspaceComponent","constructor","userService","projectService","boardService","postService","workflowService","groupService","socketService","snackbarService","canvasService","groupTaskService","converters","router","activatedRoute","dialog","WORKSPACE","postID","type","runningGroupTask","workflowID","workflow","groupTaskID","groupTask","updateTaskProgress","post","posts","find","postSubmittable","submitPost","queryParams","subscribe","params","embedded","ngOnInit","user","loadWorkspaceData","map","snapshot","paramMap","boardID","projectID","has","get","navigate","board","project","group","getByProjectUser","userID","viewSettings","allowWorkspace","navigateByUrl","defaultView","toLowerCase","tasks","getGroupTasks","forEach","t","status","INACTIVE","inactiveGroupTasks","push","ACTIVE","activeGroupTasks","COMPLETE","completeGroupTasks","connect","begin","expandedGroupTask","updateGroupTask","filter","g","view","loading","getGroupTask","groupID","currentGroupProgress","_calcGroupProgress","averageGroupProgress","_calcAverageProgress","postIDs","concat","Object","keys","progress","submittedPostIDs","reduce","partialSum","a","amountRequired","getAll","submittedPosts","toHTMLPosts","members","getMultipleByIds","GENERATION","showSubmittedPosts","_startListening","close","listeners","l","unsubscribe","task","p","markComplete","showBucketsModal","_openDialog","allowMovePostToBoard","showListModal","openGroupDialog","open","data","postProgress","sum","createMorePosts","requiredActions","CREATE_POST","length","taskSubmittable","hasCommentRequirement","COMMENT","undefined","hasTagRequirement","TAG","hasCreatePostRequirement","numberOfPosts","togglePostsSlider","addPost","dialogData","disableCreation","tagRequired","onComplete","WORKFLOW","destinationType","destinations","BUCKET","displayAttributes","position","left","top","lock","permissions","allowStudentMoveAny","fillColor","defaultPostFill","id","htmlPost","toHTMLPost","create","action","emit","WORKFLOW_PROGRESS_UPDATE","_","tags","onTagEvent","width","toggleSubmittedPosts","listen","updates","found","u","_newPosts","includes","newPosts","htmlPosts","POST_UPVOTE_ADD","result","upvote","upvotes","POST_UPVOTE_REMOVE","upvoteID","POST_COMMENT_ADD","comment","comments","POST_COMMENT_REMOVE","POST_TAG_ADD","POST_TAG_REMOVE","WORKFLOW_POST_SUBMIT","submittedPost","copyEmbedCode","url","window","location","href","navigator","clipboard","writeText","signOut","logout","ngOnDestroy","disconnect","values","key","remaining","partial","b","total","createPosts","postsCreated","actionPerPost","getGroupTasksByWorkflow","totalProgress","component","maxWidth","autoFocus","role","TEACHER","selectors","viewQuery"],"sourceRoot":"","sources":["/Users/marieklinaeva/github/ck-board/frontend/src/app/components/ck-workspace/ck-workspace.component.ts","/Users/marieklinaeva/github/ck-board/frontend/src/app/components/ck-workspace/ck-workspace.component.html"],"sourcesContent":["import { ComponentType } from '@angular/cdk/overlay';\nimport {\n  Component,\n  OnDestroy,\n  OnInit,\n  ViewChild,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Board, BoardScope, ViewType } from 'src/app/models/board';\nimport { Project } from 'src/app/models/project';\nimport User, { AuthUser, Role } from 'src/app/models/user';\nimport {\n  ExpandedGroupTask,\n  GroupTask,\n  GroupTaskStatus,\n  TaskAction,\n  TaskActionType,\n  TaskWorkflowType,\n} from 'src/app/models/workflow';\nimport { BoardService } from 'src/app/services/board.service';\nimport { ProjectService } from 'src/app/services/project.service';\nimport { SnackbarService } from 'src/app/services/snackbar.service';\nimport { UserService } from 'src/app/services/user.service';\nimport { WorkflowService } from 'src/app/services/workflow.service';\nimport { BucketsModalComponent } from '../buckets-modal/buckets-modal.component';\nimport { ListModalComponent } from '../list-modal/list-modal.component';\nimport { SwiperComponent } from 'swiper/angular';\nimport SwiperCore, { EffectCards } from 'swiper';\nimport { HTMLPost } from '../html-post/html-post.component';\nimport { Group } from 'src/app/models/group';\nimport { GroupService } from 'src/app/services/group.service';\nimport Converters from 'src/app/utils/converters';\nimport { PostService } from 'src/app/services/post.service';\nimport {\n  NEEDS_ATTENTION_TAG,\n  POST_TAGGED_BORDER_THICKNESS,\n  STUDENT_POST_COLOR,\n  TEACHER_POST_COLOR,\n  SocketEvent,\n} from 'src/app/utils/constants';\nimport { SocketService } from 'src/app/services/socket.service';\nimport { interval, Subscription } from 'rxjs';\nimport { ManageGroupModalComponent } from '../groups/manage-group-modal/manage-group-modal.component';\nimport { AddPostComponent } from '../add-post-modal/add-post.component';\nimport Post, { DisplayAttributes, PostType } from 'src/app/models/post';\nimport { CanvasService } from 'src/app/services/canvas.service';\nimport { GroupTaskService } from 'src/app/services/groupTask.service';\n\n// install Swiper modules\nSwiperCore.use([EffectCards]);\n\n@Component({\n  selector: 'app-ck-workspace',\n  templateUrl: './ck-workspace.component.html',\n  styleUrls: ['./ck-workspace.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n})\nexport class CkWorkspaceComponent implements OnInit, OnDestroy {\n  @ViewChild(SwiperComponent) swiper: SwiperComponent;\n\n  loading = false;\n\n  showInactive = true;\n  showActive = true;\n  showCompleted = false;\n\n  user: AuthUser;\n  group: Group;\n\n  project: Project;\n  board: Board;\n\n  inactiveGroupTasks: ExpandedGroupTask[] = [];\n  activeGroupTasks: ExpandedGroupTask[] = [];\n  completeGroupTasks: ExpandedGroupTask[] = [];\n\n  runningGroupTask: ExpandedGroupTask | null;\n  currentGroupProgress: number;\n  averageGroupProgress: number;\n  listeners: Subscription[] = [];\n  posts: HTMLPost[] = [];\n  submittedPosts: HTMLPost[] = [];\n  members: User[] = [];\n\n  showSubmittedPosts: boolean = false;\n\n  Role: typeof Role = Role;\n  TaskActionType: typeof TaskActionType = TaskActionType;\n  TaskWorkflowType: typeof TaskWorkflowType = TaskWorkflowType;\n  GroupTaskStatus: typeof GroupTaskStatus = GroupTaskStatus;\n  embedded: boolean = false; // If standalone board embed\n  viewType = ViewType.WORKSPACE;\n\n  constructor(\n    public userService: UserService,\n    public projectService: ProjectService,\n    public boardService: BoardService,\n    public postService: PostService,\n    public workflowService: WorkflowService,\n    public groupService: GroupService,\n    public socketService: SocketService,\n    public snackbarService: SnackbarService,\n    public canvasService: CanvasService,\n    public groupTaskService: GroupTaskService,\n    private converters: Converters,\n    private router: Router,\n    private activatedRoute: ActivatedRoute,\n    public dialog: MatDialog\n  ) {\n    this.activatedRoute.queryParams.subscribe((params) => {\n      if (params.embedded === 'true') {\n        this.embedded = true;\n      }\n    });\n  }\n\n  ngOnInit(): void {\n    this.user = this.userService.user!;\n    this.loadWorkspaceData();\n  }\n\n  async loadWorkspaceData(): Promise<boolean> {\n    const map = this.activatedRoute.snapshot.paramMap;\n    let boardID: string, projectID: string;\n\n    if (map.has('boardID') && map.has('projectID')) {\n      boardID = this.activatedRoute.snapshot.paramMap.get('boardID') ?? '';\n      projectID = this.activatedRoute.snapshot.paramMap.get('projectID') ?? '';\n    } else {\n      return this.router.navigate(['error']);\n    }\n\n    this.board = await this.boardService.get(boardID);\n    this.project = await this.projectService.get(projectID);\n    this.group = await this.groupService.getByProjectUser(\n      projectID,\n      this.user.userID\n    );\n\n    if (!this.board.viewSettings?.allowWorkspace) {\n      this.router.navigateByUrl(\n        `project/${projectID}/board/${boardID}/${this.board.defaultView?.toLowerCase()}`\n      );\n    }\n\n    const tasks = await this.workflowService.getGroupTasks(boardID, 'expanded');\n    tasks.forEach((t) => {\n      if (t.groupTask.status == GroupTaskStatus.INACTIVE) {\n        this.inactiveGroupTasks.push(t);\n      } else if (t.groupTask.status == GroupTaskStatus.ACTIVE) {\n        this.activeGroupTasks.push(t);\n      } else if (t.groupTask.status == GroupTaskStatus.COMPLETE) {\n        this.completeGroupTasks.push(t);\n      }\n    });\n    this.socketService.connect(this.user.userID, this.board.boardID);\n    return true;\n  }\n\n  async begin(expandedGroupTask: ExpandedGroupTask): Promise<void> {\n    const groupTask = expandedGroupTask.groupTask;\n    groupTask.status = GroupTaskStatus.ACTIVE;\n    await this.workflowService.updateGroupTask(groupTask.groupTaskID, {\n      status: GroupTaskStatus.ACTIVE,\n    });\n\n    this.inactiveGroupTasks = this.inactiveGroupTasks.filter(\n      (g) => g.groupTask.groupTaskID !== groupTask.groupTaskID\n    );\n    this.activeGroupTasks.push(expandedGroupTask);\n    this.view(expandedGroupTask);\n  }\n\n  async view(groupTask: ExpandedGroupTask): Promise<void> {\n    this.loading = true;\n    this.runningGroupTask = groupTask;\n    this.runningGroupTask.groupTask = await this.groupTaskService.getGroupTask(\n      this.runningGroupTask.group.groupID,\n      this.runningGroupTask.workflow.workflowID\n    );\n    this.currentGroupProgress = this._calcGroupProgress(this.runningGroupTask);\n    this.averageGroupProgress = await this._calcAverageProgress(\n      this.runningGroupTask\n    );\n\n    let postIDs: string[] = [];\n    if (groupTask.groupTask.status == GroupTaskStatus.COMPLETE) {\n      postIDs = postIDs.concat(Object.keys(groupTask.groupTask.progress));\n    } else {\n      postIDs = postIDs.concat(groupTask.groupTask.posts);\n    }\n    const submittedPostIDs = [\n      ...Object.keys(groupTask.groupTask.progress),\n    ].filter(\n      (postID) =>\n        groupTask.groupTask.progress[postID].reduce(\n          (partialSum, a) => partialSum + a.amountRequired,\n          0\n        ) == 0\n    );\n    const posts = await this.postService.getAll(postIDs);\n    const submittedPosts = await this.postService.getAll(submittedPostIDs);\n    this.posts = await this.converters.toHTMLPosts(posts);\n    this.submittedPosts = await this.converters.toHTMLPosts(submittedPosts);\n    this.members = await this.userService.getMultipleByIds(\n      groupTask.group.members\n    );\n    this.loading = false;\n    // Show submitted posts by default in generative task workflow\n    if (this.runningGroupTask.workflow.type === TaskWorkflowType.GENERATION) {\n      this.showSubmittedPosts = true;\n    } else {\n      this.showSubmittedPosts = false;\n    }\n\n    this._startListening();\n  }\n\n  close(): void {\n    this.runningGroupTask = null;\n    this.currentGroupProgress = 0;\n    this.averageGroupProgress = 0;\n    this.posts = [];\n    this.members = [];\n    this.listeners.map((l) => l.unsubscribe());\n  }\n\n  async submitPost(post: HTMLPost): Promise<void> {\n    if (!this.runningGroupTask) return;\n\n    const task: GroupTask = this.runningGroupTask.groupTask;\n    this.runningGroupTask.groupTask = await this.workflowService.submitPost(\n      task.groupTaskID,\n      post.post.postID\n    );\n\n    this.posts = this.posts.filter((p) => p.post.postID !== post.post.postID);\n    // this.submittedPosts.push(post);\n    this.currentGroupProgress = this._calcGroupProgress(this.runningGroupTask);\n    if (this.currentGroupProgress >= 100) {\n      await this.markComplete();\n    }\n  }\n\n  async markComplete(): Promise<void> {\n    if (!this.runningGroupTask) return;\n\n    const task: GroupTask = this.runningGroupTask.groupTask;\n    this.runningGroupTask.groupTask =\n      await this.workflowService.updateGroupTask(task.groupTaskID, {\n        status: GroupTaskStatus.COMPLETE,\n      });\n\n    this.activeGroupTasks = this.activeGroupTasks.filter(\n      (g) => g.groupTask.groupTaskID !== task.groupTaskID\n    );\n    this.completeGroupTasks.push(this.runningGroupTask);\n\n    this.close();\n  }\n\n  showBucketsModal(): void {\n    this._openDialog(BucketsModalComponent, {\n      board: this.board,\n      user: this.user,\n      allowMovePostToBoard: false,\n    });\n  }\n\n  showListModal(): void {\n    this._openDialog(ListModalComponent, {\n      board: this.board,\n    });\n  }\n\n  openGroupDialog(): void {\n    this.dialog.open(ManageGroupModalComponent, {\n      data: {\n        project: this.project,\n      },\n    });\n  }\n\n  postSubmittable(post: HTMLPost): boolean {\n    if (!this.runningGroupTask) return false;\n\n    const progress = this.runningGroupTask.groupTask.progress;\n    const postProgress = progress[post.post.postID];\n\n    if (!postProgress) return false;\n\n    const amountRequired = postProgress.reduce(\n      (sum: number, a: TaskAction) => sum + a.amountRequired,\n      0\n    );\n    return amountRequired == 0;\n  }\n\n  createMorePosts(groupTask: ExpandedGroupTask): boolean {\n    return (\n      groupTask.workflow.requiredActions.filter(\n        (a) => a.type === TaskActionType.CREATE_POST\n      )[0].amountRequired === Object.keys(groupTask.groupTask.progress).length\n    );\n  }\n\n  taskSubmittable(groupTask: ExpandedGroupTask): boolean {\n    return this.runningGroupTask?.workflow.type === TaskWorkflowType.GENERATION\n      ? this.currentGroupProgress >= 100 &&\n          groupTask.groupTask.status == GroupTaskStatus.ACTIVE\n      : this.currentGroupProgress == 100 &&\n          groupTask.groupTask.posts.length == 0 &&\n          groupTask.groupTask.status == GroupTaskStatus.ACTIVE;\n  }\n\n  hasCommentRequirement(runningGroupTask: ExpandedGroupTask): boolean {\n    return (\n      runningGroupTask.workflow.requiredActions.find(\n        (a) => a.type == TaskActionType.COMMENT\n      ) != undefined\n    );\n  }\n\n  hasTagRequirement(runningGroupTask: ExpandedGroupTask): boolean {\n    return (\n      runningGroupTask.workflow.requiredActions.find(\n        (a) => a.type == TaskActionType.TAG\n      ) != undefined\n    );\n  }\n\n  hasCreatePostRequirement(runningGroupTask: ExpandedGroupTask): boolean {\n    return (\n      runningGroupTask.workflow.requiredActions.find(\n        (a) => a.type == TaskActionType.CREATE_POST\n      ) != undefined\n    );\n  }\n\n  numberOfPosts(runningGroupTask: ExpandedGroupTask): number | undefined {\n    return runningGroupTask.workflow.requiredActions.find(\n      (a) => a.type == TaskActionType.CREATE_POST\n    )?.amountRequired;\n  }\n\n  togglePostsSlider(): void {\n    this.showSubmittedPosts = !this.showSubmittedPosts;\n  }\n\n  addPost(): void {\n    const dialogData = {\n      disableCreation: true,\n      board: this.board,\n      user: this.user,\n      tagRequired: this.hasTagRequirement(this.runningGroupTask!),\n      onComplete: async (post: Post) => {\n        if (this.runningGroupTask) {\n          post.type = PostType.WORKFLOW;\n          const destinationType =\n            PostType[this.runningGroupTask?.workflow.destinations[0].type];\n          if (destinationType === PostType.BUCKET) {\n            post.boardID = this.board.boardID;\n          } else {\n            const displayAttributes: DisplayAttributes = {\n              position: {\n                left: 150,\n                top: 150,\n              },\n              lock: !this.board.permissions.allowStudentMoveAny,\n              fillColor: this.defaultPostFill(),\n            };\n            post.boardID = this.runningGroupTask?.workflow.destinations[0].id;\n            post.displayAttributes = displayAttributes;\n          }\n          const htmlPost = await this.converters.toHTMLPost(post);\n          this.posts.push(htmlPost);\n          this.postService.create(post);\n          this.runningGroupTask.groupTask.progress[post.postID] =\n            this.runningGroupTask.workflow.requiredActions.filter(\n              (action) => action.type !== TaskActionType.CREATE_POST\n            );\n          this.runningGroupTask.groupTask.posts.push(post.postID);\n          const t = await this.workflowService.updateGroupTask(\n            this.runningGroupTask.groupTask.groupTaskID,\n            {\n              posts: this.posts.map((p) => p.post.postID),\n              progress: this.runningGroupTask.groupTask.progress,\n            }\n          );\n\n          this.currentGroupProgress = this._calcGroupProgress(\n            this.runningGroupTask\n          );\n          this.averageGroupProgress = await this._calcAverageProgress(\n            this.runningGroupTask\n          );\n          this.socketService.emit(SocketEvent.WORKFLOW_PROGRESS_UPDATE, [\n            this.runningGroupTask.groupTask,\n          ]);\n\n          for (const _ of post.tags) {\n            await this.onTagEvent(post.postID, 'add');\n          }\n          await this.submitPost(htmlPost);\n        }\n        return;\n      },\n    };\n    this.dialog.open(AddPostComponent, {\n      width: '500px',\n      data: dialogData,\n    });\n  }\n\n  onCommentEvent = async (postID: string, type: string): Promise<void> => {\n    if (!this.runningGroupTask) return;\n\n    const workflowID = this.runningGroupTask.workflow.workflowID;\n    const groupTaskID = this.runningGroupTask.groupTask.groupTaskID;\n    if (type == 'add') {\n      await this.workflowService.updateTaskProgress(\n        workflowID,\n        groupTaskID,\n        postID,\n        -1,\n        'COMMENT'\n      );\n    } else {\n      await this.workflowService.updateTaskProgress(\n        workflowID,\n        groupTaskID,\n        postID,\n        1,\n        'COMMENT'\n      );\n    }\n    const post = this.posts.find((post) => post.post.postID === postID);\n    if (post && this.postSubmittable(post)) {\n      await this.submitPost(post);\n    }\n  };\n\n  onTagEvent = async (postID: string, type: string): Promise<void> => {\n    if (!this.runningGroupTask) return;\n\n    const workflowID = this.runningGroupTask.workflow.workflowID;\n    const groupTaskID = this.runningGroupTask.groupTask.groupTaskID;\n    if (type == 'add') {\n      await this.workflowService.updateTaskProgress(\n        workflowID,\n        groupTaskID,\n        postID,\n        -1,\n        'TAG'\n      );\n    } else {\n      await this.workflowService.updateTaskProgress(\n        workflowID,\n        groupTaskID,\n        postID,\n        1,\n        'TAG'\n      );\n    }\n\n    const post = this.posts.find((post) => post.post.postID === postID);\n    if (post && this.postSubmittable(post)) {\n      await this.submitPost(post);\n    }\n  };\n\n  toggleSubmittedPosts(): void {\n    this.showSubmittedPosts = !this.showSubmittedPosts;\n  }\n\n  private _startListening(): void {\n    this.listeners.push(\n      this.socketService.listen(\n        SocketEvent.WORKFLOW_PROGRESS_UPDATE,\n        async (updates) => {\n          if (!this.runningGroupTask) return;\n\n          const found = updates.find(\n            (u) => u.groupTaskID == this.runningGroupTask?.groupTask.groupTaskID\n          );\n          if (found) {\n            this.runningGroupTask.groupTask = found;\n            if (\n              this.runningGroupTask?.workflow.type ===\n              TaskWorkflowType.GENERATION\n            ) {\n              const _newPosts = found.posts.filter(\n                (p) => !this.posts.map((post) => post.post.postID).includes(p)\n              );\n              const newPosts = await this.postService.getAll(_newPosts);\n              const htmlPosts = await this.converters.toHTMLPosts(newPosts);\n              this.posts = this.posts.concat(htmlPosts);\n            }\n            this.currentGroupProgress = this._calcGroupProgress(\n              this.runningGroupTask\n            );\n          }\n        }\n      )\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_UPVOTE_ADD, (result) => {\n        const found = this.posts.find(\n          (p) => p.post.postID == result.upvote.postID\n        );\n        if (found) {\n          found.upvotes.push(result.upvote);\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_UPVOTE_REMOVE, (result) => {\n        const found = this.posts.find(\n          (p) => p.post.postID == result.upvote.postID\n        );\n        if (found) {\n          found.upvotes = found.upvotes.filter(\n            (upvote) => upvote.upvoteID != result.upvote.upvoteID\n          );\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_COMMENT_ADD, (result) => {\n        const found = this.posts.find(\n          (p) => p.post.postID == result.comment.postID\n        );\n        if (found) {\n          found.comments += 1;\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_COMMENT_REMOVE, (result) => {\n        const found = this.posts.find(\n          (p) => p.post.postID == result.comment.postID\n        );\n        if (found) {\n          found.comments -= 1;\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_TAG_ADD, ({ post }) => {\n        const found = this.posts.find((p) => p.post.postID == post.postID);\n        if (found) {\n          found.post = post;\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(SocketEvent.POST_TAG_REMOVE, ({ post }) => {\n        const found = this.posts.find((p) => p.post.postID == post.postID);\n        if (found) {\n          found.post = post;\n        }\n      })\n    );\n    this.listeners.push(\n      this.socketService.listen(\n        SocketEvent.WORKFLOW_POST_SUBMIT,\n        (postID: string) => {\n          const submittedPost = this.posts.find((p) => p.post.postID == postID);\n          this.posts = this.posts.filter((p) => p.post.postID != postID);\n          if (submittedPost) this.submittedPosts.push(submittedPost);\n        }\n      )\n    );\n    this.listeners.push(\n      interval(30 * 1000).subscribe(async () => {\n        this.averageGroupProgress = await this._calcAverageProgress(\n          this.runningGroupTask\n        );\n      })\n    );\n  }\n\n  copyEmbedCode() {\n    const url = window.location.href + '?embedded=true';\n    navigator.clipboard.writeText(url);\n  }\n\n  signOut(): void {\n    this.userService.logout();\n    this.router.navigate(['login']);\n  }\n\n  ngOnDestroy(): void {\n    this.listeners.map((l) => l.unsubscribe());\n    this.socketService.disconnect(this.user.userID, this.board.boardID);\n  }\n\n  private _calcGroupProgress(task: ExpandedGroupTask | null): number {\n    if (!task) return 0;\n    // get all posts' progress\n    const values = Object.keys(task.groupTask.progress).map(function (key) {\n      return task.groupTask.progress[key];\n    });\n\n    // sum all amountRequired for each action per post\n    // i.e. Post A (1 tag req, 1 comment req) + Post B (1 tag req, 0 comments required)\n    let remaining = values.reduce(\n      (partialSum, a) =>\n        partialSum + a.reduce((partial, b) => partial + b.amountRequired, 0),\n      0\n    );\n\n    // nothing left to do\n    if (remaining == 0 && task.workflow.type !== TaskWorkflowType.GENERATION)\n      return 100;\n\n    // sum both required tags (1) and required comments (1) = 2\n    // multiple by number of posts since those requirements are per-post\n\n    let total = task.workflow.requiredActions\n      .filter((a) => a.type !== TaskActionType.CREATE_POST)\n      .reduce((partialSum, a) => partialSum + a.amountRequired, 0);\n    if (task.workflow.type === TaskWorkflowType.GENERATION) {\n      const createPosts = task.workflow.requiredActions.filter(\n        (a) => a.type === TaskActionType.CREATE_POST\n      )[0].amountRequired;\n      const postsCreated = Object.keys(task.groupTask.progress).length;\n\n      const actionPerPost = total;\n      if (total) total = total * createPosts + createPosts;\n      else total = createPosts;\n      remaining += createPosts - postsCreated;\n      remaining += (createPosts - postsCreated) * actionPerPost;\n    } else {\n      total *= values.length;\n    }\n    return ((total - remaining) / total) * 100;\n  }\n\n  private async _calcAverageProgress(\n    task: ExpandedGroupTask | null\n  ): Promise<number> {\n    if (!task) return 0;\n\n    const tasks: ExpandedGroupTask[] =\n      await this.workflowService.getGroupTasksByWorkflow(\n        task.workflow.workflowID,\n        'expanded'\n      );\n\n    const totalProgress = tasks.reduce(\n      (partialSum) => partialSum + this._calcGroupProgress(task),\n      0\n    );\n    return totalProgress / tasks.length;\n  }\n\n  private _openDialog(component: ComponentType<unknown>, data: any) {\n    this.dialog.open(component, {\n      maxWidth: 1280,\n      width: '95vw',\n      autoFocus: false,\n      data: data,\n    });\n  }\n\n  defaultPostFill() {\n    return this.userService.user?.role === Role.TEACHER\n      ? TEACHER_POST_COLOR\n      : STUDENT_POST_COLOR;\n  }\n}\n","<div>\n  <app-toolbar class=\"toolbar\" *ngIf=\"user && project && board && !embedded\" [user]=\"user\" style=\"width: 100%;\">\n    <span *ngIf=\"board\">CK Workspace - {{ this.board.name }}</span>\n    <button mat-icon-button *ngIf=\"user.role === Role.TEACHER\" (click)=\"copyEmbedCode()\" matTooltip=\"Copy embeddable URL\">\n      <mat-icon>file_copy</mat-icon>\n    </button>\n    <span style=\"flex: 1 1 auto\"></span>\n    <button mat-icon-button routerLink=\"{{'/project/'+project.projectID+'/board/'+board.boardID}}\" matTooltip=\"Back to Board\">\n      <mat-icon>keyboard_return</mat-icon>\n    </button>\n    <app-view-navigation [boardID]=\"board.boardID\" [currentView]=\"viewType\"></app-view-navigation>\n    <app-toolbar-menu navbarMenu [board]=\"board\" [project]=\"project\"></app-toolbar-menu>\n  </app-toolbar>\n  <mat-sidenav-container class=\"drawer-container\">\n    <mat-sidenav #drawer mode=\"side\" opened [fixedInViewport]=\"!embedded ? true : false\" [fixedTopGap]=\"64\" style=\"position: fixed;\" [ngStyle]=\"!embedded && {'padding-bottom': '64px' } || null\">\n        <mat-list *ngIf=\"activeGroupTasks\">\n          <button class=\"subheader-button\" mat-button (click)=\"showInactive = !showInactive\">\n            Pending Tasks ({{ inactiveGroupTasks.length }})\n            <mat-icon>{{ showInactive ? 'expand_less' : 'expand_more' }}</mat-icon>\n          </button>\n          <ng-container *ngIf=\"showInactive\">\n            <mat-list-item *ngFor=\"let task of inactiveGroupTasks\">\n              <mat-icon matListIcon>timeline</mat-icon>\n              <h3 matLine> {{task.workflow.name}} </h3>\n              <p matLine class=\"list-task-prompt\"> {{task.group.name}}: {{task.workflow.prompt}} </p>\n              <span style=\"flex: 1 1 auto\"></span>\n              <button mat-raised-button color=\"primary\" style=\"margin-left: 10px; min-width: unset\" (click)=\"begin(task)\">Begin Task</button>\n            </mat-list-item>\n          </ng-container>\n          <mat-divider></mat-divider>\n          <button class=\"subheader-button\" mat-button (click)=\"showActive = !showActive\">\n            Active Tasks ({{ activeGroupTasks.length }})\n            <mat-icon>{{ showActive ? 'expand_less' : 'expand_more' }}</mat-icon>\n          </button>\n          <ng-container *ngIf=\"showActive\">\n            <mat-list-item *ngFor=\"let task of activeGroupTasks\">\n              <mat-icon matListIcon>timeline</mat-icon>\n              <h3 matLine> {{task.workflow.name}} </h3>\n              <p matLine class=\"list-task-prompt\"> {{task.group.name}}: {{task.workflow.prompt}} </p>\n              <span style=\"flex: 1 1 auto\"></span>\n              <button *ngIf=\"(runningGroupTask && runningGroupTask.groupTask.groupTaskID !== task.groupTask.groupTaskID) || (!runningGroupTask)\" mat-raised-button color=\"primary\" style=\"margin-left: 10px; min-width: unset\" (click)=\"view(task)\">Resume Task</button>\n              <button *ngIf=\"runningGroupTask && runningGroupTask.groupTask.groupTaskID === task.groupTask.groupTaskID\" mat-raised-button color=\"primary\" style=\"margin-left: 10px; min-width: unset\" (click)=\"close()\">Hide Task</button>\n            </mat-list-item>\n          </ng-container>\n          <mat-divider></mat-divider>\n          <button class=\"subheader-button\" mat-button (click)=\"showCompleted = !showCompleted\">\n            Completed Tasks ({{ completeGroupTasks.length }})\n            <mat-icon>{{ showCompleted ? 'expand_less' : 'expand_more' }}</mat-icon>\n          </button>\n          <ng-container *ngIf=\"showCompleted\">\n            <mat-list-item *ngFor=\"let task of completeGroupTasks\">\n              <mat-icon matListIcon>timeline</mat-icon>\n              <h3 matLine> {{task.workflow.name}} </h3>\n              <p matLine class=\"list-task-prompt\"> {{task.group.name}}: {{task.workflow.prompt}} </p>\n              <span style=\"flex: 1 1 auto\"></span>\n              <button *ngIf=\"(runningGroupTask && runningGroupTask.groupTask.groupTaskID !== task.groupTask.groupTaskID) || (!runningGroupTask)\" mat-raised-button color=\"primary\" style=\"margin-left: 10px; min-width: unset\" (click)=\"view(task)\">View Task</button>\n              <button *ngIf=\"runningGroupTask && runningGroupTask.groupTask.groupTaskID === task.groupTask.groupTaskID\" mat-raised-button color=\"primary\" style=\"margin-left: 10px; min-width: unset\" (click)=\"close()\">Hide Task</button>\n            </mat-list-item>\n          </ng-container>\n          <mat-divider></mat-divider>\n        </mat-list>\n      <!-- </div> -->\n    </mat-sidenav>\n    <mat-sidenav-content>\n      <div *ngIf=\"!loading && runningGroupTask\">\n        <h1>{{runningGroupTask.group.name}}: {{runningGroupTask.workflow.name}}</h1>\n        <h2 style=\"font-weight: bold;\">{{ runningGroupTask.workflow.prompt }} </h2>\n        <section>\n          <ul style=\"list-style-position: inside; padding-left: 30px; font-weight: bold;\">\n            <li *ngIf=\"hasCommentRequirement(runningGroupTask)\">Comment on each post at least once!</li>\n            <li *ngIf=\"hasTagRequirement(runningGroupTask)\">Tag each post at least once!</li>\n            <li *ngIf=\"hasCreatePostRequirement(runningGroupTask)\">Create {{numberOfPosts(runningGroupTask)}} posts</li>\n          </ul>\n        </section>\n      </div>\n      <div class=\"heading no-workflow-select\" *ngIf=\"!runningGroupTask\">\n        No task selected!\n      </div>\n      <mat-spinner class=\"spinner\" *ngIf=\"loading\"></mat-spinner>\n      <div *ngIf=\"!loading\" style=\"display: flex; flex-direction: row;position: relative;\">\n        <div class=\"heading no-posts\" *ngIf=\"runningGroupTask && runningGroupTask.workflow.type !== TaskWorkflowType.GENERATION && (!posts || posts.length === 0)\">\n          No posts to review!\n        </div>\n\n        <div class=\"heading no-posts\" *ngIf=\"runningGroupTask && runningGroupTask.workflow.type === TaskWorkflowType.GENERATION && !showSubmittedPosts && (!posts || posts.length === 0)\">\n          Create a Post!\n        </div>\n\n        <div class=\"heading no-posts\" *ngIf=\"runningGroupTask && runningGroupTask.workflow.type === TaskWorkflowType.GENERATION && showSubmittedPosts && (!submittedPosts|| submittedPosts.length === 0)\">\n          No submitted posts!\n        </div>\n\n        <div class=\"heading no-posts\" *ngIf=\"runningGroupTask && runningGroupTask.workflow.type !== TaskWorkflowType.GENERATION && showSubmittedPosts && (!submittedPosts|| submittedPosts.length === 0)\">\n          No reviewed posts!\n        </div>\n        <!-- Draft post slider -->\n        <swiper [effect]=\"'cards'\" [grabCursor]=\"true\" class=\"mySwiper\" *ngIf=\"runningGroupTask && !showSubmittedPosts && posts && posts.length > 0\">\n          <ng-template swiperSlide *ngFor=\"let htmlPost of posts\">\n            <div (click)=\"$event.stopPropagation();\" style=\"display: flex; flex-direction: column; gap: 10px;\">\n              <app-html-post \n                (click)=\"$event.stopPropagation();\" \n                [post]=\"htmlPost\" [disableDownload]=\"true\"\n                [onCommentEvent]=\"onCommentEvent\" [onTagEvent]=\"onTagEvent\" \n                style=\"width: 360px; height: 100%;\">\n              </app-html-post>\n              <div style=\"display: flex; flex-direction: row;\">\n                <button (click)=\"swiper.swiperRef.slidePrev()\" mat-raised-button color=\"accent\" style=\"width: 45%; margin: 0px 5px;\">Previous</button>\n                <button (click)=\"swiper.swiperRef.slideNext()\" mat-raised-button color=\"accent\" style=\"width: 45%; margin: 0px 5px;\">Next</button>\n              </div>\n            </div>\n          </ng-template>\n        </swiper>\n        <!-- Submitted Post Slider -->\n        <swiper [effect]=\"'cards'\" [grabCursor]=\"true\" class=\"mySwiper\" *ngIf=\"runningGroupTask && showSubmittedPosts && submittedPosts && submittedPosts.length > 0\">\n          <ng-template swiperSlide *ngFor=\"let htmlPost of submittedPosts\">\n            <div (click)=\"$event.stopPropagation();\" style=\"display: flex; flex-direction: column; gap: 10px;\">\n              <app-html-post \n                (click)=\"$event.stopPropagation();\" \n                [post]=\"htmlPost\" [disableDownload]=\"true\" \n                style=\"width: 360px; height: 100%;\">\n              </app-html-post>\n              <div style=\"display: flex; flex-direction: row;\">\n                <button (click)=\"swiper.swiperRef.slidePrev()\" mat-raised-button color=\"accent\" style=\"width: 45%; margin: 0px 5px;\">Previous</button>\n                <button (click)=\"swiper.swiperRef.slideNext()\" mat-raised-button color=\"accent\" style=\"width: 45%; margin: 0px 5px;\">Next</button>\n              </div>\n            </div>\n          </ng-template>\n        </swiper>\n        <div class=\"create-post-button-container\">\n          <button\n          *ngIf=\"!loading && runningGroupTask && runningGroupTask.workflow.type === TaskWorkflowType.GENERATION && !createMorePosts(runningGroupTask) && runningGroupTask.groupTask.status !== GroupTaskStatus.COMPLETE\" \n          class=\"workflow-create-post\"\n          mat-fab\n          style=\"position: absolute; bottom:0;\"\n          color=\"accent\"\n          matTooltip=\"Create Post\"\n          (click)=\"addPost()\"\n          >\n          <mat-icon>add</mat-icon>\n        </button>\n      </div>\n        <div *ngIf=\"runningGroupTask\">\n          <mat-card class=\"example-card\" style=\"width: 350px; margin: 10px auto\">\n            <div style=\"margin-bottom: 10px;\">\n              <label class=\"example-margin\">Your Group's Progress</label>\n              <mat-progress-bar mode=\"determinate\" [value]=\"currentGroupProgress\"></mat-progress-bar>\n            </div>\n            <div>\n              <label class=\"example-margin\">Avg. Group's Progress</label>\n              <mat-progress-bar mode=\"determinate\" [value]=\"averageGroupProgress\" color=\"accent\"></mat-progress-bar>\n            </div>\n            <section>\n              <h4 style=\"font-weight: bold; margin-top:16px;\">Group Members:</h4>\n              <ul style=\"list-style-position: inside; padding-left: 0; font-weight: bold;\">\n                <li *ngFor=\"let member of members\">{{member.username}}</li>\n              </ul>\n            </section>\n          </mat-card>\n        </div>\n      </div>\n      <button *ngIf=\"!loading && runningGroupTask && runningGroupTask.groupTask.status !== GroupTaskStatus.COMPLETE && runningGroupTask.workflow.type !== TaskWorkflowType.GENERATION && !showSubmittedPosts\" mat-raised-button color=\"primary\" style=\"margin: 16px 10px; min-width: unset\" (click)=\"toggleSubmittedPosts()\">\n        View Completed\n      </button>\n      <button *ngIf=\"!loading && runningGroupTask && runningGroupTask.groupTask.status !== GroupTaskStatus.COMPLETE && runningGroupTask.workflow.type !== TaskWorkflowType.GENERATION && showSubmittedPosts\" mat-raised-button color=\"primary\" style=\"margin: 16px 10px; min-width: unset\" (click)=\"toggleSubmittedPosts()\">\n        View Drafts\n      </button>\n    </mat-sidenav-content>\n  </mat-sidenav-container>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}