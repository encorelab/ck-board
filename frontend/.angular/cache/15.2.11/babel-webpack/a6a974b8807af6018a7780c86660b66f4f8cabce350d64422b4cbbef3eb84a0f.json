{"ast":null,"code":"import _asyncToGenerator from \"/Users/marieklinaeva/github/ck-board/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { NotificationType } from 'src/app/models/notification';\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { PostModalComponent } from '../post-modal/post-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/notification.service\";\nimport * as i2 from \"src/app/services/post.service\";\nimport * as i3 from \"src/app/services/socket.service\";\nimport * as i4 from \"@angular/material/legacy-dialog\";\nimport * as i5 from \"src/app/services/canvas.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/legacy-button\";\nimport * as i8 from \"@angular/material/icon\";\nimport * as i9 from \"@angular/material/legacy-tooltip\";\nimport * as i10 from \"@angular/material/legacy-menu\";\nimport * as i11 from \"@angular/material/badge\";\nfunction NotificationDropdownComponent_mat_icon_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\", 6);\n    i0.ɵɵtext(1, \"notifications_active\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"matBadge\", ctx_r0.notifications.length);\n  }\n}\nfunction NotificationDropdownComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\");\n    i0.ɵɵtext(1, \"notifications\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NotificationDropdownComponent_div_6_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function NotificationDropdownComponent_div_6_button_1_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const notification_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r9.openPost(notification_r8));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const notification_r8 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", notification_r8.text, \" \");\n  }\n}\nfunction NotificationDropdownComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, NotificationDropdownComponent_div_6_button_1_Template, 2, 1, \"button\", 7);\n    i0.ɵɵelementStart(2, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function NotificationDropdownComponent_div_6_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.markAllAsRead());\n    });\n    i0.ɵɵtext(3, \"Mark all as read\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.notifications.reverse());\n  }\n}\nfunction NotificationDropdownComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 10);\n    i0.ɵɵtext(1, \"No notifications to display\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class NotificationDropdownComponent {\n  notificationService;\n  postService;\n  socketService;\n  dialog;\n  canvasService;\n  user;\n  board;\n  notifications = [];\n  unsubListeners = [];\n  constructor(notificationService, postService, socketService, dialog, canvasService) {\n    this.notificationService = notificationService;\n    this.postService = postService;\n    this.socketService = socketService;\n    this.dialog = dialog;\n    this.canvasService = canvasService;\n  }\n  ngOnInit() {\n    this.notificationService.getByUserAndBoard(this.user.userID, this.board.boardID).then(notifications => {\n      this.notifications = notifications;\n      this.initGroupEventsListener();\n    });\n  }\n  initGroupEventsListener() {\n    const unsub = this.socketService.listen(SocketEvent.BOARD_NOTIFICATION_CREATE, this.handleAdd);\n    this.unsubListeners.push(unsub);\n  }\n  handleAdd = notification => {\n    this.notifications.push(notification);\n  };\n  openPost(notification) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (notification.postID) {\n        const post = yield _this.postService.get(notification.postID);\n        _this.dialog.open(PostModalComponent, {\n          minWidth: '700px',\n          width: 'auto',\n          data: {\n            user: _this.user,\n            post: post,\n            board: _this.board\n          }\n        });\n        yield _this.canvasService.readPost(post.postID);\n        yield _this.notificationService.markAsRead(NotificationType.BOARD, notification.notificationID);\n        _this.deleteNotification(notification);\n      }\n    })();\n  }\n  markAllAsRead() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.notifications.forEach(notification => {\n        _this2.notificationService.markAsRead(NotificationType.BOARD, notification.notificationID);\n        _this2.deleteNotification(notification);\n      });\n    })();\n  }\n  deleteNotification(notification) {\n    if (this.notifications) {\n      this.notifications = this.notifications.filter(currentNotification => currentNotification.notificationID != notification.notificationID);\n    }\n    this.notificationService.remove(NotificationType.BOARD, notification.notificationID);\n  }\n  ngOnDestroy() {\n    this.notifications = [];\n    this.unsubListeners.forEach(unsub => unsub.unsubscribe());\n  }\n  static ɵfac = function NotificationDropdownComponent_Factory(t) {\n    return new (t || NotificationDropdownComponent)(i0.ɵɵdirectiveInject(i1.NotificationService), i0.ɵɵdirectiveInject(i2.PostService), i0.ɵɵdirectiveInject(i3.SocketService), i0.ɵɵdirectiveInject(i4.MatLegacyDialog), i0.ɵɵdirectiveInject(i5.CanvasService));\n  };\n  static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: NotificationDropdownComponent,\n    selectors: [[\"app-notification-dropdown\"]],\n    inputs: {\n      user: \"user\",\n      board: \"board\"\n    },\n    decls: 9,\n    vars: 5,\n    consts: [[\"mat-icon-button\", \"\", \"matTooltip\", \"Board Notifications\", 3, \"matMenuTriggerFor\"], [3, \"matBadge\", 4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"], [\"menu\", \"matMenu\"], [4, \"ngIf\", \"ngIfElse\"], [\"matMenuElse\", \"\"], [3, \"matBadge\"], [\"mat-menu-item\", \"\", \"style\", \"white-space: unset; line-height: normal\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-button\", \"\", 3, \"click\"], [\"mat-menu-item\", \"\", 2, \"white-space\", \"unset\", \"line-height\", \"normal\", 3, \"click\"], [\"mat-menu-item\", \"\"]],\n    template: function NotificationDropdownComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"button\", 0);\n        i0.ɵɵtemplate(1, NotificationDropdownComponent_mat_icon_1_Template, 2, 1, \"mat-icon\", 1);\n        i0.ɵɵtemplate(2, NotificationDropdownComponent_ng_template_2_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"mat-menu\", null, 3);\n        i0.ɵɵtemplate(6, NotificationDropdownComponent_div_6_Template, 4, 1, \"div\", 4);\n        i0.ɵɵtemplate(7, NotificationDropdownComponent_ng_template_7_Template, 2, 0, \"ng-template\", null, 5, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(3);\n        const _r3 = i0.ɵɵreference(5);\n        const _r5 = i0.ɵɵreference(8);\n        i0.ɵɵproperty(\"matMenuTriggerFor\", _r3);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.notifications && ctx.notifications.length > 0)(\"ngIfElse\", _r1);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.notifications && ctx.notifications.length > 0)(\"ngIfElse\", _r5);\n      }\n    },\n    dependencies: [i6.NgForOf, i6.NgIf, i7.MatLegacyButton, i8.MatIcon, i9.MatLegacyTooltip, i10.MatLegacyMenu, i10.MatLegacyMenuItem, i10.MatLegacyMenuTrigger, i11.MatBadge],\n    styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"mappings":"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","names":["NotificationType","SocketEvent","PostModalComponent","i0","NotificationDropdownComponent","notificationService","postService","socketService","dialog","canvasService","user","board","notifications","unsubListeners","constructor","ngOnInit","getByUserAndBoard","userID","boardID","then","initGroupEventsListener","unsub","listen","BOARD_NOTIFICATION_CREATE","handleAdd","push","notification","openPost","postID","post","get","open","minWidth","width","data","readPost","markAsRead","BOARD","notificationID","deleteNotification","markAllAsRead","forEach","filter","currentNotification","remove","ngOnDestroy","unsubscribe","selectors","inputs","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/marieklinaeva/github/ck-board/frontend/src/app/components/notification-dropdown/notification-dropdown.component.ts","/Users/marieklinaeva/github/ck-board/frontend/src/app/components/notification-dropdown/notification-dropdown.component.html"],"sourcesContent":["import { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { MatLegacyDialog as MatDialog } from '@angular/material/legacy-dialog';\nimport { Subscription } from 'rxjs';\nimport { Board } from 'src/app/models/board';\nimport {\n  NotificationType,\n  BoardNotification,\n} from 'src/app/models/notification';\nimport { AuthUser } from 'src/app/models/user';\nimport { CanvasService } from 'src/app/services/canvas.service';\nimport { NotificationService } from 'src/app/services/notification.service';\nimport { PostService } from 'src/app/services/post.service';\nimport { SocketService } from 'src/app/services/socket.service';\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { PostModalComponent } from '../post-modal/post-modal.component';\n\n@Component({\n  selector: 'app-notification-dropdown',\n  templateUrl: './notification-dropdown.component.html',\n  styleUrls: ['./notification-dropdown.component.scss'],\n})\nexport class NotificationDropdownComponent implements OnInit, OnDestroy {\n  @Input() user: AuthUser;\n  @Input() board: Board;\n\n  notifications: BoardNotification[] = [];\n  unsubListeners: Subscription[] = [];\n\n  constructor(\n    private notificationService: NotificationService,\n    private postService: PostService,\n    private socketService: SocketService,\n    public dialog: MatDialog,\n    private canvasService: CanvasService\n  ) {}\n\n  ngOnInit(): void {\n    this.notificationService\n      .getByUserAndBoard(this.user.userID, this.board.boardID)\n      .then((notifications) => {\n        this.notifications = notifications;\n        this.initGroupEventsListener();\n      });\n  }\n\n  initGroupEventsListener() {\n    const unsub = this.socketService.listen(\n      SocketEvent.BOARD_NOTIFICATION_CREATE,\n      this.handleAdd\n    );\n    this.unsubListeners.push(unsub);\n  }\n\n  handleAdd = (notification: BoardNotification) => {\n    this.notifications.push(notification);\n  };\n\n  async openPost(notification: BoardNotification) {\n    if (notification.postID) {\n      const post = await this.postService.get(notification.postID);\n      this.dialog.open(PostModalComponent, {\n        minWidth: '700px',\n        width: 'auto',\n        data: {\n          user: this.user,\n          post: post,\n          board: this.board,\n        },\n      });\n      await this.canvasService.readPost(post.postID);\n      await this.notificationService.markAsRead(\n        NotificationType.BOARD,\n        notification.notificationID\n      );\n      this.deleteNotification(notification);\n    }\n  }\n\n  async markAllAsRead() {\n    this.notifications.forEach((notification) => {\n      this.notificationService.markAsRead(\n        NotificationType.BOARD,\n        notification.notificationID\n      );\n      this.deleteNotification(notification);\n    });\n  }\n\n  deleteNotification(notification: BoardNotification) {\n    if (this.notifications) {\n      this.notifications = this.notifications.filter(\n        (currentNotification) =>\n          currentNotification.notificationID != notification.notificationID\n      );\n    }\n    this.notificationService.remove(\n      NotificationType.BOARD,\n      notification.notificationID\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.notifications = [];\n    this.unsubListeners.forEach((unsub) => unsub.unsubscribe());\n  }\n}\n","<button mat-icon-button [matMenuTriggerFor]=\"menu\" matTooltip=\"Board Notifications\">\n  <mat-icon\n    *ngIf=\"notifications && notifications.length > 0; else elseBlock\"\n    matBadge=\"{{ notifications.length }}\"\n    >notifications_active</mat-icon\n  >\n  <ng-template #elseBlock> <mat-icon>notifications</mat-icon></ng-template>\n</button>\n<mat-menu #menu=\"matMenu\">\n  <div *ngIf=\"notifications && notifications.length > 0; else matMenuElse\">\n    <button\n      mat-menu-item\n      (click)=\"openPost(notification)\"\n      *ngFor=\"let notification of notifications.reverse()\"\n      style=\"white-space: unset; line-height: normal\"\n    >\n      {{ notification.text }}\n    </button>\n    <button mat-button (click)=\"markAllAsRead()\">Mark all as read</button>\n  </div>\n  <ng-template #matMenuElse\n    ><p mat-menu-item>No notifications to display</p></ng-template\n  >\n</mat-menu>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}