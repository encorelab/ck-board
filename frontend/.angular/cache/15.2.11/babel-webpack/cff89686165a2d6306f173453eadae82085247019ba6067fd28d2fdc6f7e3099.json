{"ast":null,"code":"import _asyncToGenerator from \"/Users/marieklinaeva/github/ck-board/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormControl, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { MyErrorStateMatcher } from 'src/app/utils/ErrorStateMatcher';\nimport { Role } from 'src/app/models/user';\nimport { ContentType, PostType } from 'src/app/models/post';\nimport { DELETE } from '@angular/cdk/keycodes';\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { ConfirmModalComponent } from '../confirm-modal/confirm-modal.component';\nimport { generateUniqueID, getErrorMessage } from 'src/app/utils/Utils';\nimport { AddPostComponent } from '../add-post-modal/add-post.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"src/app/services/comment.service\";\nimport * as i3 from \"src/app/services/upvotes.service\";\nimport * as i4 from \"src/app/services/post.service\";\nimport * as i5 from \"src/app/services/bucket.service\";\nimport * as i6 from \"src/app/services/socket.service\";\nimport * as i7 from \"src/app/services/project.service\";\nimport * as i8 from \"src/app/services/canvas.service\";\nimport * as i9 from \"src/app/services/user.service\";\nimport * as i10 from \"src/app/utils/FabricUtils\";\nimport * as i11 from \"src/app/services/snackbar.service\";\nimport * as i12 from \"src/app/services/board.service\";\nfunction PostModalComponent_div_0_mat_card_1_mat_card_subtitle_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card-subtitle\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r11.author.username);\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card-subtitle\");\n    i0.ɵɵtext(1, \"Anonymous\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r26 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r26.savePostToPersonalBoard());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"star_border\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r31 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_div_18_Template_div_click_0_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementStart(1, \"mat-checkbox\", 35);\n    i0.ɵɵlistener(\"change\", function PostModalComponent_div_0_mat_card_1_div_18_Template_mat_checkbox_change_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r31);\n      const bucket_r28 = restoredCtx.$implicit;\n      const ctx_r30 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r30.updatePostContainer($event, ctx_r30.PostType.BUCKET, bucket_r28));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const bucket_r28 = ctx.$implicit;\n    const ctx_r16 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"id\", bucket_r28.bucketID);\n    i0.ɵɵproperty(\"checked\", ctx_r16.bucketIncludesPost(bucket_r28));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(bucket_r28.name);\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_button_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_button_19_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r32 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r32.toggleEdit());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"edit\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_button_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r35 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_button_20_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r35);\n      const ctx_r34 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r34.onDelete());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"delete\");\n    i0.ɵɵelementEnd()();\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"background-color\": a0\n  };\n};\nfunction PostModalComponent_div_0_mat_card_1_div_24_mat_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r39 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-card\", 38);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_div_24_mat_card_1_Template_mat_card_click_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r39);\n      const multipleChoice_r37 = restoredCtx.$implicit;\n      const ctx_r38 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r38.selectMultipleChoice($event, multipleChoice_r37));\n    });\n    i0.ɵɵelementStart(1, \"mat-card-title\", 39);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const multipleChoice_r37 = ctx.$implicit;\n    const ctx_r36 = i0.ɵɵnextContext(4);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(2, _c0, ctx_r36.isMultipleChoiceSelected && ctx_r36.selectedMultipleChoice === multipleChoice_r37 ? ctx_r36.submitMultipleChoiceAnswer ? multipleChoice_r37.correct ? \"#39e75f\" : \"#ff0000\" : \"#D3D3D3\" : \"white\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", multipleChoice_r37.optionTitle, \" \");\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r41 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, PostModalComponent_div_0_mat_card_1_div_24_mat_card_1_Template, 3, 4, \"mat-card\", 36);\n    i0.ɵɵelementStart(2, \"mat-chip\", 37);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_div_24_Template_mat_chip_click_2_listener() {\n      i0.ɵɵrestoreView(_r41);\n      const ctx_r40 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r40.answerMultipleChoice());\n    });\n    i0.ɵɵtext(3, \" Check Answer \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r19 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r19.multipleChoiceOptions);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r19.isMultipleChoiceSelected);\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_mat_chip_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-chip\", 40);\n    i0.ɵɵtext(1, \" Add Tag \");\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"add\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r23 = i0.ɵɵreference(41);\n    i0.ɵɵproperty(\"matMenuTriggerFor\", _r23);\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_mat_chip_39_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r44 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-chip\", 41);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"mat-icon\", 42);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_mat_chip_39_Template_mat_icon_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r44);\n      const tag_r42 = restoredCtx.$implicit;\n      const ctx_r43 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r43.removeTag(tag_r42));\n    });\n    i0.ɵɵtext(3, \"cancel\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const tag_r42 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(2, _c0, tag_r42.color));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", tag_r42.name, \" \");\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 43);\n    i0.ɵɵtext(1, \" No tags available. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PostModalComponent_div_0_mat_card_1_div_43_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r47 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_div_43_Template_div_click_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r47);\n      const tagOption_r45 = restoredCtx.$implicit;\n      const ctx_r46 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r46.addTag($event, tagOption_r45));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const tagOption_r45 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", tagOption_r45.name, \" \");\n  }\n}\nconst _c1 = function () {\n  return {\n    color: \"#4f47ff\"\n  };\n};\nfunction PostModalComponent_div_0_mat_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r50 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-card\", 9)(1, \"mat-card-header\");\n    i0.ɵɵelement(2, \"div\", 10);\n    i0.ɵɵelementStart(3, \"mat-card-title\", 11);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"span\", 12);\n    i0.ɵɵtemplate(6, PostModalComponent_div_0_mat_card_1_mat_card_subtitle_6_Template, 2, 1, \"mat-card-subtitle\", 13);\n    i0.ɵɵtemplate(7, PostModalComponent_div_0_mat_card_1_ng_template_7_Template, 2, 0, \"ng-template\", null, 14, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtemplate(9, PostModalComponent_div_0_mat_card_1_button_9_Template, 3, 0, \"button\", 15);\n    i0.ɵɵelementStart(10, \"button\", 16)(11, \"mat-icon\");\n    i0.ɵɵtext(12, \"library_add\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"mat-menu\", null, 17)(15, \"div\", 18);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_Template_div_click_15_listener($event) {\n      return $event.stopPropagation();\n    });\n    i0.ɵɵelementStart(16, \"mat-checkbox\", 19);\n    i0.ɵɵlistener(\"change\", function PostModalComponent_div_0_mat_card_1_Template_mat_checkbox_change_16_listener($event) {\n      i0.ɵɵrestoreView(_r50);\n      const ctx_r49 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r49.updatePostContainer($event, ctx_r49.PostType.BOARD, null));\n    });\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(18, PostModalComponent_div_0_mat_card_1_div_18_Template, 3, 3, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(19, PostModalComponent_div_0_mat_card_1_button_19_Template, 3, 0, \"button\", 21);\n    i0.ɵɵtemplate(20, PostModalComponent_div_0_mat_card_1_button_20_Template, 3, 0, \"button\", 21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"mat-card-content\")(22, \"p\", 22);\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(24, PostModalComponent_div_0_mat_card_1_div_24_Template, 4, 2, \"div\", 0);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"mat-card-actions\", 23)(26, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_Template_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r50);\n      const ctx_r51 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r51.handleUpvoteClick());\n    });\n    i0.ɵɵelementStart(27, \"mat-icon\", 25);\n    i0.ɵɵtext(28, \"arrow_drop_up\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(29, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_Template_button_click_29_listener() {\n      i0.ɵɵrestoreView(_r50);\n      const ctx_r52 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r52.gotoUpvotesView());\n    });\n    i0.ɵɵtext(30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_mat_card_1_Template_button_click_31_listener() {\n      i0.ɵɵrestoreView(_r50);\n      const ctx_r53 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r53.handleDownvoteClick());\n    });\n    i0.ɵɵelementStart(32, \"mat-icon\", 25);\n    i0.ɵɵtext(33, \"arrow_drop_down\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(34, \"mat-card-actions\", 27)(35, \"mat-form-field\", 28)(36, \"mat-chip-list\", null, 29);\n    i0.ɵɵtemplate(38, PostModalComponent_div_0_mat_card_1_mat_chip_38_Template, 4, 1, \"mat-chip\", 30);\n    i0.ɵɵtemplate(39, PostModalComponent_div_0_mat_card_1_mat_chip_39_Template, 4, 4, \"mat-chip\", 31);\n    i0.ɵɵelementStart(40, \"mat-menu\", null, 32);\n    i0.ɵɵtemplate(42, PostModalComponent_div_0_mat_card_1_div_42_Template, 2, 0, \"div\", 33);\n    i0.ɵɵtemplate(43, PostModalComponent_div_0_mat_card_1_div_43_Template, 2, 1, \"div\", 20);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const _r12 = i0.ɵɵreference(8);\n    const _r15 = i0.ɵɵreference(14);\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r5.editingTitle, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r5.editingTitle);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.showAuthorName && ctx_r5.author)(\"ngIfElse\", _r12);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r5.project == null ? null : ctx_r5.project.personalBoardSetting == null ? null : ctx_r5.project.personalBoardSetting.enabled) && (ctx_r5.post == null ? null : ctx_r5.post.type) === ctx_r5.PostType.BOARD && ctx_r5.data.board.scope === \"PROJECT_SHARED\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matMenuTriggerFor\", _r15);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"checked\", ctx_r5.post && ctx_r5.post.type === ctx_r5.PostType.BOARD);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r5.data.board.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.buckets);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r5.isEditing && ctx_r5.showEditDelete && ctx_r5.canEditDelete);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.showEditDelete && ctx_r5.canEditDelete);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r5.editingDesc, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r5.editingDesc, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.contentType === \"MULTIPLE_CHOICE\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngStyle\", ctx_r5.isUpvoted() && i0.ɵɵpureFunction0(21, _c1));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngStyle\", ctx_r5.isUpvoted() && i0.ɵɵpureFunction0(22, _c1));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r5.upvotes.length, \" \");\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.canStudentTag);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.tags);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.tagOptions && ctx_r5.tagOptions.length === 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.tagOptions);\n  }\n}\nfunction PostModalComponent_div_0_mat_form_field_2_mat_error_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Title is \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"required\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_mat_form_field_2_mat_error_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Title is \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"too long!\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_mat_form_field_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r57 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-form-field\", 44)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 45);\n    i0.ɵɵlistener(\"ngModelChange\", function PostModalComponent_div_0_mat_form_field_2_Template_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r57);\n      const ctx_r56 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r56.title = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, PostModalComponent_div_0_mat_form_field_2_mat_error_4_Template, 4, 0, \"mat-error\", 0);\n    i0.ɵɵtemplate(5, PostModalComponent_div_0_mat_form_field_2_mat_error_5_Template, 4, 0, \"mat-error\", 0);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r6.titleControl)(\"errorStateMatcher\", ctx_r6.matcher)(\"ngModel\", ctx_r6.title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r6.title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.title && ctx_r6.title.length > 50);\n  }\n}\nfunction PostModalComponent_div_0_mat_form_field_3_mat_error_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Description is \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"too long!\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_mat_form_field_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r60 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-form-field\", 46)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Description\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"textarea\", 47);\n    i0.ɵɵlistener(\"ngModelChange\", function PostModalComponent_div_0_mat_form_field_3_Template_textarea_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r60);\n      const ctx_r59 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r59.desc = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, PostModalComponent_div_0_mat_form_field_3_mat_error_4_Template, 4, 0, \"mat-error\", 0);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r7.descControl)(\"errorStateMatcher\", ctx_r7.matcher)(\"ngModel\", ctx_r7.desc);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.desc && ctx_r7.desc.length > 2000);\n  }\n}\nfunction PostModalComponent_div_0_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r62 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 48);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r62);\n      const ctx_r61 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r61.onUpdate());\n    });\n    i0.ɵɵtext(1, \" Update \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r8.titleControl.valid || !ctx_r8.descControl.valid);\n  }\n}\nfunction PostModalComponent_div_0_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r64 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r64);\n      const ctx_r63 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r63.toggleEdit());\n    });\n    i0.ɵɵtext(1, \"Cancel\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PostModalComponent_div_0_div_7_div_6_mat_card_1_button_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r72 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 60);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_div_7_div_6_mat_card_1_button_3_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r72);\n      const comment_r68 = i0.ɵɵnextContext().$implicit;\n      const ctx_r70 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r70.deleteComment(comment_r68));\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"delete\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PostModalComponent_div_0_div_7_div_6_mat_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 57)(1, \"mat-card-title\", 58);\n    i0.ɵɵtext(2);\n    i0.ɵɵtemplate(3, PostModalComponent_div_0_div_7_div_6_mat_card_1_button_3_Template, 3, 0, \"button\", 59);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-card-content\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const comment_r68 = ctx.$implicit;\n    const ctx_r67 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", comment_r68.author, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r67.showEditDelete && ctx_r67.canEditDelete || comment_r68.userID === ctx_r67.user.userID);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", comment_r68.comment, \" \");\n  }\n}\nfunction PostModalComponent_div_0_div_7_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 55);\n    i0.ɵɵtemplate(1, PostModalComponent_div_0_div_7_div_6_mat_card_1_Template, 6, 3, \"mat-card\", 56);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r65 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r65.comments);\n  }\n}\nfunction PostModalComponent_div_0_div_7_mat_form_field_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r74 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-form-field\", 61)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Add Comment\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 62);\n    i0.ɵɵlistener(\"ngModelChange\", function PostModalComponent_div_0_div_7_mat_form_field_7_Template_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r74);\n      const ctx_r73 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r73.newComment = $event);\n    })(\"keyup.enter\", function PostModalComponent_div_0_div_7_mat_form_field_7_Template_input_keyup_enter_3_listener() {\n      i0.ɵɵrestoreView(_r74);\n      const ctx_r75 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r75.newComment ? ctx_r75.addComment() : \"\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 63);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_div_7_mat_form_field_7_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r74);\n      const ctx_r76 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r76.addComment());\n    });\n    i0.ɵɵtext(5, \" Comment! \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r66 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"appAutofocus\", ctx_r66.showComments)(\"ngModel\", ctx_r66.newComment);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r66.newComment);\n  }\n}\nfunction PostModalComponent_div_0_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r78 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 50)(1, \"div\", 51)(2, \"button\", 52);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_div_0_div_7_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r78);\n      const ctx_r77 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r77.toggleComments());\n    });\n    i0.ɵɵtext(3);\n    i0.ɵɵelementStart(4, \"mat-icon\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(6, PostModalComponent_div_0_div_7_div_6_Template, 2, 1, \"div\", 53);\n    i0.ɵɵtemplate(7, PostModalComponent_div_0_div_7_mat_form_field_7_Template, 6, 3, \"mat-form-field\", 54);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Comments (\", ctx_r10.comments.length, \") \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r10.showComments ? \"expand_less\" : \"expand_more\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.showComments);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.showComments && ctx_r10.canStudentComment);\n  }\n}\nfunction PostModalComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, PostModalComponent_div_0_mat_card_1_Template, 44, 23, \"mat-card\", 4);\n    i0.ɵɵtemplate(2, PostModalComponent_div_0_mat_form_field_2_Template, 6, 5, \"mat-form-field\", 5);\n    i0.ɵɵtemplate(3, PostModalComponent_div_0_mat_form_field_3_Template, 5, 4, \"mat-form-field\", 6);\n    i0.ɵɵelementStart(4, \"div\", 1);\n    i0.ɵɵtemplate(5, PostModalComponent_div_0_button_5_Template, 2, 1, \"button\", 7);\n    i0.ɵɵtemplate(6, PostModalComponent_div_0_button_6_Template, 2, 0, \"button\", 3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, PostModalComponent_div_0_div_7_Template, 8, 4, \"div\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.isEditing);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isEditing);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isEditing && ctx_r0.contentType === \"OPEN_RESPONSE_MESSAGE\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isEditing);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isEditing);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.isEditing);\n  }\n}\nfunction PostModalComponent_div_1_mat_list_item_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-list-item\", 65);\n    i0.ɵɵelement(1, \"div\", 66);\n    i0.ɵɵelementStart(2, \"div\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"span\", 2);\n    i0.ɵɵelementStart(5, \"div\", 67);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-icon\", 68);\n    i0.ɵɵtext(8, \"arrow_upward\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const upvote_r80 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(upvote_r80.value.user.username);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", upvote_r80.value.amount, \" \");\n  }\n}\nfunction PostModalComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-list\");\n    i0.ɵɵtemplate(2, PostModalComponent_div_1_mat_list_item_2_Template, 9, 2, \"mat-list-item\", 64);\n    i0.ɵɵpipe(3, \"keyvalue\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(3, 1, ctx_r1.expandedUpvotes));\n  }\n}\nfunction PostModalComponent_mat_error_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r2.error);\n  }\n}\nfunction PostModalComponent_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r82 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r82);\n      const ctx_r81 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r81.gotoPostView());\n    });\n    i0.ɵɵtext(1, \" Back to Post \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PostModalComponent_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r84 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function PostModalComponent_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r84);\n      const ctx_r83 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r83.close());\n    });\n    i0.ɵɵtext(1, \"Close\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst linkifyStr = require('linkifyjs/lib/linkify-string');\nexport var PostModalEvent;\n(function (PostModalEvent) {\n  PostModalEvent[\"POST_UPVOTE\"] = \"POST_UPVOTE\";\n  PostModalEvent[\"POST_DOWNVOTE\"] = \"POST_DOWNVOTE\";\n  PostModalEvent[\"POST_ADD_COMMENT\"] = \"POST_ADD_COMMENT\";\n  PostModalEvent[\"POST_REMOVE_COMMENT\"] = \"POST_REMOVE_COMMENT\";\n  PostModalEvent[\"POST_ADD_TAG\"] = \"POST_ADD_TAG\";\n  PostModalEvent[\"POST_REMOVE_TAG\"] = \"POST_REMOVE_TAG\";\n})(PostModalEvent || (PostModalEvent = {}));\nexport class PostModalData {\n  constructor() {\n    this.numSavedPosts = 0;\n  }\n}\nexport class PostModalComponent {\n  constructor(dialogRef, dialog, commentService, upvotesService, postService, bucketService, socketService, projectService, canvasService, userService, fabricUtils, snackbarService, boardService, data) {\n    var _this = this;\n    this.dialogRef = dialogRef;\n    this.dialog = dialog;\n    this.commentService = commentService;\n    this.upvotesService = upvotesService;\n    this.postService = postService;\n    this.bucketService = bucketService;\n    this.socketService = socketService;\n    this.projectService = projectService;\n    this.canvasService = canvasService;\n    this.userService = userService;\n    this.fabricUtils = fabricUtils;\n    this.snackbarService = snackbarService;\n    this.boardService = boardService;\n    this.data = data;\n    this.tags = [];\n    this.tagOptions = [];\n    this.multipleChoiceOptions = [];\n    this.isMultipleChoiceSelected = false;\n    this.submitMultipleChoiceAnswer = false;\n    this.PostType = PostType;\n    this.isEditing = false;\n    this.showComments = false;\n    this.showEditDelete = false;\n    this.error = '';\n    this.titleControl = new FormControl('', [Validators.required, Validators.maxLength(50)]);\n    this.descControl = new FormControl('', [Validators.maxLength(2000)]);\n    this.matcher = new MyErrorStateMatcher();\n    this.comments = [];\n    this.upvotes = [];\n    this.expandedUpvotesView = false;\n    this.expandedUpvotes = [];\n    dialogRef.backdropClick().subscribe(() => this.close());\n    this.user = data.user;\n    this.numSavedPosts = data.numSavedPosts;\n    this.contentType = data.post.contentType;\n    this.showComments = (data === null || data === void 0 ? void 0 : data.commentPress) ? true : false;\n    this.postService.get(data.post.postID).then( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (p) {\n        _this.post = p;\n        _this.postColor = p.displayAttributes.fillColor;\n        _this.title = p.title;\n        _this.editingTitle = linkifyStr(p.title, {\n          defaultProtocol: 'https',\n          target: '_blank'\n        });\n        _this.desc = p.desc;\n        _this.editingDesc = linkifyStr(p.desc, {\n          defaultProtocol: 'https',\n          target: '_blank'\n        }).replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n        _this.tags = p.tags;\n        _this.tagOptions = data.board.tags.filter(n => !_this.tags.map(b => b.name).includes(n.name));\n        _this.canEditDelete = _this.data.post.userID == _this.user.userID || _this.user.role == Role.TEACHER;\n        _this.author = yield _this.userService.getOneById(p.userID);\n        _this.contentType = p.contentType;\n        if (_this.contentType === ContentType.MULTIPLE_CHOICE) {\n          _this.multipleChoiceOptions = p.multipleChoice;\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    this.commentService.getCommentsByPost(data.post.postID).then(data => {\n      data.forEach(comment => {\n        this.comments.push(comment);\n      });\n    });\n    this.upvotesService.getUpvotesByPost(data.post.postID).then(data => {\n      data.forEach(upvote => {\n        this.upvotes.push(upvote);\n      });\n    });\n    this.bucketService.getAllByBoard(this.data.board.boardID).then(buckets => {\n      this.buckets = buckets;\n    });\n    const isStudent = this.user.role == Role.STUDENT;\n    const isTeacher = this.user.role == Role.TEACHER;\n    this.showEditDelete = isStudent && data.board.permissions.allowStudentEditAddDeletePost || isTeacher;\n    this.canStudentComment = isStudent && data.board.permissions.allowStudentCommenting || isTeacher;\n    this.canStudentTag = isStudent && data.board.permissions.allowStudentTagging || isTeacher;\n    this.showAuthorName = isStudent && data.board.permissions.showAuthorNameStudent || isTeacher && data.board.permissions.showAuthorNameTeacher;\n  }\n  ngOnInit() {\n    this.projectService.get(this.data.board.projectID).then(project => {\n      this.project = project;\n    });\n  }\n  close() {\n    this.dialogRef.close(this.post);\n  }\n  updatePostContainer(event, destType, bucket) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (destType == PostType.BOARD) {\n        if (event.checked) {\n          _this2.post = yield _this2.canvasService.createBoardPostFromBucket(_this2.post);\n        } else {\n          _this2.post = (yield _this2.canvasService.clearPostsFromBoard([_this2.post]))[0];\n        }\n      }\n      if (destType == PostType.BUCKET && bucket) {\n        const bucketID = bucket.bucketID;\n        const postID = _this2.post.postID;\n        if (event.checked) {\n          bucket.posts.push(postID);\n          yield _this2.bucketService.add(bucketID, postID);\n        } else {\n          bucket.posts = bucket.posts.filter(id => id !== postID);\n          yield _this2.bucketService.remove(bucketID, postID);\n        }\n      }\n    })();\n  }\n  toggleEdit() {\n    if (this.contentType === ContentType.MULTIPLE_CHOICE) {\n      this.editMultipleChoicePost();\n    } else {\n      this.isEditing = !this.isEditing;\n    }\n  }\n  toggleComments() {\n    this.showComments = !this.showComments;\n  }\n  onUpdate() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.editingTitle = _this3.title;\n      _this3.editingDesc = linkifyStr(_this3.desc, {\n        defaultProtocol: 'https',\n        target: '_blank'\n      }).replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n      const update = {\n        postID: _this3.post.postID,\n        title: _this3.title,\n        desc: _this3.desc\n      };\n      _this3.socketService.emit(SocketEvent.POST_UPDATE, update);\n      _this3.toggleEdit();\n    })();\n  }\n  onDelete() {\n    var _this4 = this;\n    this.dialog.open(ConfirmModalComponent, {\n      width: '500px',\n      data: {\n        title: 'Confirmation',\n        message: 'Are you sure you want to permanently delete this post?',\n        handleConfirm: function () {\n          var _ref2 = _asyncToGenerator(function* () {\n            yield _this4.canvasService.removePost(_this4.post);\n            _this4.dialogRef.close(DELETE);\n          });\n          return function handleConfirm() {\n            return _ref2.apply(this, arguments);\n          };\n        }()\n      }\n    });\n  }\n  addTag(event, tagOption) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      event.stopPropagation();\n      _this5.post = yield _this5.canvasService.tag(_this5.post, tagOption);\n      _this5.tags.push(tagOption);\n      _this5.tagOptions = _this5.tagOptions.filter(tag => tag != tagOption);\n      if (_this5.data.onTagEvent) {\n        _this5.data.onTagEvent(_this5.post.postID, 'add');\n      }\n    })();\n  }\n  removeTag(tag) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this6.canStudentTag) return;\n      _this6.post = yield _this6.canvasService.untag(_this6.post, tag);\n      const index = _this6.tags.indexOf(tag);\n      if (index >= 0) {\n        _this6.tags.splice(index, 1);\n      }\n      _this6.tagOptions.push(tag);\n      if (_this6.data.onTagEvent) {\n        _this6.data.onTagEvent(_this6.post.postID, 'remove');\n      }\n    })();\n  }\n  addComment() {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      const comment = {\n        comment: _this7.newComment,\n        commentID: generateUniqueID(),\n        userID: _this7.data.user.userID,\n        postID: _this7.post.postID,\n        boardID: _this7.data.board.boardID,\n        author: _this7.data.user.username\n      };\n      yield _this7.canvasService.comment(comment);\n      _this7.newComment = '';\n      _this7.comments.push(comment);\n      if (_this7.data.onCommentEvent) {\n        _this7.data.onCommentEvent(_this7.post.postID, 'add');\n      }\n    })();\n  }\n  deleteComment(comment) {\n    var _this8 = this;\n    return _asyncToGenerator(function* () {\n      _this8.dialog.open(ConfirmModalComponent, {\n        width: '500px',\n        data: {\n          title: 'Confirmation',\n          message: 'Are you sure you want to delete this comment?',\n          handleConfirm: function () {\n            var _ref3 = _asyncToGenerator(function* () {\n              yield _this8.canvasService.deleteComment(comment.commentID, comment.postID);\n              const ind = _this8.comments.indexOf(comment);\n              if (ind != -1) {\n                _this8.comments.splice(ind, 1);\n              }\n              if (_this8.data.onCommentEvent) {\n                _this8.data.onCommentEvent(_this8.post.postID, 'remove');\n              }\n            });\n            return function handleConfirm() {\n              return _ref3.apply(this, arguments);\n            };\n          }()\n        }\n      });\n    })();\n  }\n  savePostToPersonalBoard() {\n    var _this9 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const personalBoard = yield _this9.boardService.getPersonal(_this9.project.projectID);\n        if (!personalBoard) return;\n        if (_this9.post.displayAttributes) {\n          const postOffset = 50 * _this9.numSavedPosts;\n          _this9.numSavedPosts += 1;\n          if (_this9.data.updateNumSavedPosts) _this9.data.updateNumSavedPosts(_this9.numSavedPosts);\n          const position = {\n            top: _this9.canvasService.centerPos.top + postOffset,\n            left: _this9.canvasService.centerPos.left + postOffset\n          };\n          _this9.post.displayAttributes.position = position;\n        }\n        const post = {\n          postID: generateUniqueID(),\n          userID: _this9.user.userID,\n          boardID: personalBoard.boardID,\n          type: PostType.BOARD,\n          contentType: _this9.contentType,\n          multipleChoice: _this9.multipleChoiceOptions,\n          title: _this9.title,\n          author: _this9.user.username,\n          desc: _this9.desc,\n          tags: _this9.tags,\n          displayAttributes: _this9.post.displayAttributes\n        };\n        const newPost = yield _this9.postService.create(post);\n        if (newPost) _this9.openSnackBar('Successfully copied to your Personal Board');\n      } catch (error) {\n        _this9.openSnackBar('Unable to copy post to your Personal Board. Please refresh and try again!');\n      }\n    })();\n  }\n  handleUpvoteClick() {\n    var _this10 = this;\n    return _asyncToGenerator(function* () {\n      if (_this10._votingLocked()) return _this10._setError(getErrorMessage('Voting is disabled!'));\n      _this10.canvasService.upvote(_this10.user.userID, _this10.post).then(upvote => _this10.upvotes.push(upvote)).catch(e => _this10._setError(getErrorMessage(e)));\n    })();\n  }\n  handleDownvoteClick() {\n    var _this11 = this;\n    return _asyncToGenerator(function* () {\n      if (_this11._votingLocked()) return _this11._setError(getErrorMessage('Voting is disabled!'));\n      _this11.canvasService.unupvote(_this11.user.userID, _this11.post.postID).then(upvote => {\n        _this11.upvotes = _this11.upvotes.filter(u => u.upvoteID != upvote.upvoteID);\n      }).catch(e => _this11._setError(getErrorMessage(e)));\n    })();\n  }\n  isUpvoted() {\n    return this.upvotes.some(u => u.voterID === this.user.userID);\n  }\n  gotoUpvotesView() {\n    var _this12 = this;\n    return _asyncToGenerator(function* () {\n      _this12.expandedUpvotes = yield _this12.upvotesService.getUpvotesByPost(_this12.post.postID, 'grouped');\n      if (!_this12.expandedUpvotes || Object.keys(_this12.expandedUpvotes).length == 0) {\n        return _this12._setError('No upvotes found!');\n      }\n      _this12.dialogRef.updateSize('30vw');\n      _this12.expandedUpvotesView = true;\n    })();\n  }\n  gotoPostView() {\n    this.dialogRef.updateSize('95vw');\n    this.expandedUpvotesView = false;\n  }\n  answerMultipleChoice() {\n    this.submitMultipleChoiceAnswer = true;\n    if (this.isMultipleChoiceSelected && this.selectedMultipleChoice) {\n      if (this.selectedMultipleChoice.correct) {\n        this.snackbarService.queueSnackbar('Correct Answer!');\n      } else {\n        this.snackbarService.queueSnackbar('Incorrect, please try again.');\n      }\n    }\n  }\n  selectMultipleChoice(event, multipleChoice) {\n    event.stopPropagation();\n    this.submitMultipleChoiceAnswer = false;\n    this.isMultipleChoiceSelected = true;\n    this.selectedMultipleChoice = multipleChoice;\n  }\n  editMultipleChoicePost() {\n    var _this13 = this;\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e, _f;\n      _this13.dialog.open(AddPostComponent, {\n        width: '800px',\n        autoFocus: false,\n        data: {\n          type: _this13.post.type,\n          board: _this13.data.board,\n          user: _this13.user,\n          spawnPosition: {\n            top: ((_b = (_a = _this13.post.displayAttributes) === null || _a === void 0 ? void 0 : _a.position) === null || _b === void 0 ? void 0 : _b.top) ? (_c = _this13.post.displayAttributes) === null || _c === void 0 ? void 0 : _c.position.top : 150,\n            left: ((_e = (_d = _this13.post.displayAttributes) === null || _d === void 0 ? void 0 : _d.position) === null || _e === void 0 ? void 0 : _e.left) ? (_f = _this13.post.displayAttributes) === null || _f === void 0 ? void 0 : _f.position.top : 150\n          },\n          editingPost: _this13.post,\n          onComplete: function () {\n            var _ref4 = _asyncToGenerator(function* (post) {\n              _this13.socketService.emit(SocketEvent.POST_UPDATE, post);\n              if (post.title) {\n                _this13.title = post.title;\n                _this13.post.title = post.title;\n                _this13.editingTitle = linkifyStr(post.title, {\n                  defaultProtocol: 'https',\n                  target: '_blank'\n                });\n              }\n              if (post.tags) _this13.tags = post.tags;\n              if (post.multipleChoice) _this13.multipleChoiceOptions = post.multipleChoice;\n            });\n            return function onComplete(_x2) {\n              return _ref4.apply(this, arguments);\n            };\n          }()\n        }\n      });\n    })();\n  }\n  bucketIncludesPost(bucket) {\n    return bucket.posts.findIndex(post => post.postID == this.post.postID) > -1;\n  }\n  openSnackBar(message) {\n    this.snackbarService.queueSnackbar(message);\n  }\n  _votingLocked() {\n    return this.user.role == Role.STUDENT && !this.data.board.permissions.allowStudentUpvoting;\n  }\n  _setError(error) {\n    this.error = error;\n    setTimeout(() => this.error = '', 5000);\n  }\n}\nPostModalComponent.ɵfac = function PostModalComponent_Factory(t) {\n  return new (t || PostModalComponent)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i2.CommentService), i0.ɵɵdirectiveInject(i3.UpvotesService), i0.ɵɵdirectiveInject(i4.PostService), i0.ɵɵdirectiveInject(i5.BucketService), i0.ɵɵdirectiveInject(i6.SocketService), i0.ɵɵdirectiveInject(i7.ProjectService), i0.ɵɵdirectiveInject(i8.CanvasService), i0.ɵɵdirectiveInject(i9.UserService), i0.ɵɵdirectiveInject(i10.FabricUtils), i0.ɵɵdirectiveInject(i11.SnackbarService), i0.ɵɵdirectiveInject(i12.BoardService), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n};\nPostModalComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PostModalComponent,\n  selectors: [[\"app-post-modal\"]],\n  decls: 7,\n  vars: 5,\n  consts: [[4, \"ngIf\"], [\"mat-dialog-actions\", \"\"], [2, \"flex\", \"1 1 auto\"], [\"mat-button\", \"\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"details\", 4, \"ngIf\"], [\"appearance\", \"outline\", \"style\", \"width: 100%; margin-top: 20px\", 4, \"ngIf\"], [\"appearance\", \"outline\", \"style\", \"width: 100%\", 4, \"ngIf\"], [\"mat-button\", \"\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"class\", \"comment-area\", 4, \"ngIf\"], [1, \"details\"], [\"mat-card-avatar\", \"\", 1, \"avatar\"], [3, \"innerHTML\"], [1, \"fill-remaining-space\"], [4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Save post to personal board\", 3, \"click\", 4, \"ngIf\"], [\"mat-icon-button\", \"\", 3, \"matMenuTriggerFor\"], [\"bucketMenu\", \"matMenu\"], [\"mat-menu-item\", \"\", 3, \"click\"], [3, \"checked\", \"change\"], [\"mat-menu-item\", \"\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-icon-button\", \"\", 3, \"click\", 4, \"ngIf\"], [2, \"overflow-wrap\", \"break-word\", 3, \"innerHTML\"], [\"align\", \"end\", 2, \"margin-bottom\", \"-1.25em\"], [\"mat-icon-button\", \"\", 3, \"ngStyle\", \"click\"], [2, \"transform\", \"scale(2)\"], [\"mat-icon-button\", \"\", 3, \"click\"], [2, \"margin-bottom\", \"-1.25em\"], [\"appearance\", \"standard\", 1, \"tag-form\"], [\"chipList\", \"\"], [\"style\", \"background-color: #78c2c0\", 3, \"matMenuTriggerFor\", 4, \"ngIf\"], [3, \"ngStyle\", 4, \"ngFor\", \"ngForOf\"], [\"menu1\", \"matMenu\"], [\"mat-menu-item\", \"\", 4, \"ngIf\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Save post to personal board\", 3, \"click\"], [3, \"id\", \"checked\", \"change\"], [\"style\", \"\\n            display: flex;\\n            margin: 10px 0;\\n            padding: 10px;\\n            justify-content: space-between;\\n          \", 3, \"ngStyle\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"color\", \"primary\", \"selected\", \"\", 3, \"disabled\", \"click\"], [2, \"display\", \"flex\", \"margin\", \"10px 0\", \"padding\", \"10px\", \"justify-content\", \"space-between\", 3, \"ngStyle\", \"click\"], [2, \"font-size\", \"small\", \"margin\", \"auto 0\"], [2, \"background-color\", \"#78c2c0\", 3, \"matMenuTriggerFor\"], [3, \"ngStyle\"], [1, \"cancel\", 3, \"click\"], [\"mat-menu-item\", \"\"], [\"appearance\", \"outline\", 2, \"width\", \"100%\", \"margin-top\", \"20px\"], [\"matInput\", \"\", 3, \"formControl\", \"errorStateMatcher\", \"ngModel\", \"ngModelChange\"], [\"appearance\", \"outline\", 2, \"width\", \"100%\"], [\"matInput\", \"\", \"rows\", \"5\", \"cols\", \"40\", 3, \"formControl\", \"errorStateMatcher\", \"ngModel\", \"ngModelChange\"], [\"mat-button\", \"\", 3, \"disabled\", \"click\"], [\"mat-button\", \"\", 3, \"click\"], [1, \"comment-area\"], [1, \"comments-header\"], [\"mat-button\", \"\", 1, \"comment-toggler\", 3, \"click\"], [\"class\", \"comment-box\", 4, \"ngIf\"], [\"class\", \"add-comment\", \"appearance\", \"outline\", 4, \"ngIf\"], [1, \"comment-box\"], [\"class\", \"comment\", 4, \"ngFor\", \"ngForOf\"], [1, \"comment\"], [2, \"font-size\", \"small\"], [\"mat-icon-button\", \"\", \"class\", \"comment-delete\", 3, \"click\", 4, \"ngIf\"], [\"mat-icon-button\", \"\", 1, \"comment-delete\", 3, \"click\"], [\"appearance\", \"outline\", 1, \"add-comment\"], [\"matInput\", \"\", 3, \"appAutofocus\", \"ngModel\", \"ngModelChange\", \"keyup.enter\"], [\"color\", \"primary\", \"matSuffix\", \"\", \"mat-button\", \"\", 3, \"disabled\", \"click\"], [\"style\", \"justify-content: space-between\", 4, \"ngFor\", \"ngForOf\"], [2, \"justify-content\", \"space-between\"], [\"mat-card-avatar\", \"\", 1, \"avatar\", 2, \"margin-right\", \"20px\"], [2, \"color\", \"'#4f47ff'\", \"margin-right\", \"5px\"], [\"mat-icon\", \"\", 2, \"color\", \"'#4f47ff'\"]],\n  template: function PostModalComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, PostModalComponent_div_0_Template, 8, 6, \"div\", 0);\n      i0.ɵɵtemplate(1, PostModalComponent_div_1_Template, 4, 3, \"div\", 0);\n      i0.ɵɵelementStart(2, \"div\", 1);\n      i0.ɵɵtemplate(3, PostModalComponent_mat_error_3_Template, 2, 1, \"mat-error\", 0);\n      i0.ɵɵelement(4, \"span\", 2);\n      i0.ɵɵtemplate(5, PostModalComponent_button_5_Template, 2, 0, \"button\", 3);\n      i0.ɵɵtemplate(6, PostModalComponent_button_6_Template, 2, 0, \"button\", 3);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", !ctx.expandedUpvotesView);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.expandedUpvotesView);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.error);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.expandedUpvotesView);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.isEditing);\n    }\n  },\n  styles: [\".avatar[_ngcontent-%COMP%] {\\n  background-image: url(\\\"https://www.mtsolar.us/wp-content/uploads/2020/04/avatar-placeholder.png\\\");\\n  background-size: cover;\\n}\\n\\n.comment-area[_ngcontent-%COMP%] {\\n  overflow-y: auto;\\n  min-height: 110px;\\n}\\n\\n.comment-box[_ngcontent-%COMP%] {\\n  overflow-y: auto;\\n  word-wrap: break-word;\\n  max-height: 300px;\\n  margin-bottom: 3px;\\n}\\n\\n.comment-delete[_ngcontent-%COMP%] {\\n  position: absolute;\\n  right: 0;\\n  top: 5.5px;\\n  display: none;\\n}\\n\\n.comment-toggler[_ngcontent-%COMP%] {\\n  padding: 0 !important;\\n}\\n\\n.comment[_ngcontent-%COMP%] {\\n  background-color: #f5f5f5;\\n  border-radius: 0%;\\n}\\n\\n.comment[_ngcontent-%COMP%]:hover   .comment-delete[_ngcontent-%COMP%] {\\n  display: block;\\n}\\n\\n.add-comment[_ngcontent-%COMP%] {\\n  width: 100%;\\n  margin-bottom: -1.3em;\\n}\\n\\n.fill-remaining-space[_ngcontent-%COMP%] {\\n  flex: 1 1 auto;\\n}\\n\\n.details[_ngcontent-%COMP%] {\\n  box-shadow: none !important;\\n  padding: 0 !important;\\n}\\n\\n.mat-dialog-actions[_ngcontent-%COMP%] {\\n  min-height: 20px !important;\\n}\\n\\n.tag-form[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n\\n.cancel[_ngcontent-%COMP%] {\\n  padding-left: 10px;\\n  width: 12px;\\n  height: 15px;\\n  font-size: medium;\\n}\\n\\n  .mat-form-field-underline {\\n  display: none;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9wb3N0LW1vZGFsL3Bvc3QtbW9kYWwuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxpR0FBQTtFQUNBLHNCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxnQkFBQTtFQUNBLGlCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxnQkFBQTtFQUNBLHFCQUFBO0VBQ0EsaUJBQUE7RUFDQSxrQkFBQTtBQUNGOztBQUVBO0VBQ0ksa0JBQUE7RUFDQSxRQUFBO0VBQ0EsVUFBQTtFQUNBLGFBQUE7QUFDSjs7QUFFQTtFQUNFLHFCQUFBO0FBQ0Y7O0FBRUE7RUFDRSx5QkFBQTtFQUNBLGlCQUFBO0FBQ0Y7O0FBRUE7RUFDSSxjQUFBO0FBQ0o7O0FBRUE7RUFDRSxXQUFBO0VBQ0EscUJBQUE7QUFDRjs7QUFFQTtFQUNFLGNBQUE7QUFDRjs7QUFFQTtFQUNFLDJCQUFBO0VBQ0EscUJBQUE7QUFDRjs7QUFFQTtFQUNFLDJCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxXQUFBO0FBQ0Y7O0FBRUE7RUFDRSxrQkFBQTtFQUNBLFdBQUE7RUFDQSxZQUFBO0VBQ0EsaUJBQUE7QUFDRjs7QUFFQTtFQUNFLGFBQUE7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIi5hdmF0YXIge1xuICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ2h0dHBzOi8vd3d3Lm10c29sYXIudXMvd3AtY29udGVudC91cGxvYWRzLzIwMjAvMDQvYXZhdGFyLXBsYWNlaG9sZGVyLnBuZycpO1xuICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyO1xufVxuXG4uY29tbWVudC1hcmVhIHtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgbWluLWhlaWdodDogMTEwcHg7XG59XG5cbi5jb21tZW50LWJveCB7XG4gIG92ZXJmbG93LXk6IGF1dG87XG4gIHdvcmQtd3JhcDogYnJlYWstd29yZDtcbiAgbWF4LWhlaWdodDogMzAwcHg7XG4gIG1hcmdpbi1ib3R0b206IDNweDtcbn1cblxuLmNvbW1lbnQtZGVsZXRlIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7IFxuICAgIHJpZ2h0OiAwOyBcbiAgICB0b3A6IDUuNXB4O1xuICAgIGRpc3BsYXk6IG5vbmU7XG59XG5cbi5jb21tZW50LXRvZ2dsZXIge1xuICBwYWRkaW5nOiAwICFpbXBvcnRhbnQ7XG59XG5cbi5jb21tZW50IHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTtcbiAgYm9yZGVyLXJhZGl1czogMCU7XG59XG5cbi5jb21tZW50OmhvdmVyIC5jb21tZW50LWRlbGV0ZSB7XG4gICAgZGlzcGxheTogYmxvY2s7XG59XG5cbi5hZGQtY29tbWVudCB7XG4gIHdpZHRoOiAxMDAlO1xuICBtYXJnaW4tYm90dG9tOiAtMS4zZW07XG59XG5cbi5maWxsLXJlbWFpbmluZy1zcGFjZSB7XG4gIGZsZXg6IDEgMSBhdXRvO1xufVxuXG4uZGV0YWlscyB7XG4gIGJveC1zaGFkb3c6IG5vbmUgIWltcG9ydGFudDtcbiAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xufVxuXG4ubWF0LWRpYWxvZy1hY3Rpb25zIHtcbiAgbWluLWhlaWdodDogMjBweCAhaW1wb3J0YW50O1xufVxuXG4udGFnLWZvcm0ge1xuICB3aWR0aDogMTAwJTtcbn1cblxuLmNhbmNlbCB7XG4gIHBhZGRpbmctbGVmdDogMTBweDtcbiAgd2lkdGg6IDEycHg7XG4gIGhlaWdodDogMTVweDtcbiAgZm9udC1zaXplOiBtZWRpdW07XG59XG5cbjo6bmctZGVlcCAubWF0LWZvcm0tZmllbGQtdW5kZXJsaW5lIHtcbiAgZGlzcGxheTogbm9uZTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["FormControl","Validators","MAT_DIALOG_DATA","MyErrorStateMatcher","Role","ContentType","PostType","DELETE","SocketEvent","ConfirmModalComponent","generateUniqueID","getErrorMessage","AddPostComponent","i0","$event","ctx_r75","linkifyStr","require","PostModalEvent","PostModalData","constructor","PostModalComponent","dialogRef","dialog","commentService","upvotesService","postService","bucketService","socketService","projectService","canvasService","userService","fabricUtils","snackbarService","boardService","data","required","maxLength","backdropClick","subscribe","close","user","numSavedPosts","contentType","post","showComments","commentPress","get","postID","then","p","postColor","displayAttributes","fillColor","title","editingTitle","defaultProtocol","target","desc","editingDesc","replace","tags","tagOptions","board","filter","n","map","b","name","includes","canEditDelete","userID","role","TEACHER","author","getOneById","MULTIPLE_CHOICE","multipleChoiceOptions","multipleChoice","getCommentsByPost","forEach","comment","comments","push","getUpvotesByPost","upvote","upvotes","getAllByBoard","boardID","buckets","isStudent","STUDENT","isTeacher","showEditDelete","permissions","allowStudentEditAddDeletePost","canStudentComment","allowStudentCommenting","canStudentTag","allowStudentTagging","showAuthorName","showAuthorNameStudent","showAuthorNameTeacher","ngOnInit","projectID","project","updatePostContainer","event","destType","bucket","BOARD","checked","createBoardPostFromBucket","clearPostsFromBoard","BUCKET","bucketID","posts","add","id","remove","toggleEdit","editMultipleChoicePost","isEditing","toggleComments","onUpdate","update","emit","POST_UPDATE","onDelete","open","width","message","handleConfirm","removePost","addTag","tagOption","stopPropagation","tag","onTagEvent","removeTag","untag","index","indexOf","splice","addComment","newComment","commentID","username","onCommentEvent","deleteComment","ind","savePostToPersonalBoard","personalBoard","getPersonal","postOffset","updateNumSavedPosts","position","top","centerPos","left","type","newPost","create","openSnackBar","error","handleUpvoteClick","_votingLocked","_setError","catch","e","handleDownvoteClick","unupvote","u","upvoteID","isUpvoted","some","voterID","gotoUpvotesView","expandedUpvotes","Object","keys","length","updateSize","expandedUpvotesView","gotoPostView","answerMultipleChoice","submitMultipleChoiceAnswer","isMultipleChoiceSelected","selectedMultipleChoice","correct","queueSnackbar","selectMultipleChoice","autoFocus","spawnPosition","editingPost","onComplete","bucketIncludesPost","findIndex","allowStudentUpvoting","setTimeout","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/marieklinaeva/github/ck-board/frontend/src/app/components/post-modal/post-modal.component.ts","/Users/marieklinaeva/github/ck-board/frontend/src/app/components/post-modal/post-modal.component.html"],"sourcesContent":["import { Component, Inject, OnInit } from '@angular/core';\nimport { FormControl, Validators } from '@angular/forms';\nimport {\n  MatDialog,\n  MatDialogRef,\n  MAT_DIALOG_DATA,\n} from '@angular/material/dialog';\nimport { MyErrorStateMatcher } from 'src/app/utils/ErrorStateMatcher';\nimport Comment from 'src/app/models/comment';\nimport { CommentService } from 'src/app/services/comment.service';\nimport User, { Role } from 'src/app/models/user';\nimport { UpvotesService } from 'src/app/services/upvotes.service';\nimport { PostService } from 'src/app/services/post.service';\nimport { BucketService } from 'src/app/services/bucket.service';\nimport { FabricUtils } from 'src/app/utils/FabricUtils';\nimport Post, {\n  ContentType,\n  MultipleChoiceOptions,\n  PostType,\n} from 'src/app/models/post';\nimport { DELETE } from '@angular/cdk/keycodes';\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { ConfirmModalComponent } from '../confirm-modal/confirm-modal.component';\nimport { SocketService } from 'src/app/services/socket.service';\nimport { CanvasService } from 'src/app/services/canvas.service';\nimport { UserService } from 'src/app/services/user.service';\nimport { generateUniqueID, getErrorMessage } from 'src/app/utils/Utils';\nimport { Tag } from 'src/app/models/tag';\nimport { AddPostComponent } from '../add-post-modal/add-post.component';\nimport Upvote from 'src/app/models/upvote';\nimport { Board } from 'src/app/models/board';\nimport { BoardService } from 'src/app/services/board.service';\nimport { SnackbarService } from 'src/app/services/snackbar.service';\nimport { Project } from 'src/app/models/project';\nimport { ProjectService } from 'src/app/services/project.service';\nimport Bucket from 'src/app/models/bucket';\n\nconst linkifyStr = require('linkifyjs/lib/linkify-string');\n\nexport enum PostModalEvent {\n  POST_UPVOTE = 'POST_UPVOTE',\n  POST_DOWNVOTE = 'POST_DOWNVOTE',\n  POST_ADD_COMMENT = 'POST_ADD_COMMENT',\n  POST_REMOVE_COMMENT = 'POST_REMOVE_COMMENT',\n  POST_ADD_TAG = 'POST_ADD_TAG',\n  POST_REMOVE_TAG = 'POST_REMOVE_TAG',\n}\n\nexport class PostModalData {\n  post!: Post;\n  user!: User;\n  board!: Board;\n  commentPress?: boolean;\n  onCommentEvent?: Function;\n  onTagEvent?: Function;\n  numSavedPosts: number = 0;\n  updateNumSavedPosts?: Function;\n}\n\n@Component({\n  selector: 'app-post-modal',\n  templateUrl: './post-modal.component.html',\n  styleUrls: ['./post-modal.component.scss'],\n})\nexport class PostModalComponent {\n  tags: Tag[] = [];\n  tagOptions: Tag[] = [];\n\n  user: User;\n  board: Board;\n  project: Project;\n  post: Post;\n  author: User | undefined;\n  buckets: any[];\n  contentType: ContentType;\n  multipleChoiceOptions: MultipleChoiceOptions[] | undefined = [];\n  selectedMultipleChoice: MultipleChoiceOptions;\n  isMultipleChoiceSelected = false;\n  submitMultipleChoiceAnswer = false;\n\n  numSavedPosts: number;\n\n  PostType: typeof PostType = PostType;\n\n  title: string;\n  editingTitle: string;\n  desc: string;\n  editingDesc: string;\n  isEditing = false;\n  canEditDelete: boolean;\n  canStudentComment: boolean;\n  canStudentTag: boolean;\n  postColor: string;\n  showComments = false;\n  showEditDelete = false;\n  showAuthorName: boolean;\n\n  error = '';\n  titleControl = new FormControl('', [\n    Validators.required,\n    Validators.maxLength(50),\n  ]);\n  descControl = new FormControl('', [Validators.maxLength(2000)]);\n  matcher = new MyErrorStateMatcher();\n\n  newComment: string;\n  comments: Comment[] = [];\n\n  upvotes: Upvote[] = [];\n\n  expandedUpvotesView = false;\n  expandedUpvotes: any[] = [];\n\n  constructor(\n    public dialogRef: MatDialogRef<PostModalComponent>,\n    public dialog: MatDialog,\n    public commentService: CommentService,\n    public upvotesService: UpvotesService,\n    public postService: PostService,\n    public bucketService: BucketService,\n    public socketService: SocketService,\n    public projectService: ProjectService,\n    public canvasService: CanvasService,\n    public userService: UserService,\n    public fabricUtils: FabricUtils,\n    public snackbarService: SnackbarService,\n    public boardService: BoardService,\n    @Inject(MAT_DIALOG_DATA) public data: PostModalData\n  ) {\n    dialogRef.backdropClick().subscribe(() => this.close());\n    this.user = data.user;\n    this.numSavedPosts = data.numSavedPosts;\n    this.contentType = data.post.contentType;\n    this.showComments = data?.commentPress ? true : false;\n    this.postService.get(data.post.postID).then(async (p: Post) => {\n      this.post = p;\n      this.postColor = p.displayAttributes.fillColor;\n      this.title = p.title;\n      this.editingTitle = linkifyStr(p.title, {\n        defaultProtocol: 'https',\n        target: '_blank',\n      });\n      this.desc = p.desc;\n      this.editingDesc = linkifyStr(p.desc, {\n        defaultProtocol: 'https',\n        target: '_blank',\n      }).replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n      this.tags = p.tags;\n      this.tagOptions = data.board.tags.filter(\n        (n) => !this.tags.map((b) => b.name).includes(n.name)\n      );\n      this.canEditDelete =\n        this.data.post.userID == this.user.userID ||\n        this.user.role == Role.TEACHER;\n      this.author = await this.userService.getOneById(p.userID);\n      this.contentType = p.contentType;\n      if (this.contentType === ContentType.MULTIPLE_CHOICE) {\n        this.multipleChoiceOptions = p.multipleChoice;\n      }\n    });\n    this.commentService.getCommentsByPost(data.post.postID).then((data) => {\n      data.forEach((comment) => {\n        this.comments.push(comment);\n      });\n    });\n    this.upvotesService.getUpvotesByPost(data.post.postID).then((data) => {\n      data.forEach((upvote) => {\n        this.upvotes.push(upvote);\n      });\n    });\n    this.bucketService\n      .getAllByBoard(this.data.board.boardID)\n      .then((buckets) => {\n        this.buckets = buckets;\n      });\n\n    const isStudent = this.user.role == Role.STUDENT;\n    const isTeacher = this.user.role == Role.TEACHER;\n    this.showEditDelete =\n      (isStudent && data.board.permissions.allowStudentEditAddDeletePost) ||\n      isTeacher;\n    this.canStudentComment =\n      (isStudent && data.board.permissions.allowStudentCommenting) || isTeacher;\n    this.canStudentTag =\n      (isStudent && data.board.permissions.allowStudentTagging) || isTeacher;\n    this.showAuthorName =\n      (isStudent && data.board.permissions.showAuthorNameStudent) ||\n      (isTeacher && data.board.permissions.showAuthorNameTeacher);\n  }\n\n  ngOnInit(): void {\n    this.projectService.get(this.data.board.projectID).then((project) => {\n      this.project = project;\n    });\n  }\n\n  close(): void {\n    this.dialogRef.close(this.post);\n  }\n\n  async updatePostContainer(\n    event,\n    destType: PostType,\n    bucket: Bucket | null\n  ): Promise<void> {\n    if (destType == PostType.BOARD) {\n      if (event.checked) {\n        this.post = await this.canvasService.createBoardPostFromBucket(\n          this.post\n        );\n      } else {\n        this.post = (\n          await this.canvasService.clearPostsFromBoard([this.post])\n        )[0];\n      }\n    }\n    if (destType == PostType.BUCKET && bucket) {\n      const bucketID = bucket.bucketID;\n      const postID = this.post.postID;\n      if (event.checked) {\n        bucket.posts.push(postID);\n        await this.bucketService.add(bucketID, postID);\n      } else {\n        bucket.posts = bucket.posts.filter((id) => id !== postID);\n        await this.bucketService.remove(bucketID, postID);\n      }\n    }\n  }\n\n  toggleEdit() {\n    if (this.contentType === ContentType.MULTIPLE_CHOICE) {\n      this.editMultipleChoicePost();\n    } else {\n      this.isEditing = !this.isEditing;\n    }\n  }\n\n  toggleComments() {\n    this.showComments = !this.showComments;\n  }\n\n  async onUpdate() {\n    this.editingTitle = this.title;\n    this.editingDesc = linkifyStr(this.desc, {\n      defaultProtocol: 'https',\n      target: '_blank',\n    }).replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n\n    const update: Partial<Post> = {\n      postID: this.post.postID,\n      title: this.title,\n      desc: this.desc,\n    };\n\n    this.socketService.emit(SocketEvent.POST_UPDATE, update);\n    this.toggleEdit();\n  }\n\n  onDelete() {\n    this.dialog.open(ConfirmModalComponent, {\n      width: '500px',\n      data: {\n        title: 'Confirmation',\n        message: 'Are you sure you want to permanently delete this post?',\n        handleConfirm: async () => {\n          await this.canvasService.removePost(this.post);\n          this.dialogRef.close(DELETE);\n        },\n      },\n    });\n  }\n\n  async addTag(event, tagOption) {\n    event.stopPropagation();\n\n    this.post = await this.canvasService.tag(this.post, tagOption);\n    this.tags.push(tagOption);\n    this.tagOptions = this.tagOptions.filter((tag) => tag != tagOption);\n    if (this.data.onTagEvent) {\n      this.data.onTagEvent(this.post.postID, 'add');\n    }\n  }\n\n  async removeTag(tag) {\n    if (!this.canStudentTag) return;\n\n    this.post = await this.canvasService.untag(this.post, tag);\n\n    const index = this.tags.indexOf(tag);\n    if (index >= 0) {\n      this.tags.splice(index, 1);\n    }\n    this.tagOptions.push(tag);\n    if (this.data.onTagEvent) {\n      this.data.onTagEvent(this.post.postID, 'remove');\n    }\n  }\n\n  async addComment() {\n    const comment: Comment = {\n      comment: this.newComment,\n      commentID: generateUniqueID(),\n      userID: this.data.user.userID,\n      postID: this.post.postID,\n      boardID: this.data.board.boardID,\n      author: this.data.user.username,\n    };\n\n    await this.canvasService.comment(comment);\n    this.newComment = '';\n    this.comments.push(comment);\n    if (this.data.onCommentEvent) {\n      this.data.onCommentEvent(this.post.postID, 'add');\n    }\n  }\n\n  async deleteComment(comment: Comment) {\n    this.dialog.open(ConfirmModalComponent, {\n      width: '500px',\n      data: {\n        title: 'Confirmation',\n        message: 'Are you sure you want to delete this comment?',\n        handleConfirm: async () => {\n          await this.canvasService.deleteComment(\n            comment.commentID,\n            comment.postID\n          );\n          const ind = this.comments.indexOf(comment);\n          if (ind != -1) {\n            this.comments.splice(ind, 1);\n          }\n          if (this.data.onCommentEvent) {\n            this.data.onCommentEvent(this.post.postID, 'remove');\n          }\n        },\n      },\n    });\n  }\n\n  async savePostToPersonalBoard() {\n    try {\n      const personalBoard = await this.boardService.getPersonal(\n        this.project.projectID\n      );\n\n      if (!personalBoard) return;\n\n      if (this.post.displayAttributes) {\n        const postOffset = 50 * this.numSavedPosts;\n        this.numSavedPosts += 1;\n        if (this.data.updateNumSavedPosts)\n          this.data.updateNumSavedPosts(this.numSavedPosts);\n        const position = {\n          top: this.canvasService.centerPos.top + postOffset,\n          left: this.canvasService.centerPos.left + postOffset,\n        };\n        this.post.displayAttributes.position = position;\n      }\n\n      const post: Post = {\n        postID: generateUniqueID(),\n        userID: this.user.userID,\n        boardID: personalBoard.boardID,\n        type: PostType.BOARD,\n        contentType: this.contentType,\n        multipleChoice: this.multipleChoiceOptions,\n        title: this.title,\n        author: this.user.username,\n        desc: this.desc,\n        tags: this.tags,\n        displayAttributes: this.post.displayAttributes,\n      };\n\n      const newPost = await this.postService.create(post);\n\n      if (newPost)\n        this.openSnackBar('Successfully copied to your Personal Board');\n    } catch (error) {\n      this.openSnackBar(\n        'Unable to copy post to your Personal Board. Please refresh and try again!'\n      );\n    }\n  }\n\n  async handleUpvoteClick() {\n    if (this._votingLocked())\n      return this._setError(getErrorMessage('Voting is disabled!'));\n\n    this.canvasService\n      .upvote(this.user.userID, this.post)\n      .then((upvote) => this.upvotes.push(upvote))\n      .catch((e) => this._setError(getErrorMessage(e)));\n  }\n\n  async handleDownvoteClick() {\n    if (this._votingLocked())\n      return this._setError(getErrorMessage('Voting is disabled!'));\n\n    this.canvasService\n      .unupvote(this.user.userID, this.post.postID)\n      .then((upvote: Upvote) => {\n        this.upvotes = this.upvotes.filter(\n          (u) => u.upvoteID != upvote.upvoteID\n        );\n      })\n      .catch((e) => this._setError(getErrorMessage(e)));\n  }\n\n  isUpvoted(): Boolean {\n    return this.upvotes.some((u) => u.voterID === this.user.userID);\n  }\n\n  async gotoUpvotesView() {\n    this.expandedUpvotes = await this.upvotesService.getUpvotesByPost(\n      this.post.postID,\n      'grouped'\n    );\n\n    if (\n      !this.expandedUpvotes ||\n      Object.keys(this.expandedUpvotes).length == 0\n    ) {\n      return this._setError('No upvotes found!');\n    }\n\n    this.dialogRef.updateSize('30vw');\n    this.expandedUpvotesView = true;\n  }\n\n  gotoPostView() {\n    this.dialogRef.updateSize('95vw');\n    this.expandedUpvotesView = false;\n  }\n\n  answerMultipleChoice() {\n    this.submitMultipleChoiceAnswer = true;\n    if (this.isMultipleChoiceSelected && this.selectedMultipleChoice) {\n      if (this.selectedMultipleChoice.correct) {\n        this.snackbarService.queueSnackbar('Correct Answer!');\n      } else {\n        this.snackbarService.queueSnackbar('Incorrect, please try again.');\n      }\n    }\n  }\n  selectMultipleChoice(event, multipleChoice) {\n    event.stopPropagation();\n    this.submitMultipleChoiceAnswer = false;\n    this.isMultipleChoiceSelected = true;\n    this.selectedMultipleChoice = multipleChoice;\n  }\n\n  async editMultipleChoicePost() {\n    this.dialog.open(AddPostComponent, {\n      width: '800px',\n      autoFocus: false,\n      data: {\n        type: this.post.type,\n        board: this.data.board,\n        user: this.user,\n        spawnPosition: {\n          top: this.post.displayAttributes?.position?.top\n            ? this.post.displayAttributes?.position.top\n            : 150,\n          left: this.post.displayAttributes?.position?.left\n            ? this.post.displayAttributes?.position.top\n            : 150,\n        },\n        editingPost: this.post,\n        onComplete: async (post: Partial<Post>) => {\n          this.socketService.emit(SocketEvent.POST_UPDATE, post);\n          if (post.title) {\n            this.title = post.title;\n            this.post.title = post.title;\n            this.editingTitle = linkifyStr(post.title, {\n              defaultProtocol: 'https',\n              target: '_blank',\n            });\n          }\n          if (post.tags) this.tags = post.tags;\n          if (post.multipleChoice)\n            this.multipleChoiceOptions = post.multipleChoice;\n        },\n      },\n    });\n  }\n\n  bucketIncludesPost(bucket: any): boolean {\n    return (\n      bucket.posts.findIndex((post) => post.postID == this.post.postID) > -1\n    );\n  }\n\n  openSnackBar(message: string) {\n    this.snackbarService.queueSnackbar(message);\n  }\n\n  private _votingLocked(): boolean {\n    return (\n      this.user.role == Role.STUDENT &&\n      !this.data.board.permissions.allowStudentUpvoting\n    );\n  }\n\n  private _setError(error: string) {\n    this.error = error;\n    setTimeout(() => (this.error = ''), 5000);\n  }\n}\n","<div *ngIf=\"!expandedUpvotesView\">\n  <mat-card class=\"details\" *ngIf=\"!isEditing\">\n    <mat-card-header>\n      <div mat-card-avatar class=\"avatar\"></div>\n      <mat-card-title [innerHTML]=\"editingTitle\">{{\n        editingTitle\n      }}</mat-card-title>\n      <span class=\"fill-remaining-space\"></span>\n      <mat-card-subtitle *ngIf=\"showAuthorName && author; else elseBlock\">{{\n        author.username\n      }}</mat-card-subtitle>\n      <ng-template #elseBlock>\n        <mat-card-subtitle>Anonymous</mat-card-subtitle>\n      </ng-template>\n      <button\n        mat-icon-button\n        matTooltip=\"Save post to personal board\"\n        *ngIf=\"project?.personalBoardSetting?.enabled && post?.type === PostType.BOARD && data.board.scope === 'PROJECT_SHARED'\"\n        (click)=\"savePostToPersonalBoard()\"\n      >\n        <mat-icon>star_border</mat-icon>\n      </button>\n      <button mat-icon-button [matMenuTriggerFor]=\"bucketMenu\">\n        <mat-icon>library_add</mat-icon>\n      </button>\n      <mat-menu #bucketMenu=\"matMenu\">\n        <div mat-menu-item (click)=\"$event.stopPropagation()\">\n          <mat-checkbox\n            [checked]=\"post && post.type === PostType.BOARD\"\n            (change)=\"updatePostContainer($event, PostType.BOARD, null)\"\n            >{{ data.board.name }}</mat-checkbox\n          >\n        </div>\n        <div\n          mat-menu-item\n          (click)=\"$event.stopPropagation()\"\n          *ngFor=\"let bucket of buckets\"\n        >\n          <mat-checkbox\n            id=\"{{ bucket.bucketID }}\"\n            [checked]=\"bucketIncludesPost(bucket)\"\n            (change)=\"updatePostContainer($event, PostType.BUCKET, bucket)\"\n            >{{ bucket.name }}</mat-checkbox\n          >\n        </div>\n      </mat-menu>\n      <button\n        mat-icon-button\n        *ngIf=\"!isEditing && showEditDelete && canEditDelete\"\n        (click)=\"toggleEdit()\"\n      >\n        <mat-icon>edit</mat-icon>\n      </button>\n      <button\n        mat-icon-button\n        *ngIf=\"showEditDelete && canEditDelete\"\n        (click)=\"onDelete()\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </mat-card-header>\n    <mat-card-content>\n      <p style=\"overflow-wrap: break-word\" [innerHTML]=\"editingDesc\">\n        {{ editingDesc }}\n      </p>\n      <div *ngIf=\"contentType === 'MULTIPLE_CHOICE'\">\n        <mat-card\n          *ngFor=\"let multipleChoice of multipleChoiceOptions\"\n          style=\"\n            display: flex;\n            margin: 10px 0;\n            padding: 10px;\n            justify-content: space-between;\n          \"\n          [ngStyle]=\"{\n            'background-color':\n              isMultipleChoiceSelected &&\n              selectedMultipleChoice === multipleChoice\n                ? submitMultipleChoiceAnswer\n                  ? multipleChoice.correct\n                    ? '#39e75f'\n                    : '#ff0000'\n                  : '#D3D3D3'\n                : 'white'\n          }\"\n          (click)=\"selectMultipleChoice($event, multipleChoice)\"\n        >\n          <mat-card-title style=\"font-size: small; margin: auto 0\">\n            {{ multipleChoice.optionTitle }}\n          </mat-card-title>\n        </mat-card>\n        <mat-chip\n          color=\"primary\"\n          selected\n          [disabled]=\"!isMultipleChoiceSelected\"\n          (click)=\"answerMultipleChoice()\"\n        >\n          Check Answer\n        </mat-chip>\n      </div>\n    </mat-card-content>\n    <mat-card-actions align=\"end\" style=\"margin-bottom: -1.25em\">\n      <button\n        mat-icon-button\n        [ngStyle]=\"isUpvoted() && { color: '#4f47ff' }\"\n        (click)=\"handleUpvoteClick()\"\n      >\n        <mat-icon style=\"transform: scale(2)\">arrow_drop_up</mat-icon>\n      </button>\n      <button\n        mat-icon-button\n        [ngStyle]=\"isUpvoted() && { color: '#4f47ff' }\"\n        (click)=\"gotoUpvotesView()\"\n      >\n        {{ upvotes.length }}\n      </button>\n      <button mat-icon-button (click)=\"handleDownvoteClick()\">\n        <mat-icon style=\"transform: scale(2)\">arrow_drop_down</mat-icon>\n      </button>\n    </mat-card-actions>\n    <mat-card-actions style=\"margin-bottom: -1.25em\">\n      <mat-form-field class=\"tag-form\" appearance=\"standard\">\n        <mat-chip-list #chipList>\n          <mat-chip\n            style=\"background-color: #78c2c0\"\n            [matMenuTriggerFor]=\"menu1\"\n            *ngIf=\"canStudentTag\"\n          >\n            Add Tag\n            <mat-icon>add</mat-icon>\n          </mat-chip>\n          <mat-chip\n            [ngStyle]=\"{ 'background-color': tag.color }\"\n            *ngFor=\"let tag of tags\"\n          >\n            {{ tag.name }}\n            <mat-icon class=\"cancel\" (click)=\"removeTag(tag)\">cancel</mat-icon>\n          </mat-chip>\n          <mat-menu #menu1=\"matMenu\">\n            <div mat-menu-item *ngIf=\"tagOptions && tagOptions.length === 0\">\n              No tags available.\n            </div>\n            <div\n              mat-menu-item\n              (click)=\"addTag($event, tagOption)\"\n              *ngFor=\"let tagOption of tagOptions\"\n            >\n              {{ tagOption.name }}\n            </div>\n          </mat-menu>\n        </mat-chip-list>\n      </mat-form-field>\n    </mat-card-actions>\n  </mat-card>\n  <mat-form-field\n    *ngIf=\"isEditing\"\n    appearance=\"outline\"\n    style=\"width: 100%; margin-top: 20px\"\n  >\n    <mat-label>Title</mat-label>\n    <input\n      [formControl]=\"titleControl\"\n      [errorStateMatcher]=\"matcher\"\n      matInput\n      [(ngModel)]=\"title\"\n    />\n    <mat-error *ngIf=\"!title\"> Title is <strong>required</strong> </mat-error>\n    <mat-error *ngIf=\"title && title.length > 50\">\n      Title is <strong>too long!</strong>\n    </mat-error>\n  </mat-form-field>\n  <mat-form-field\n    *ngIf=\"isEditing && contentType === 'OPEN_RESPONSE_MESSAGE'\"\n    appearance=\"outline\"\n    style=\"width: 100%\"\n  >\n    <mat-label>Description</mat-label>\n    <textarea\n      [formControl]=\"descControl\"\n      [errorStateMatcher]=\"matcher\"\n      matInput\n      rows=\"5\"\n      cols=\"40\"\n      [(ngModel)]=\"desc\"\n    ></textarea>\n    <mat-error *ngIf=\"desc && desc.length > 2000\">\n      Description is <strong>too long!</strong>\n    </mat-error>\n  </mat-form-field>\n  <div mat-dialog-actions>\n    <button\n      *ngIf=\"isEditing\"\n      [disabled]=\"!titleControl.valid || !descControl.valid\"\n      mat-button\n      (click)=\"onUpdate()\"\n    >\n      Update\n    </button>\n    <button *ngIf=\"isEditing\" mat-button (click)=\"toggleEdit()\">Cancel</button>\n  </div>\n  <div class=\"comment-area\" *ngIf=\"!isEditing\">\n    <div class=\"comments-header\">\n      <button class=\"comment-toggler\" mat-button (click)=\"toggleComments()\">\n        Comments ({{ comments.length }})\n        <mat-icon>{{ showComments ? 'expand_less' : 'expand_more' }}</mat-icon>\n      </button>\n    </div>\n    <div class=\"comment-box\" *ngIf=\"showComments\">\n      <mat-card class=\"comment\" *ngFor=\"let comment of comments\">\n        <mat-card-title style=\"font-size: small\"\n          >{{ comment.author }}\n          <button\n            mat-icon-button\n            class=\"comment-delete\"\n            *ngIf=\"\n              (showEditDelete && canEditDelete) ||\n              comment.userID === user.userID\n            \"\n            (click)=\"deleteComment(comment)\"\n          >\n            <mat-icon>delete</mat-icon>\n          </button>\n        </mat-card-title>\n        <mat-card-content>\n          {{ comment.comment }}\n        </mat-card-content>\n      </mat-card>\n    </div>\n    <mat-form-field\n      class=\"add-comment\"\n      appearance=\"outline\"\n      *ngIf=\"showComments && canStudentComment\"\n    >\n      <mat-label>Add Comment</mat-label>\n      <input matInput [appAutofocus]=\"showComments\" [(ngModel)]=\"newComment\" (keyup.enter)=\"newComment ? addComment(): ''\" />\n      <button [disabled]=\"!newComment\" color=\"primary\" matSuffix mat-button (click)=\"addComment()\">\n        Comment!\n      </button>\n    </mat-form-field>\n  </div>\n</div>\n<div *ngIf=\"expandedUpvotesView\">\n  <mat-list>\n    <mat-list-item\n      style=\"justify-content: space-between\"\n      *ngFor=\"let upvote of expandedUpvotes | keyvalue\"\n    >\n      <div mat-card-avatar class=\"avatar\" style=\"margin-right: 20px\"></div>\n      <div>{{ upvote.value.user.username }}</div>\n      <span style=\"flex: 1 1 auto\"></span>\n      <div style=\"color: '#4f47ff'; margin-right: 5px\">\n        {{ upvote.value.amount }}\n      </div>\n      <mat-icon mat-icon style=\"color: '#4f47ff'\">arrow_upward</mat-icon>\n    </mat-list-item>\n  </mat-list>\n</div>\n<div mat-dialog-actions>\n  <mat-error *ngIf=\"error\">{{ error }}</mat-error>\n  <span style=\"flex: 1 1 auto\"></span>\n  <button *ngIf=\"expandedUpvotesView\" mat-button (click)=\"gotoPostView()\">\n    Back to Post\n  </button>\n  <button *ngIf=\"!isEditing\" mat-button (click)=\"close()\">Close</button>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}