{"ast":null,"code":"import _asyncToGenerator from \"/Users/marieklinaeva/github/ck-board/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { NotificationType } from 'src/app/models/notification';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/notification.service\";\nimport * as i2 from \"src/app/services/socket.service\";\nimport * as i3 from \"@angular/material/dialog\";\nfunction ProjectNotificationDropdownComponent_mat_icon_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\", 6);\n    i0.ɵɵtext(1, \"notifications_active\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"matBadge\", ctx_r0.notifications.length);\n  }\n}\nfunction ProjectNotificationDropdownComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\");\n    i0.ɵɵtext(1, \"notifications\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectNotificationDropdownComponent_div_6_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const notification_r8 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", notification_r8.text, \" \");\n  }\n}\nfunction ProjectNotificationDropdownComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ProjectNotificationDropdownComponent_div_6_button_1_Template, 2, 1, \"button\", 7);\n    i0.ɵɵelementStart(2, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectNotificationDropdownComponent_div_6_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.markAllAsRead());\n    });\n    i0.ɵɵtext(3, \"Mark all as read\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.notifications.reverse());\n  }\n}\nfunction ProjectNotificationDropdownComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 10);\n    i0.ɵɵtext(1, \"No notifications to display\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class ProjectNotificationDropdownComponent {\n  constructor(notificationService, socketService, dialog) {\n    this.notificationService = notificationService;\n    this.socketService = socketService;\n    this.dialog = dialog;\n    this.notifications = [];\n    this.unsubListeners = [];\n    this.handleAdd = notification => {\n      this.notifications.push(notification);\n    };\n  }\n  ngOnInit() {\n    this.notificationService.getByUserAndProject(this.user.userID, this.project.projectID).then(notifications => {\n      this.notifications = notifications;\n      this.initGroupEventsListener();\n    });\n  }\n  initGroupEventsListener() {\n    const unsub = this.socketService.listen(SocketEvent.PROJECT_NOTIFICATION_CREATE, this.handleAdd);\n    this.unsubListeners.push(unsub);\n  }\n  markAllAsRead() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.notifications.forEach(notification => {\n        _this.notificationService.markAsRead(NotificationType.PROJECT, notification.notificationID);\n        _this.deleteNotification(notification);\n      });\n    })();\n  }\n  deleteNotification(notification) {\n    if (this.notifications) {\n      this.notifications = this.notifications.filter(currentNotification => currentNotification.notificationID != notification.notificationID);\n    }\n    this.notificationService.remove(NotificationType.PROJECT, notification.notificationID);\n  }\n  ngOnDestroy() {\n    this.notifications = [];\n    this.unsubListeners.forEach(unsub => unsub.unsubscribe());\n  }\n}\nProjectNotificationDropdownComponent.ɵfac = function ProjectNotificationDropdownComponent_Factory(t) {\n  return new (t || ProjectNotificationDropdownComponent)(i0.ɵɵdirectiveInject(i1.NotificationService), i0.ɵɵdirectiveInject(i2.SocketService), i0.ɵɵdirectiveInject(i3.MatDialog));\n};\nProjectNotificationDropdownComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProjectNotificationDropdownComponent,\n  selectors: [[\"app-project-notification-dropdown\"]],\n  inputs: {\n    user: \"user\",\n    project: \"project\"\n  },\n  decls: 9,\n  vars: 5,\n  consts: [[\"mat-icon-button\", \"\", \"matTooltip\", \"Project Notifications\", 3, \"matMenuTriggerFor\"], [3, \"matBadge\", 4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"], [\"menu\", \"matMenu\"], [4, \"ngIf\", \"ngIfElse\"], [\"matMenuElse\", \"\"], [3, \"matBadge\"], [\"mat-menu-item\", \"\", \"style\", \"white-space: unset; line-height: normal\", 4, \"ngFor\", \"ngForOf\"], [\"mat-button\", \"\", 3, \"click\"], [\"mat-menu-item\", \"\", 2, \"white-space\", \"unset\", \"line-height\", \"normal\"], [\"mat-menu-item\", \"\"]],\n  template: function ProjectNotificationDropdownComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"button\", 0);\n      i0.ɵɵtemplate(1, ProjectNotificationDropdownComponent_mat_icon_1_Template, 2, 1, \"mat-icon\", 1);\n      i0.ɵɵtemplate(2, ProjectNotificationDropdownComponent_ng_template_2_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"mat-menu\", null, 3);\n      i0.ɵɵtemplate(6, ProjectNotificationDropdownComponent_div_6_Template, 4, 1, \"div\", 4);\n      i0.ɵɵtemplate(7, ProjectNotificationDropdownComponent_ng_template_7_Template, 2, 0, \"ng-template\", null, 5, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(3);\n      const _r3 = i0.ɵɵreference(5);\n      const _r5 = i0.ɵɵreference(8);\n      i0.ɵɵproperty(\"matMenuTriggerFor\", _r3);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.notifications && ctx.notifications.length > 0)(\"ngIfElse\", _r1);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ctx.notifications && ctx.notifications.length > 0)(\"ngIfElse\", _r5);\n    }\n  },\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["SocketEvent","NotificationType","i0","ProjectNotificationDropdownComponent","constructor","notificationService","socketService","dialog","notification","notifications","push","ngOnInit","getByUserAndProject","user","userID","project","projectID","then","initGroupEventsListener","unsub","listen","PROJECT_NOTIFICATION_CREATE","handleAdd","unsubListeners","markAllAsRead","forEach","markAsRead","PROJECT","notificationID","deleteNotification","filter","currentNotification","remove","ngOnDestroy","unsubscribe","selectors","inputs","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/marieklinaeva/github/ck-board/frontend/src/app/components/project-notification-dropdown/project-notification-dropdown.component.ts","/Users/marieklinaeva/github/ck-board/frontend/src/app/components/project-notification-dropdown/project-notification-dropdown.component.html"],"sourcesContent":["import { Component, OnInit, Input } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Subscription } from 'rxjs';\nimport { AuthUser } from 'src/app/models/user';\nimport { Project } from 'src/app/models/project';\nimport { SocketService } from 'src/app/services/socket.service';\nimport { SocketEvent } from 'src/app/utils/constants';\nimport { NotificationService } from 'src/app/services/notification.service';\nimport {\n  NotificationType,\n  ProjectNotification,\n} from 'src/app/models/notification';\n\n@Component({\n  selector: 'app-project-notification-dropdown',\n  templateUrl: './project-notification-dropdown.component.html',\n  styleUrls: ['./project-notification-dropdown.component.scss'],\n})\nexport class ProjectNotificationDropdownComponent implements OnInit {\n  @Input() user: AuthUser;\n  @Input() project: Project;\n\n  notifications: ProjectNotification[] = [];\n  unsubListeners: Subscription[] = [];\n\n  constructor(\n    private notificationService: NotificationService,\n    private socketService: SocketService,\n    public dialog: MatDialog\n  ) {}\n\n  ngOnInit(): void {\n    this.notificationService\n      .getByUserAndProject(this.user.userID, this.project.projectID)\n      .then((notifications) => {\n        this.notifications = notifications;\n        this.initGroupEventsListener();\n      });\n  }\n\n  initGroupEventsListener() {\n    const unsub = this.socketService.listen(\n      SocketEvent.PROJECT_NOTIFICATION_CREATE,\n      this.handleAdd\n    );\n    this.unsubListeners.push(unsub);\n  }\n\n  handleAdd = (notification: ProjectNotification) => {\n    this.notifications.push(notification);\n  };\n\n  async markAllAsRead() {\n    this.notifications.forEach((notification) => {\n      this.notificationService.markAsRead(\n        NotificationType.PROJECT,\n        notification.notificationID\n      );\n      this.deleteNotification(notification);\n    });\n  }\n\n  deleteNotification(notification: ProjectNotification) {\n    if (this.notifications) {\n      this.notifications = this.notifications.filter(\n        (currentNotification) =>\n          currentNotification.notificationID != notification.notificationID\n      );\n    }\n    this.notificationService.remove(\n      NotificationType.PROJECT,\n      notification.notificationID\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.notifications = [];\n    this.unsubListeners.forEach((unsub) => unsub.unsubscribe());\n  }\n}\n","<button mat-icon-button [matMenuTriggerFor]=\"menu\" matTooltip=\"Project Notifications\">\n  <mat-icon\n    *ngIf=\"notifications && notifications.length > 0; else elseBlock\"\n    matBadge=\"{{ notifications.length }}\"\n    >notifications_active</mat-icon\n  >\n  <ng-template #elseBlock> <mat-icon>notifications</mat-icon></ng-template>\n</button>\n<mat-menu #menu=\"matMenu\">\n  <div *ngIf=\"notifications && notifications.length > 0; else matMenuElse\">\n    <button\n      mat-menu-item\n      *ngFor=\"let notification of notifications.reverse()\"\n      style=\"white-space: unset; line-height: normal\"\n    >\n      {{ notification.text }}\n    </button>\n    <button mat-button (click)=\"markAllAsRead()\">Mark all as read</button>\n  </div>\n  <ng-template #matMenuElse\n    ><p mat-menu-item>No notifications to display</p></ng-template\n  >\n</mat-menu>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}