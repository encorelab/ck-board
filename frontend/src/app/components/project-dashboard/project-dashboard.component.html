<div class="app">
  <app-toolbar [user]="user">
    <span *ngIf="project">{{ project.name }}</span>
    <span style="flex: 1 1 auto"></span>
    <button
      mat-icon-button
      [matMenuTriggerFor]="addMenu"
      *ngIf="user && user.role == Role.TEACHER"
      matTooltip="Create Board"
    >
      <mat-icon>add</mat-icon>
    </button>
    <mat-menu #addMenu="matMenu">
      <button mat-menu-item (click)="openCreateBoardDialog()">
        Create Board
      </button>
    </mat-menu>
    <app-csv-download-button
      [projectID]="this.projectID"
      *ngIf="user && user.role == Role.TEACHER && boards.length > 0"
    >
    </app-csv-download-button>
    <button
      *ngIf="user && user.role == Role.TEACHER"
      mat-icon-button
      (click)="openSettingsDialog()"
      matTooltip="Adjust Settings"
    >
      <mat-icon>settings</mat-icon>
    </button>
    <button
    *ngIf="user && user.role == Role.TEACHER"
    mat-icon-button
    (click)="openGroupDialog()"
    matTooltip="Manage Groups"
  >
    <mat-icon>group_work</mat-icon>
  </button>
  </app-toolbar>
  <div class="content">
    <div class="heading">
      <button
        mat-icon-button
        routerLink="/dashboard"
        aria-label="Return to Dashboard"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h3 class="mat-title" *ngIf="project">Boards for {{ project.name }}</h3>
    </div>
    <div class="cards">
      <ng-container *ngFor="let board of boards">
        <mat-card
          *ngIf="board.visible || user.role === Role.TEACHER"
          class="card"
          (click)="handleBoardClick(board.boardID)"
          (keyup.enter)="handleBoardClick(board.boardID)"
          role="button"
          tabindex="0"
          [attr.aria-label]="'View ' + board.name"
        >
          <mat-card-title class="board-card-header">
            <div class="board-card-title title accent">
              <mat-icon color="accent">picture_in_picture</mat-icon>
              <span>{{ board.name }}</span>
            </div>
            <div style="min-width: 80px">
              <button
                mat-icon-button
                class="accent"
                *ngIf="user && user.role === Role.TEACHER"
                matTooltip="Toggle Visibility"
                (click)="toggleBoardVisibility($event, board.boardID, board.visible)"
              >
                <mat-icon *ngIf="board.visible">visibility</mat-icon>
                <mat-icon *ngIf="!board.visible">visibility_off</mat-icon>
              </button>
              <button 
                *ngIf="user && user.role === Role.TEACHER"
                mat-icon-button
                [matMenuTriggerFor]="boardOptions"
                matTooltip="Board Options"
                (click)="$event.stopPropagation();"
              >
                <mat-icon >
                  more_vert
                </mat-icon>
              </button>
              <mat-menu #boardOptions="matMenu">
                <button mat-menu-item (click)="handleEditBoard(board)">
                  Edit
                </button>
                <button mat-menu-item (click)="handleDeleteBoard(board)">
                  Delete
                </button>
              </mat-menu>
            </div>
          </mat-card-title>
        </mat-card>
      </ng-container>
    </div>
  </div>
</div>
