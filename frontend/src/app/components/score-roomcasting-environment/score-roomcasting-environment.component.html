<div class="roomcasting-wrapper">
  <mat-toolbar *ngIf="user && project" class="roomcasting-toolbar" color="primary">
    <span class="toolbar-title-container">
      <mat-icon class="toolbar-icon">cast_connected</mat-icon>
      <span class="toolbar-project-name">SCORE Roomcasting - {{ project?.name }}</span>
      <span *ngIf="board" class="toolbar-board-name"> | {{ board?.name }}</span>
    </span>
    <span class="toolbar-spacer"></span>
    <span class="user-greeting">Welcome, {{ user?.username }}!</span>
    <!-- Add any other toolbar actions if needed -->
  </mat-toolbar>

  <div class="roomcasting-content">
    <mat-tab-group
      class="roomcasting-tab-group"
      animationDuration="0ms"
      [(selectedIndex)]="selectedTabIndex"
      (selectedTabChange)="onTabChanged($event)"
      *ngIf="tabsForUser.length > 0; else noResourcesAssigned"
    >
      <mat-tab *ngFor="let tab of tabsForUser; let i = index" [label]="tab.label">
        <ng-template matTabContent>
          <div class="tab-content-wrapper">
            <ng-container *ngIf="selectedTabIndex === i">
              <!-- Conditionally render components based on tab.type -->
              <app-canvas
                *ngIf="tab.type === 'canvas' && projectID && boardID"
                [projectID]="projectID"
                [boardID]="boardID"
                [embedded]="true"
                class="embedded-resource-component"
              ></app-canvas>
              <app-ck-buckets
                *ngIf="tab.type === 'bucketView' && projectID && boardID"
                [projectID]="projectID"
                [boardID]="boardID"
                [embedded]="true"
                class="embedded-resource-component"
              ></app-ck-buckets>
              <app-ck-workspace
                *ngIf="tab.type === 'workspace' && projectID && boardID"
                [projectID]="projectID"
                [boardID]="boardID"
                [embedded]="true"
                class="embedded-resource-component"
              ></app-ck-workspace>
              <app-ck-monitor
                *ngIf="tab.type === 'monitor' && projectID && boardID"
                [projectID]="projectID"
                [boardID]="boardID"
                [embedded]="true"
                class="embedded-resource-component"
              ></app-ck-monitor>
              <div
                *ngIf="tab.type === 'ideaAgent' && projectID && boardID"
                class="embedded-resource-component idea-agent-placeholder"
              >
                <!-- Placeholder for app-idea-agent or its content -->
                <h3>Idea Agent View</h3>
                <p>Project ID: {{ projectID }}</p>
                <p>Board ID: {{ boardID }}</p>
                <p>(Idea Agent component/content for '{{tab.name}}' will be rendered here)</p>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>

    <ng-template #noResourcesAssigned>
      <div class="placeholder-container">
        <mat-icon class="placeholder-icon">hourglass_empty</mat-icon>
        <h2 *ngIf="projectID">Waiting for teacher to start an activity phase...</h2>
        <p *ngIf="projectID">Once an activity starts, your assigned resources will appear here as tabs.</p>
        <mat-progress-bar mode="indeterminate" *ngIf="isLoading && !tabsForUser.length"></mat-progress-bar>
        <p *ngIf="!projectID && !isLoading" class="error-message">
            Could not load project information. Please ensure you have accessed this page correctly.
        </p>
      </div>
    </ng-template>
  </div>
</div>

<div *ngIf="!user && isLoading" class="loading-overlay">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Loading Roomcasting Environment...</p>
</div>
